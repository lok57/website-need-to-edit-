import{r as g,a as Kr,u as je,L,b as Qr,N as ps,c as Xr,R as Jr,d as V,B as Zr,e as eo}from"./react-vendor-Ct4H1cbi.js";import{L as to,a as x,_ as so,g as no,b as io,c as We,d as ro,e as oo,C as ao,r as Cn,s as O,j as Ps,f as se,h as lo,S as co,i as ho,k as Ae,m as Pt,l as mt,n as Yt,o as uo,p as mi,D as Gt,q as mo,t as fo,u as Sn,v as fi,w as po,x as go,y as Bt,z as xo,A as _o,B as yo,E as vo,F as wo,G as bo,H as No,I as jo,J as Co,K as So,M as Eo,N as ko,O as Io,P as Po,Q as To,R as Ro,T as Ao,U as Do,V as Mo,W as Lo,X as Fo,Y as Oo,Z as Wo,$ as qo}from"./firebase-vendor-Dk2yB6kS.js";import{_ as w,U as ft,S as qe,C as ye,M as Ts,L as Rs,a as pi,P as As,b as Ds,c as Ms,T as Ls,d as Tt,B as it,e as Uo,f as $t,g as zo,h as Ho,i as gi,X as Ue,j as Vo,F as xi,k as _i,I as Yo,Y as Go,l as Bo,A as $o,E as Ko,m as Fs,n as yi,o as vi,p as wi,H as Os,q as Qo,r as Xo,s as Rt,t as Jo,R as Zo,u as Je,v as ea,w as ta,x as sa,y as na,z as ia,D as ra,G as oa,J as aa,K as la,N as ca,O as bi,Q as Ni,V as da,W as ha,Z as ua,$ as ma}from"./ui-vendor-CKW271N4.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var ji={exports:{}},Kt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fa=g,pa=Symbol.for("react.element"),ga=Symbol.for("react.fragment"),xa=Object.prototype.hasOwnProperty,_a=fa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ya={key:!0,ref:!0,__self:!0,__source:!0};function Ci(s,e,t){var n,r={},o=null,a=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)xa.call(e,n)&&!ya.hasOwnProperty(n)&&(r[n]=e[n]);if(s&&s.defaultProps)for(n in e=s.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:pa,type:s,key:o,ref:a,props:r,_owner:_a.current}}Kt.Fragment=ga;Kt.jsx=Ci;Kt.jsxs=Ci;ji.exports=Kt;var i=ji.exports,gs={},En=Kr;gs.createRoot=En.createRoot,gs.hydrateRoot=En.hydrateRoot;var kn={};const In="@firebase/database",Pn="1.0.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Si="";function va(s){Si=s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wa{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),O(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Ps(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ba{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return se(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ei=function(s){try{if(typeof window<"u"&&typeof window[s]<"u"){const e=window[s];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new wa(e)}}catch{}return new ba},_e=Ei("localStorage"),Na=Ei("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Te=new to("@firebase/database"),ja=function(){let s=1;return function(){return s++}}(),ki=function(s){const e=lo(s),t=new co;t.update(e);const n=t.digest();return ho.encodeByteArray(n)},pt=function(...s){let e="";for(let t=0;t<s.length;t++){const n=s[t];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?e+=pt.apply(null,n):typeof n=="object"?e+=O(n):e+=n,e+=" "}return e};let Ze=null,Tn=!0;const Ca=function(s,e){x(!e,"Can't turn on custom loggers persistently."),Te.logLevel=uo.VERBOSE,Ze=Te.log.bind(Te)},z=function(...s){if(Tn===!0&&(Tn=!1,Ze===null&&Na.get("logging_enabled")===!0&&Ca()),Ze){const e=pt.apply(null,s);Ze(e)}},gt=function(s){return function(...e){z(s,...e)}},xs=function(...s){const e="FIREBASE INTERNAL ERROR: "+pt(...s);Te.error(e)},oe=function(...s){const e=`FIREBASE FATAL ERROR: ${pt(...s)}`;throw Te.error(e),new Error(e)},$=function(...s){const e="FIREBASE WARNING: "+pt(...s);Te.warn(e)},Sa=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&$("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Ws=function(s){return typeof s=="number"&&(s!==s||s===Number.POSITIVE_INFINITY||s===Number.NEGATIVE_INFINITY)},Ea=function(s){if(document.readyState==="complete")s();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,s())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},De="[MIN_NAME]",ve="[MAX_NAME]",Ce=function(s,e){if(s===e)return 0;if(s===De||e===ve)return-1;if(e===De||s===ve)return 1;{const t=Rn(s),n=Rn(e);return t!==null?n!==null?t-n===0?s.length-e.length:t-n:-1:n!==null?1:s<e?-1:1}},ka=function(s,e){return s===e?0:s<e?-1:1},Ge=function(s,e){if(e&&s in e)return e[s];throw new Error("Missing required key ("+s+") in object: "+O(e))},qs=function(s){if(typeof s!="object"||s===null)return O(s);const e=[];for(const n in s)e.push(n);e.sort();let t="{";for(let n=0;n<e.length;n++)n!==0&&(t+=","),t+=O(e[n]),t+=":",t+=qs(s[e[n]]);return t+="}",t},Ii=function(s,e){const t=s.length;if(t<=e)return[s];const n=[];for(let r=0;r<t;r+=e)r+e>t?n.push(s.substring(r,t)):n.push(s.substring(r,r+e));return n};function H(s,e){for(const t in s)s.hasOwnProperty(t)&&e(t,s[t])}const Pi=function(s){x(!Ws(s),"Invalid JSON number");const e=11,t=52,n=(1<<e-1)-1;let r,o,a,l,d;s===0?(o=0,a=0,r=1/s===-1/0?1:0):(r=s<0,s=Math.abs(s),s>=Math.pow(2,1-n)?(l=Math.min(Math.floor(Math.log(s)/Math.LN2),n),o=l+n,a=Math.round(s*Math.pow(2,t-l)-Math.pow(2,t))):(o=0,a=Math.round(s/Math.pow(2,1-n-t))));const c=[];for(d=t;d;d-=1)c.push(a%2?1:0),a=Math.floor(a/2);for(d=e;d;d-=1)c.push(o%2?1:0),o=Math.floor(o/2);c.push(r?1:0),c.reverse();const u=c.join("");let h="";for(d=0;d<64;d+=8){let m=parseInt(u.substr(d,8),2).toString(16);m.length===1&&(m="0"+m),h=h+m}return h.toLowerCase()},Ia=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Pa=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Ta(s,e){let t="Unknown Error";s==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":s==="permission_denied"?t="Client doesn't have permission to access the desired data.":s==="unavailable"&&(t="The service is unavailable");const n=new Error(s+" at "+e._path.toString()+": "+t);return n.code=s.toUpperCase(),n}const Ra=new RegExp("^-?(0*)\\d{1,10}$"),Aa=-2147483648,Da=2147483647,Rn=function(s){if(Ra.test(s)){const e=Number(s);if(e>=Aa&&e<=Da)return e}return null},ze=function(s){try{s()}catch(e){setTimeout(()=>{const t=e.stack||"";throw $("Exception was thrown by user callback.",t),e},Math.floor(0))}},Ma=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},et=function(s,e){const t=setTimeout(s,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(n=>this.appCheck=n)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){$(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fa{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(z("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',$(e)}}class It{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}It.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Us="5",Ti="v",Ri="s",Ai="r",Di="f",Mi=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Li="ls",Fi="p",_s="ac",Oi="websocket",Wi="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e,t,n,r,o=!1,a="",l=!1,d=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=o,this.persistenceKey=a,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=d,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=_e.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&_e.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Oa(s){return s.host!==s.internalHost||s.isCustomHost()||s.includeNamespaceInQueryParams}function Ui(s,e,t){x(typeof e=="string","typeof type must == string"),x(typeof t=="object","typeof params must == object");let n;if(e===Oi)n=(s.secure?"wss://":"ws://")+s.internalHost+"/.ws?";else if(e===Wi)n=(s.secure?"https://":"http://")+s.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Oa(s)&&(t.ns=s.namespace);const r=[];return H(t,(o,a)=>{r.push(o+"="+a)}),n+r.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa{constructor(){this.counters_={}}incrementCounter(e,t=1){se(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return xo(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ls={},cs={};function zs(s){const e=s.toString();return ls[e]||(ls[e]=new Wa),ls[e]}function qa(s,e){const t=s.toString();return cs[t]||(cs[t]=e()),cs[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<n.length;++r)n[r]&&ze(()=>{this.onMessage_(n[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const An="start",za="close",Ha="pLPCommand",Va="pRTLPCB",zi="id",Hi="pw",Vi="ser",Ya="cb",Ga="seg",Ba="ts",$a="d",Ka="dframe",Yi=1870,Gi=30,Qa=Yi-Gi,Xa=25e3,Ja=3e4;class Pe{constructor(e,t,n,r,o,a,l){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=o,this.transportSessionId=a,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=gt(e),this.stats_=zs(t),this.urlFn=d=>(this.appCheckToken&&(d[_s]=this.appCheckToken),Ui(t,Wi,d))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ua(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Ja)),Ea(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Hs((...o)=>{const[a,l,d,c,u]=o;if(this.incrementIncomingBytes_(o),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,a===An)this.id=l,this.password=d;else if(a===za)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+a)},(...o)=>{const[a,l]=o;this.incrementIncomingBytes_(o),this.myPacketOrderer.handleResponse(a,l)},()=>{this.onClosed_()},this.urlFn);const n={};n[An]="t",n[Vi]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[Ya]=this.scriptTagHolder.uniqueCallbackIdentifier),n[Ti]=Us,this.transportSessionId&&(n[Ri]=this.transportSessionId),this.lastSessionId&&(n[Li]=this.lastSessionId),this.applicationId&&(n[Fi]=this.applicationId),this.appCheckToken&&(n[_s]=this.appCheckToken),typeof location<"u"&&location.hostname&&Mi.test(location.hostname)&&(n[Ai]=Di);const r=this.urlFn(n);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Pe.forceAllow_=!0}static forceDisallow(){Pe.forceDisallow_=!0}static isAvailable(){return Pe.forceAllow_?!0:!Pe.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Ia()&&!Pa()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=O(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=yo(t),r=Ii(n,Qa);for(let o=0;o<r.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[o]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={};n[Ka]="t",n[zi]=e,n[Hi]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=O(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Hs{constructor(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=ja(),window[Ha+this.uniqueCallbackIdentifier]=e,window[Va+this.uniqueCallbackIdentifier]=t,this.myIFrame=Hs.createIFrame_();let o="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(o='<script>document.domain="'+document.domain+'";<\/script>');const a="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(l){z("frame writing exception"),l.stack&&z(l.stack),z(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||z("No IE domain setting required")}catch{const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[zi]=this.myID,e[Hi]=this.myPW,e[Vi]=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Gi+n.length<=Yi;){const a=this.pendingSegs.shift();n=n+"&"+Ga+r+"="+a.seg+"&"+Ba+r+"="+a.ts+"&"+$a+r+"="+a.d,r++}return t=t+n,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(Xa)),o=()=>{clearTimeout(r),n()};this.addTag(e,o)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const r=n.readyState;(!r||r==="loaded"||r==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{z("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Za=16384,el=45e3;let At=null;typeof MozWebSocket<"u"?At=MozWebSocket:typeof WebSocket<"u"&&(At=WebSocket);class Z{constructor(e,t,n,r,o,a,l){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=gt(this.connId),this.stats_=zs(t),this.connURL=Z.connectionURL_(t,a,l,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,o){const a={};return a[Ti]=Us,typeof location<"u"&&location.hostname&&Mi.test(location.hostname)&&(a[Ai]=Di),t&&(a[Ri]=t),n&&(a[Li]=n),r&&(a[_s]=r),o&&(a[Fi]=o),Ui(e,Oi,a)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,_e.set("previous_websocket_failure",!0);try{let n;mi(),this.mySock=new At(this.connURL,[],n)}catch(n){this.log_("Error instantiating WebSocket.");const r=n.message||n.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=n=>{this.handleIncomingFrame(n)},this.mySock.onerror=n=>{this.log_("WebSocket error.  Closing connection.");const r=n.message||n.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){Z.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&At!==null&&!Z.forceDisallow_}static previouslyFailed(){return _e.isInMemoryStorage||_e.get("previous_websocket_failure")===!0}markConnectionHealthy(){_e.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const n=Ps(t);this.onMessage(n)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(x(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const n=this.extractFrameCount_(t);n!==null&&this.appendFrame_(n)}}send(e){this.resetKeepAlive();const t=O(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Ii(t,Za);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(el))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Z.responsesRequiredToBeHealthy=2;Z.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rt{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Pe,Z]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=Z&&Z.isAvailable();let n=t&&!Z.previouslyFailed();if(e.webSocketOnly&&(t||$("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Z];else{const r=this.transports_=[];for(const o of rt.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);rt.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}rt.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tl=6e4,sl=5e3,nl=10*1024,il=100*1024,ds="t",Dn="d",rl="s",Mn="r",ol="e",Ln="o",Fn="a",On="n",Wn="p",al="h";class ll{constructor(e,t,n,r,o,a,l,d,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=o,this.onMessage_=a,this.onReady_=l,this.onDisconnect_=d,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=gt("c:"+this.id+":"),this.transportManager_=new rt(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=et(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>il?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>nl?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(ds in e){const t=e[ds];t===Fn?this.upgradeIfSecondaryHealthy_():t===Mn?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Ln&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Ge("t",e),n=Ge("d",e);if(t==="c")this.onSecondaryControl_(n);else if(t==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Wn,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Fn,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:On,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Ge("t",e),n=Ge("d",e);t==="c"?this.onControl_(n):t==="d"&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Ge(ds,e);if(Dn in e){const n=e[Dn];if(t===al){const r=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===On){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===rl?this.onConnectionShutdown_(n):t===Mn?this.onReset_(n):t===ol?xs("Server Error: "+n):t===Ln?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):xs("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Us!==n&&$("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),et(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(tl))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):et(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(sl))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Wn,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(_e.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(e){this.allowedEvents_=e,this.listeners_={},x(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let r=0;r<n.length;r++)n[r].callback.apply(n[r].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let o=0;o<r.length;o++)if(r[o].callback===t&&(!n||n===r[o].context)){r.splice(o,1);return}}validateEventType_(e){x(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt extends $i{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!fi()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Dt}getInitialEvent(e){return x(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qn=32,Un=768;class T{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let n=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function k(){return new T("")}function S(s){return s.pieceNum_>=s.pieces_.length?null:s.pieces_[s.pieceNum_]}function fe(s){return s.pieces_.length-s.pieceNum_}function A(s){let e=s.pieceNum_;return e<s.pieces_.length&&e++,new T(s.pieces_,e)}function Vs(s){return s.pieceNum_<s.pieces_.length?s.pieces_[s.pieces_.length-1]:null}function cl(s){let e="";for(let t=s.pieceNum_;t<s.pieces_.length;t++)s.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(s.pieces_[t])));return e||"/"}function ot(s,e=0){return s.pieces_.slice(s.pieceNum_+e)}function Ki(s){if(s.pieceNum_>=s.pieces_.length)return null;const e=[];for(let t=s.pieceNum_;t<s.pieces_.length-1;t++)e.push(s.pieces_[t]);return new T(e,0)}function D(s,e){const t=[];for(let n=s.pieceNum_;n<s.pieces_.length;n++)t.push(s.pieces_[n]);if(e instanceof T)for(let n=e.pieceNum_;n<e.pieces_.length;n++)t.push(e.pieces_[n]);else{const n=e.split("/");for(let r=0;r<n.length;r++)n[r].length>0&&t.push(n[r])}return new T(t,0)}function C(s){return s.pieceNum_>=s.pieces_.length}function G(s,e){const t=S(s),n=S(e);if(t===null)return e;if(t===n)return G(A(s),A(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+s+")")}function dl(s,e){const t=ot(s,0),n=ot(e,0);for(let r=0;r<t.length&&r<n.length;r++){const o=Ce(t[r],n[r]);if(o!==0)return o}return t.length===n.length?0:t.length<n.length?-1:1}function Qi(s,e){if(fe(s)!==fe(e))return!1;for(let t=s.pieceNum_,n=e.pieceNum_;t<=s.pieces_.length;t++,n++)if(s.pieces_[t]!==e.pieces_[n])return!1;return!0}function X(s,e){let t=s.pieceNum_,n=e.pieceNum_;if(fe(s)>fe(e))return!1;for(;t<s.pieces_.length;){if(s.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0}class hl{constructor(e,t){this.errorPrefix_=t,this.parts_=ot(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=Bt(this.parts_[n]);Xi(this)}}function ul(s,e){s.parts_.length>0&&(s.byteLength_+=1),s.parts_.push(e),s.byteLength_+=Bt(e),Xi(s)}function ml(s){const e=s.parts_.pop();s.byteLength_-=Bt(e),s.parts_.length>0&&(s.byteLength_-=1)}function Xi(s){if(s.byteLength_>Un)throw new Error(s.errorPrefix_+"has a key path longer than "+Un+" bytes ("+s.byteLength_+").");if(s.parts_.length>qn)throw new Error(s.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+qn+") or object contains a cycle "+xe(s))}function xe(s){return s.parts_.length===0?"":"in property '"+s.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys extends $i{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const n=!document[e];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}static getInstance(){return new Ys}getInitialEvent(e){return x(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Be=1e3,fl=60*5*1e3,zn=30*1e3,pl=1.3,gl=3e4,xl="server_kill",Hn=3;class re extends Bi{constructor(e,t,n,r,o,a,l,d){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=d,this.id=re.nextPersistentConnectionId_++,this.log_=gt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Be,this.maxReconnectDelay_=fl,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,d&&!mi())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ys.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Dt.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,o={r,a:e,b:t};this.log_(O(o)),x(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new Gt,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:a=>{const l=a.d;a.s==="ok"?t.resolve(l):t.reject(l)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),t.promise}listen(e,t,n,r){this.initConnection_();const o=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),x(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),x(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");const l={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const o={p:n},a="q";e.tag&&(o.q=t._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest(a,o,l=>{const d=l.d,c=l.s;re.warnOnListenWarnings_(d,t),(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",l),c!=="ok"&&this.removeListen_(n,r),e.onComplete&&e.onComplete(c,d))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&se(e,"w")){const n=Ae(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',o=t._path.toString();$(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||mo(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=zn)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=fo(e)?"auth":"gauth",n={cred:e};this.authOverride_===null?n.noauth=!0:typeof this.authOverride_=="object"&&(n.authvar=this.authOverride_),this.sendRequest(t,n,r=>{const o=r.s,a=r.d||"error";this.authToken_===e&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),x(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const o={p:e},a="n";r&&(o.q=n,o.t=r),this.sendRequest(a,o)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const o={p:t,d:n};this.log_("onDisconnect "+e,o),this.sendRequest(e,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,o){this.initConnection_();const a={p:t,d:n};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:e,request:a,onComplete:r}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,o=>{this.log_(t+" response",o),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,n=>{if(n.s!=="ok"){const o=n.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+O(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):xs("Unrecognized action received from server: "+O(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){x(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Be,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Be,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>gl&&(this.reconnectDelay_=Be),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*pl)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+re.nextConnectionId_++,o=this.lastSessionId;let a=!1,l=null;const d=function(){l?l.close():(a=!0,n())},c=function(h){x(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:d,sendRequest:c};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,m]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);a?z("getToken() completed but was canceled"):(z("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=m&&m.token,l=new ll(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,p=>{$(p+" ("+this.repoInfo_.toString()+")"),this.interrupt(xl)},o))}catch(h){this.log_("Failed to get token: "+h),a||(this.repoInfo_.nodeAdmin&&$(h),d())}}}interrupt(e){z("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){z("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Sn(this.interruptReasons_)&&(this.reconnectDelay_=Be,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;t?n=t.map(o=>qs(o)).join("$"):n="default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new T(e).toString();let r;if(this.listens.has(n)){const o=this.listens.get(n);r=o.get(t),o.delete(t),o.size===0&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){z("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Hn&&(this.reconnectDelay_=zn,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){z("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Hn&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Si.replace(/\./g,"-")]=1,fi()?e["framework.cordova"]=1:po()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Dt.getInstance().currentlyOnline();return Sn(this.interruptReasons_)&&e}}re.nextPersistentConnectionId_=0;re.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new j(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new j(De,e),r=new j(De,t);return this.compare(n,r)!==0}minPost(){return j.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bt;class Ji extends Qt{static get __EMPTY_NODE(){return bt}static set __EMPTY_NODE(e){bt=e}compare(e,t){return Ce(e.name,t.name)}isDefinedOn(e){throw mt("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return j.MIN}maxPost(){return new j(ve,bt)}makePost(e,t){return x(typeof e=="string","KeyIndex indexValue must always be a string."),new j(e,bt)}toString(){return".key"}}const Re=new Ji;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nt{constructor(e,t,n,r,o=null){this.isReverse_=r,this.resultGenerator_=o,this.nodeStack_=[];let a=1;for(;!e.isEmpty();)if(e=e,a=t?n(e.key,t):1,r&&(a*=-1),a<0)this.isReverse_?e=e.left:e=e.right;else if(a===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class q{constructor(e,t,n,r,o){this.key=e,this.value=t,this.color=n??q.RED,this.left=r??K.EMPTY_NODE,this.right=o??K.EMPTY_NODE}copy(e,t,n,r,o){return new q(e??this.key,t??this.value,n??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const o=n(e,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(e,t,n),null):o===0?r=r.copy(null,t,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return K.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),t(e,n.key)===0){if(n.right.isEmpty())return K.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,q.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,q.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}q.RED=!0;q.BLACK=!1;class _l{copy(e,t,n,r,o){return this}insert(e,t,n){return new q(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class K{constructor(e,t=K.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new K(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,q.BLACK,null,null))}remove(e){return new K(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,q.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),t===0)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();)if(t=this.comparator_(e,n.key),t===0){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else t<0?n=n.left:t>0&&(r=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Nt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Nt(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Nt(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Nt(this.root_,null,this.comparator_,!0,e)}}K.EMPTY_NODE=new _l;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yl(s,e){return Ce(s.name,e.name)}function Gs(s,e){return Ce(s,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ys;function vl(s){ys=s}const Zi=function(s){return typeof s=="number"?"number:"+Pi(s):"string:"+s},er=function(s){if(s.isLeafNode()){const e=s.val();x(typeof e=="string"||typeof e=="number"||typeof e=="object"&&se(e,".sv"),"Priority must be a string or number.")}else x(s===ys||s.isEmpty(),"priority of unexpected type.");x(s===ys||s.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vn;class W{constructor(e,t=W.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,x(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),er(this.priorityNode_)}static set __childrenNodeConstructor(e){Vn=e}static get __childrenNodeConstructor(){return Vn}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new W(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:W.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return C(e)?this:S(e)===".priority"?this.priorityNode_:W.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:W.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=S(e);return n===null?t:t.isEmpty()&&n!==".priority"?this:(x(n!==".priority"||fe(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(n,W.__childrenNodeConstructor.EMPTY_NODE.updateChild(A(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Zi(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=Pi(this.value_):e+=this.value_,this.lazyHash_=ki(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===W.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof W.__childrenNodeConstructor?-1:(x(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=W.VALUE_TYPE_ORDER.indexOf(t),o=W.VALUE_TYPE_ORDER.indexOf(n);return x(r>=0,"Unknown leaf type: "+t),x(o>=0,"Unknown leaf type: "+n),r===o?n==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}W.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tr,sr;function wl(s){tr=s}function bl(s){sr=s}class Nl extends Qt{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),o=n.compareTo(r);return o===0?Ce(e.name,t.name):o}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return j.MIN}maxPost(){return new j(ve,new W("[PRIORITY-POST]",sr))}makePost(e,t){const n=tr(e);return new j(t,new W("[PRIORITY-POST]",n))}toString(){return".priority"}}const M=new Nl;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jl=Math.log(2);class Cl{constructor(e){const t=o=>parseInt(Math.log(o)/jl,10),n=o=>parseInt(Array(o+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const r=n(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Mt=function(s,e,t,n){s.sort(e);const r=function(d,c){const u=c-d;let h,m;if(u===0)return null;if(u===1)return h=s[d],m=t?t(h):h,new q(m,h.node,q.BLACK,null,null);{const p=parseInt(u/2,10)+d,f=r(d,p),_=r(p+1,c);return h=s[p],m=t?t(h):h,new q(m,h.node,q.BLACK,f,_)}},o=function(d){let c=null,u=null,h=s.length;const m=function(f,_){const v=h-f,N=h;h-=f;const y=r(v+1,N),E=s[v],Y=t?t(E):E;p(new q(Y,E.node,_,null,y))},p=function(f){c?(c.left=f,c=f):(u=f,c=f)};for(let f=0;f<d.count;++f){const _=d.nextBitIsOne(),v=Math.pow(2,d.count-(f+1));_?m(v,q.BLACK):(m(v,q.BLACK),m(v,q.RED))}return u},a=new Cl(s.length),l=o(a);return new K(n||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hs;const Ie={};class ie{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return x(Ie&&M,"ChildrenNode.ts has not been loaded"),hs=hs||new ie({".priority":Ie},{".priority":M}),hs}get(e){const t=Ae(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof K?t:null}hasIndex(e){return se(this.indexSet_,e.toString())}addIndex(e,t){x(e!==Re,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const o=t.getIterator(j.Wrap);let a=o.getNext();for(;a;)r=r||e.isDefinedOn(a.node),n.push(a),a=o.getNext();let l;r?l=Mt(n,e.getCompare()):l=Ie;const d=e.toString(),c=Object.assign({},this.indexSet_);c[d]=e;const u=Object.assign({},this.indexes_);return u[d]=l,new ie(u,c)}addToIndexes(e,t){const n=Pt(this.indexes_,(r,o)=>{const a=Ae(this.indexSet_,o);if(x(a,"Missing index implementation for "+o),r===Ie)if(a.isDefinedOn(e.node)){const l=[],d=t.getIterator(j.Wrap);let c=d.getNext();for(;c;)c.name!==e.name&&l.push(c),c=d.getNext();return l.push(e),Mt(l,a.getCompare())}else return Ie;else{const l=t.get(e.name);let d=r;return l&&(d=d.remove(new j(e.name,l))),d.insert(e,e.node)}});return new ie(n,this.indexSet_)}removeFromIndexes(e,t){const n=Pt(this.indexes_,r=>{if(r===Ie)return r;{const o=t.get(e.name);return o?r.remove(new j(e.name,o)):r}});return new ie(n,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $e;class b{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&er(this.priorityNode_),this.children_.isEmpty()&&x(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return $e||($e=new b(new K(Gs),null,ie.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||$e}updatePriority(e){return this.children_.isEmpty()?this:new b(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?$e:t}}getChild(e){const t=S(e);return t===null?this:this.getImmediateChild(t).getChild(A(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(x(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const n=new j(e,t);let r,o;t.isEmpty()?(r=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),o=this.indexMap_.addToIndexes(n,this.children_));const a=r.isEmpty()?$e:this.priorityNode_;return new b(r,a,o)}}updateChild(e,t){const n=S(e);if(n===null)return t;{x(S(e)!==".priority"||fe(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(A(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,o=!0;if(this.forEachChild(M,(a,l)=>{t[a]=l.val(e),n++,o&&b.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!e&&o&&r<2*n){const a=[];for(const l in t)a[l]=t[l];return a}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Zi(this.getPriority().val())+":"),this.forEachChild(M,(t,n)=>{const r=n.hash();r!==""&&(e+=":"+t+":"+r)}),this.lazyHash_=e===""?"":ki(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const o=r.getPredecessorKey(new j(e,t));return o?o.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const n=t.minKey();return n&&n.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new j(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const n=t.maxKey();return n&&n.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new j(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(r=>t(r.name,r.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,j.Wrap);let o=r.peek();for(;o!=null&&t.compare(o,e)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,j.Wrap);let o=r.peek();for(;o!=null&&t.compare(o,e)>0;)r.getNext(),o=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===xt?-1:0}withIndex(e){if(e===Re||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new b(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Re||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const n=this.getIterator(M),r=t.getIterator(M);let o=n.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=n.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(e){return e===Re?null:this.indexMap_.get(e.toString())}}b.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Sl extends b{constructor(){super(new K(Gs),b.EMPTY_NODE,ie.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return b.EMPTY_NODE}isEmpty(){return!1}}const xt=new Sl;Object.defineProperties(j,{MIN:{value:new j(De,b.EMPTY_NODE)},MAX:{value:new j(ve,xt)}});Ji.__EMPTY_NODE=b.EMPTY_NODE;W.__childrenNodeConstructor=b;vl(xt);bl(xt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const El=!0;function F(s,e=null){if(s===null)return b.EMPTY_NODE;if(typeof s=="object"&&".priority"in s&&(e=s[".priority"]),x(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof s=="object"&&".value"in s&&s[".value"]!==null&&(s=s[".value"]),typeof s!="object"||".sv"in s){const t=s;return new W(t,F(e))}if(!(s instanceof Array)&&El){const t=[];let n=!1;if(H(s,(a,l)=>{if(a.substring(0,1)!=="."){const d=F(l);d.isEmpty()||(n=n||!d.getPriority().isEmpty(),t.push(new j(a,d)))}}),t.length===0)return b.EMPTY_NODE;const o=Mt(t,yl,a=>a.name,Gs);if(n){const a=Mt(t,M.getCompare());return new b(o,F(e),new ie({".priority":a},{".priority":M}))}else return new b(o,F(e),ie.Default)}else{let t=b.EMPTY_NODE;return H(s,(n,r)=>{if(se(s,n)&&n.substring(0,1)!=="."){const o=F(r);(o.isLeafNode()||!o.isEmpty())&&(t=t.updateImmediateChild(n,o))}}),t.updatePriority(F(e))}}wl(F);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl extends Qt{constructor(e){super(),this.indexPath_=e,x(!C(e)&&S(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),o=n.compareTo(r);return o===0?Ce(e.name,t.name):o}makePost(e,t){const n=F(e),r=b.EMPTY_NODE.updateChild(this.indexPath_,n);return new j(t,r)}maxPost(){const e=b.EMPTY_NODE.updateChild(this.indexPath_,xt);return new j(ve,e)}toString(){return ot(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il extends Qt{compare(e,t){const n=e.node.compareTo(t.node);return n===0?Ce(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return j.MIN}maxPost(){return j.MAX}makePost(e,t){const n=F(e);return new j(t,n)}toString(){return".value"}}const Pl=new Il;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nr(s){return{type:"value",snapshotNode:s}}function Me(s,e){return{type:"child_added",snapshotNode:e,childName:s}}function at(s,e){return{type:"child_removed",snapshotNode:e,childName:s}}function lt(s,e,t){return{type:"child_changed",snapshotNode:e,childName:s,oldSnap:t}}function Tl(s,e){return{type:"child_moved",snapshotNode:e,childName:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bs{constructor(e){this.index_=e}updateChild(e,t,n,r,o,a){x(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(t);return l.getChild(r).equals(n.getChild(r))&&l.isEmpty()===n.isEmpty()||(a!=null&&(n.isEmpty()?e.hasChild(t)?a.trackChildChange(at(t,l)):x(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?a.trackChildChange(Me(t,n)):a.trackChildChange(lt(t,n,l))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return n!=null&&(e.isLeafNode()||e.forEachChild(M,(r,o)=>{t.hasChild(r)||n.trackChildChange(at(r,o))}),t.isLeafNode()||t.forEachChild(M,(r,o)=>{if(e.hasChild(r)){const a=e.getImmediateChild(r);a.equals(o)||n.trackChildChange(lt(r,o,a))}else n.trackChildChange(Me(r,o))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?b.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(e){this.indexedFilter_=new Bs(e.getIndex()),this.index_=e.getIndex(),this.startPost_=ct.getStartPost_(e),this.endPost_=ct.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,o,a){return this.matches(new j(t,n))||(n=b.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,o,a)}updateFullNode(e,t,n){t.isLeafNode()&&(t=b.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(b.EMPTY_NODE);const o=this;return t.forEachChild(M,(a,l)=>{o.matches(new j(a,l))||(r=r.updateImmediateChild(a,b.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rl{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const n=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=t=>{const n=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new ct(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,o,a){return this.rangedFilter_.matches(new j(t,n))||(n=b.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,o,a):this.fullLimitUpdateChild_(e,t,n,o,a)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=b.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=b.EMPTY_NODE.withIndex(this.index_);let o;this.reverse_?o=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let a=0;for(;o.hasNext()&&a<this.limit_;){const l=o.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))r=r.updateImmediateChild(l.name,l.node),a++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(b.EMPTY_NODE);let o;this.reverse_?o=r.getReverseIterator(this.index_):o=r.getIterator(this.index_);let a=0;for(;o.hasNext();){const l=o.getNext();a<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?a++:r=r.updateImmediateChild(l.name,b.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,o){let a;if(this.reverse_){const h=this.index_.getCompare();a=(m,p)=>h(p,m)}else a=this.index_.getCompare();const l=e;x(l.numChildren()===this.limit_,"");const d=new j(t,n),c=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),u=this.rangedFilter_.matches(d);if(l.hasChild(t)){const h=l.getImmediateChild(t);let m=r.getChildAfterChild(this.index_,c,this.reverse_);for(;m!=null&&(m.name===t||l.hasChild(m.name));)m=r.getChildAfterChild(this.index_,m,this.reverse_);const p=m==null?1:a(m,d);if(u&&!n.isEmpty()&&p>=0)return o?.trackChildChange(lt(t,n,h)),l.updateImmediateChild(t,n);{o?.trackChildChange(at(t,h));const _=l.updateImmediateChild(t,b.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(o?.trackChildChange(Me(m.name,m.node)),_.updateImmediateChild(m.name,m.node)):_}}else return n.isEmpty()?e:u&&a(c,d)>=0?(o!=null&&(o.trackChildChange(at(c.name,c.node)),o.trackChildChange(Me(t,n))),l.updateImmediateChild(t,n).updateImmediateChild(c.name,b.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=M}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return x(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return x(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:De}hasEnd(){return this.endSet_}getIndexEndValue(){return x(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return x(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ve}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return x(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===M}copy(){const e=new $s;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Al(s){return s.loadsAllData()?new Bs(s.getIndex()):s.hasLimit()?new Rl(s):new ct(s)}function Yn(s){const e={};if(s.isDefault())return e;let t;if(s.index_===M?t="$priority":s.index_===Pl?t="$value":s.index_===Re?t="$key":(x(s.index_ instanceof kl,"Unrecognized index type!"),t=s.index_.toString()),e.orderBy=O(t),s.startSet_){const n=s.startAfterSet_?"startAfter":"startAt";e[n]=O(s.indexStartValue_),s.startNameSet_&&(e[n]+=","+O(s.indexStartName_))}if(s.endSet_){const n=s.endBeforeSet_?"endBefore":"endAt";e[n]=O(s.indexEndValue_),s.endNameSet_&&(e[n]+=","+O(s.indexEndName_))}return s.limitSet_&&(s.isViewFromLeft()?e.limitToFirst=s.limit_:e.limitToLast=s.limit_),e}function Gn(s){const e={};if(s.startSet_&&(e.sp=s.indexStartValue_,s.startNameSet_&&(e.sn=s.indexStartName_),e.sin=!s.startAfterSet_),s.endSet_&&(e.ep=s.indexEndValue_,s.endNameSet_&&(e.en=s.indexEndName_),e.ein=!s.endBeforeSet_),s.limitSet_){e.l=s.limit_;let t=s.viewFrom_;t===""&&(s.isViewFromLeft()?t="l":t="r"),e.vf=t}return s.index_!==M&&(e.i=s.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt extends Bi{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=gt("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(x(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);const a=Lt.getListenId_(e,n),l={};this.listens_[a]=l;const d=Yn(e._queryParams);this.restRequest_(o+".json",d,(c,u)=>{let h=u;if(c===404&&(h=null,c=null),c===null&&this.onDataUpdate_(o,h,!1,n),Ae(this.listens_,a)===l){let m;c?c===401?m="permission_denied":m="rest_error:"+c:m="ok",r(m,null)}})}unlisten(e,t){const n=Lt.getListenId_(e,t);delete this.listens_[n]}get(e){const t=Yn(e._queryParams),n=e._path.toString(),r=new Gt;return this.restRequest_(n+".json",t,(o,a)=>{let l=a;o===404&&(l=null,o=null),o===null?(this.onDataUpdate_(n,l,!1,null),r.resolve(l)):r.reject(new Error(l))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,o])=>{r&&r.accessToken&&(t.auth=r.accessToken),o&&o.token&&(t.ac=o.token);const a=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+go(t);this.log_("Sending REST request for "+a);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(n&&l.readyState===4){this.log_("REST Response for "+a+" received. status:",l.status,"response:",l.responseText);let d=null;if(l.status>=200&&l.status<300){try{d=Ps(l.responseText)}catch{$("Failed to parse JSON response for "+a+": "+l.responseText)}n(null,d)}else l.status!==401&&l.status!==404&&$("Got unsuccessful REST response for "+a+" Status: "+l.status),n(l.status);n=null}},l.open("GET",a,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dl{constructor(){this.rootNode_=b.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ft(){return{value:null,children:new Map}}function ir(s,e,t){if(C(e))s.value=t,s.children.clear();else if(s.value!==null)s.value=s.value.updateChild(e,t);else{const n=S(e);s.children.has(n)||s.children.set(n,Ft());const r=s.children.get(n);e=A(e),ir(r,e,t)}}function vs(s,e,t){s.value!==null?t(e,s.value):Ml(s,(n,r)=>{const o=new T(e.toString()+"/"+n);vs(r,o,t)})}function Ml(s,e){s.children.forEach((t,n)=>{e(n,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ll{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&H(this.last_,(n,r)=>{t[n]=t[n]-r}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bn=10*1e3,Fl=30*1e3,Ol=5*60*1e3;class Wl{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Ll(e);const n=Bn+(Fl-Bn)*Math.random();et(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;H(e,(r,o)=>{o>0&&se(this.statsToReport_,r)&&(t[r]=o,n=!0)}),n&&this.server_.reportStats(t),et(this.reportStats_.bind(this),Math.floor(Math.random()*2*Ol))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ee;(function(s){s[s.OVERWRITE=0]="OVERWRITE",s[s.MERGE=1]="MERGE",s[s.ACK_USER_WRITE=2]="ACK_USER_WRITE",s[s.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(ee||(ee={}));function Ks(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Qs(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Xs(s){return{fromUser:!1,fromServer:!0,queryId:s,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=ee.ACK_USER_WRITE,this.source=Ks()}operationForChild(e){if(C(this.path)){if(this.affectedTree.value!=null)return x(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new T(e));return new Ot(k(),t,this.revert)}}else return x(S(this.path)===e,"operationForChild called for unrelated child."),new Ot(A(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dt{constructor(e,t){this.source=e,this.path=t,this.type=ee.LISTEN_COMPLETE}operationForChild(e){return C(this.path)?new dt(this.source,k()):new dt(this.source,A(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=ee.OVERWRITE}operationForChild(e){return C(this.path)?new we(this.source,k(),this.snap.getImmediateChild(e)):new we(this.source,A(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=ee.MERGE}operationForChild(e){if(C(this.path)){const t=this.children.subtree(new T(e));return t.isEmpty()?null:t.value?new we(this.source,k(),t.value):new Le(this.source,k(),t)}else return x(S(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Le(this.source,A(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pe{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(C(e))return this.isFullyInitialized()&&!this.filtered_;const t=S(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ql{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Ul(s,e,t,n){const r=[],o=[];return e.forEach(a=>{a.type==="child_changed"&&s.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&o.push(Tl(a.childName,a.snapshotNode))}),Ke(s,r,"child_removed",e,n,t),Ke(s,r,"child_added",e,n,t),Ke(s,r,"child_moved",o,n,t),Ke(s,r,"child_changed",e,n,t),Ke(s,r,"value",e,n,t),r}function Ke(s,e,t,n,r,o){const a=n.filter(l=>l.type===t);a.sort((l,d)=>Hl(s,l,d)),a.forEach(l=>{const d=zl(s,l,o);r.forEach(c=>{c.respondsTo(l.type)&&e.push(c.createEvent(d,s.query_))})})}function zl(s,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,s.index_)),e}function Hl(s,e,t){if(e.childName==null||t.childName==null)throw mt("Should only compare child_ events.");const n=new j(e.childName,e.snapshotNode),r=new j(t.childName,t.snapshotNode);return s.index_.compare(n,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xt(s,e){return{eventCache:s,serverCache:e}}function tt(s,e,t,n){return Xt(new pe(e,t,n),s.serverCache)}function rr(s,e,t,n){return Xt(s.eventCache,new pe(e,t,n))}function Wt(s){return s.eventCache.isFullyInitialized()?s.eventCache.getNode():null}function be(s){return s.serverCache.isFullyInitialized()?s.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let us;const Vl=()=>(us||(us=new K(ka)),us);class R{constructor(e,t=Vl()){this.value=e,this.children=t}static fromObject(e){let t=new R(null);return H(e,(n,r)=>{t=t.set(new T(n),r)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:k(),value:this.value};if(C(e))return null;{const n=S(e),r=this.children.get(n);if(r!==null){const o=r.findRootMostMatchingPathAndValue(A(e),t);return o!=null?{path:D(new T(n),o.path),value:o.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(C(e))return this;{const t=S(e),n=this.children.get(t);return n!==null?n.subtree(A(e)):new R(null)}}set(e,t){if(C(e))return new R(t,this.children);{const n=S(e),o=(this.children.get(n)||new R(null)).set(A(e),t),a=this.children.insert(n,o);return new R(this.value,a)}}remove(e){if(C(e))return this.children.isEmpty()?new R(null):new R(null,this.children);{const t=S(e),n=this.children.get(t);if(n){const r=n.remove(A(e));let o;return r.isEmpty()?o=this.children.remove(t):o=this.children.insert(t,r),this.value===null&&o.isEmpty()?new R(null):new R(this.value,o)}else return this}}get(e){if(C(e))return this.value;{const t=S(e),n=this.children.get(t);return n?n.get(A(e)):null}}setTree(e,t){if(C(e))return t;{const n=S(e),o=(this.children.get(n)||new R(null)).setTree(A(e),t);let a;return o.isEmpty()?a=this.children.remove(n):a=this.children.insert(n,o),new R(this.value,a)}}fold(e){return this.fold_(k(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((r,o)=>{n[r]=o.fold_(D(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,k(),t)}findOnPath_(e,t,n){const r=this.value?n(t,this.value):!1;if(r)return r;if(C(e))return null;{const o=S(e),a=this.children.get(o);return a?a.findOnPath_(A(e),D(t,o),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,k(),t)}foreachOnPath_(e,t,n){if(C(e))return this;{this.value&&n(t,this.value);const r=S(e),o=this.children.get(r);return o?o.foreachOnPath_(A(e),D(t,r),n):new R(null)}}foreach(e){this.foreach_(k(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(D(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class te{constructor(e){this.writeTree_=e}static empty(){return new te(new R(null))}}function st(s,e,t){if(C(e))return new te(new R(t));{const n=s.writeTree_.findRootMostValueAndPath(e);if(n!=null){const r=n.path;let o=n.value;const a=G(r,e);return o=o.updateChild(a,t),new te(s.writeTree_.set(r,o))}else{const r=new R(t),o=s.writeTree_.setTree(e,r);return new te(o)}}}function ws(s,e,t){let n=s;return H(t,(r,o)=>{n=st(n,D(e,r),o)}),n}function $n(s,e){if(C(e))return te.empty();{const t=s.writeTree_.setTree(e,new R(null));return new te(t)}}function bs(s,e){return Se(s,e)!=null}function Se(s,e){const t=s.writeTree_.findRootMostValueAndPath(e);return t!=null?s.writeTree_.get(t.path).getChild(G(t.path,e)):null}function Kn(s){const e=[],t=s.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(M,(n,r)=>{e.push(new j(n,r))}):s.writeTree_.children.inorderTraversal((n,r)=>{r.value!=null&&e.push(new j(n,r.value))}),e}function ue(s,e){if(C(e))return s;{const t=Se(s,e);return t!=null?new te(new R(t)):new te(s.writeTree_.subtree(e))}}function Ns(s){return s.writeTree_.isEmpty()}function Fe(s,e){return or(k(),s.writeTree_,e)}function or(s,e,t){if(e.value!=null)return t.updateChild(s,e.value);{let n=null;return e.children.inorderTraversal((r,o)=>{r===".priority"?(x(o.value!==null,"Priority writes must always be leaf nodes"),n=o.value):t=or(D(s,r),o,t)}),!t.getChild(s).isEmpty()&&n!==null&&(t=t.updateChild(D(s,".priority"),n)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jt(s,e){return dr(e,s)}function Yl(s,e,t,n,r){x(n>s.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),s.allWrites.push({path:e,snap:t,writeId:n,visible:r}),r&&(s.visibleWrites=st(s.visibleWrites,e,t)),s.lastWriteId=n}function Gl(s,e,t,n){x(n>s.lastWriteId,"Stacking an older merge on top of newer ones"),s.allWrites.push({path:e,children:t,writeId:n,visible:!0}),s.visibleWrites=ws(s.visibleWrites,e,t),s.lastWriteId=n}function Bl(s,e){for(let t=0;t<s.allWrites.length;t++){const n=s.allWrites[t];if(n.writeId===e)return n}return null}function $l(s,e){const t=s.allWrites.findIndex(l=>l.writeId===e);x(t>=0,"removeWrite called with nonexistent writeId.");const n=s.allWrites[t];s.allWrites.splice(t,1);let r=n.visible,o=!1,a=s.allWrites.length-1;for(;r&&a>=0;){const l=s.allWrites[a];l.visible&&(a>=t&&Kl(l,n.path)?r=!1:X(n.path,l.path)&&(o=!0)),a--}if(r){if(o)return Ql(s),!0;if(n.snap)s.visibleWrites=$n(s.visibleWrites,n.path);else{const l=n.children;H(l,d=>{s.visibleWrites=$n(s.visibleWrites,D(n.path,d))})}return!0}else return!1}function Kl(s,e){if(s.snap)return X(s.path,e);for(const t in s.children)if(s.children.hasOwnProperty(t)&&X(D(s.path,t),e))return!0;return!1}function Ql(s){s.visibleWrites=ar(s.allWrites,Xl,k()),s.allWrites.length>0?s.lastWriteId=s.allWrites[s.allWrites.length-1].writeId:s.lastWriteId=-1}function Xl(s){return s.visible}function ar(s,e,t){let n=te.empty();for(let r=0;r<s.length;++r){const o=s[r];if(e(o)){const a=o.path;let l;if(o.snap)X(t,a)?(l=G(t,a),n=st(n,l,o.snap)):X(a,t)&&(l=G(a,t),n=st(n,k(),o.snap.getChild(l)));else if(o.children){if(X(t,a))l=G(t,a),n=ws(n,l,o.children);else if(X(a,t))if(l=G(a,t),C(l))n=ws(n,k(),o.children);else{const d=Ae(o.children,S(l));if(d){const c=d.getChild(A(l));n=st(n,k(),c)}}}else throw mt("WriteRecord should have .snap or .children")}}return n}function lr(s,e,t,n,r){if(!n&&!r){const o=Se(s.visibleWrites,e);if(o!=null)return o;{const a=ue(s.visibleWrites,e);if(Ns(a))return t;if(t==null&&!bs(a,k()))return null;{const l=t||b.EMPTY_NODE;return Fe(a,l)}}}else{const o=ue(s.visibleWrites,e);if(!r&&Ns(o))return t;if(!r&&t==null&&!bs(o,k()))return null;{const a=function(c){return(c.visible||r)&&(!n||!~n.indexOf(c.writeId))&&(X(c.path,e)||X(e,c.path))},l=ar(s.allWrites,a,e),d=t||b.EMPTY_NODE;return Fe(l,d)}}}function Jl(s,e,t){let n=b.EMPTY_NODE;const r=Se(s.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(M,(o,a)=>{n=n.updateImmediateChild(o,a)}),n;if(t){const o=ue(s.visibleWrites,e);return t.forEachChild(M,(a,l)=>{const d=Fe(ue(o,new T(a)),l);n=n.updateImmediateChild(a,d)}),Kn(o).forEach(a=>{n=n.updateImmediateChild(a.name,a.node)}),n}else{const o=ue(s.visibleWrites,e);return Kn(o).forEach(a=>{n=n.updateImmediateChild(a.name,a.node)}),n}}function Zl(s,e,t,n,r){x(n||r,"Either existingEventSnap or existingServerSnap must exist");const o=D(e,t);if(bs(s.visibleWrites,o))return null;{const a=ue(s.visibleWrites,o);return Ns(a)?r.getChild(t):Fe(a,r.getChild(t))}}function ec(s,e,t,n){const r=D(e,t),o=Se(s.visibleWrites,r);if(o!=null)return o;if(n.isCompleteForChild(t)){const a=ue(s.visibleWrites,r);return Fe(a,n.getNode().getImmediateChild(t))}else return null}function tc(s,e){return Se(s.visibleWrites,e)}function sc(s,e,t,n,r,o,a){let l;const d=ue(s.visibleWrites,e),c=Se(d,k());if(c!=null)l=c;else if(t!=null)l=Fe(d,t);else return[];if(l=l.withIndex(a),!l.isEmpty()&&!l.isLeafNode()){const u=[],h=a.getCompare(),m=o?l.getReverseIteratorFrom(n,a):l.getIteratorFrom(n,a);let p=m.getNext();for(;p&&u.length<r;)h(p,n)!==0&&u.push(p),p=m.getNext();return u}else return[]}function nc(){return{visibleWrites:te.empty(),allWrites:[],lastWriteId:-1}}function qt(s,e,t,n){return lr(s.writeTree,s.treePath,e,t,n)}function Js(s,e){return Jl(s.writeTree,s.treePath,e)}function Qn(s,e,t,n){return Zl(s.writeTree,s.treePath,e,t,n)}function Ut(s,e){return tc(s.writeTree,D(s.treePath,e))}function ic(s,e,t,n,r,o){return sc(s.writeTree,s.treePath,e,t,n,r,o)}function Zs(s,e,t){return ec(s.writeTree,s.treePath,e,t)}function cr(s,e){return dr(D(s.treePath,e),s.writeTree)}function dr(s,e){return{treePath:s,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;x(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),x(n!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const o=r.type;if(t==="child_added"&&o==="child_removed")this.changeMap.set(n,lt(n,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&o==="child_added")this.changeMap.delete(n);else if(t==="child_removed"&&o==="child_changed")this.changeMap.set(n,at(n,r.oldSnap));else if(t==="child_changed"&&o==="child_added")this.changeMap.set(n,Me(n,e.snapshotNode));else if(t==="child_changed"&&o==="child_changed")this.changeMap.set(n,lt(n,e.snapshotNode,r.oldSnap));else throw mt("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}}const hr=new oc;class en{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const n=this.optCompleteServerCache_!=null?new pe(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Zs(this.writes_,e,n)}}getChildAfterChild(e,t,n){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:be(this.viewCache_),o=ic(this.writes_,r,t,1,n,e);return o.length===0?null:o[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ac(s){return{filter:s}}function lc(s,e){x(e.eventCache.getNode().isIndexed(s.filter.getIndex()),"Event snap not indexed"),x(e.serverCache.getNode().isIndexed(s.filter.getIndex()),"Server snap not indexed")}function cc(s,e,t,n,r){const o=new rc;let a,l;if(t.type===ee.OVERWRITE){const c=t;c.source.fromUser?a=js(s,e,c.path,c.snap,n,r,o):(x(c.source.fromServer,"Unknown source."),l=c.source.tagged||e.serverCache.isFiltered()&&!C(c.path),a=zt(s,e,c.path,c.snap,n,r,l,o))}else if(t.type===ee.MERGE){const c=t;c.source.fromUser?a=hc(s,e,c.path,c.children,n,r,o):(x(c.source.fromServer,"Unknown source."),l=c.source.tagged||e.serverCache.isFiltered(),a=Cs(s,e,c.path,c.children,n,r,l,o))}else if(t.type===ee.ACK_USER_WRITE){const c=t;c.revert?a=fc(s,e,c.path,n,r,o):a=uc(s,e,c.path,c.affectedTree,n,r,o)}else if(t.type===ee.LISTEN_COMPLETE)a=mc(s,e,t.path,n,o);else throw mt("Unknown operation type: "+t.type);const d=o.getChanges();return dc(e,a,d),{viewCache:a,changes:d}}function dc(s,e,t){const n=e.eventCache;if(n.isFullyInitialized()){const r=n.getNode().isLeafNode()||n.getNode().isEmpty(),o=Wt(s);(t.length>0||!s.eventCache.isFullyInitialized()||r&&!n.getNode().equals(o)||!n.getNode().getPriority().equals(o.getPriority()))&&t.push(nr(Wt(e)))}}function ur(s,e,t,n,r,o){const a=e.eventCache;if(Ut(n,t)!=null)return e;{let l,d;if(C(t))if(x(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=be(e),u=c instanceof b?c:b.EMPTY_NODE,h=Js(n,u);l=s.filter.updateFullNode(e.eventCache.getNode(),h,o)}else{const c=qt(n,be(e));l=s.filter.updateFullNode(e.eventCache.getNode(),c,o)}else{const c=S(t);if(c===".priority"){x(fe(t)===1,"Can't have a priority with additional path components");const u=a.getNode();d=e.serverCache.getNode();const h=Qn(n,t,u,d);h!=null?l=s.filter.updatePriority(u,h):l=a.getNode()}else{const u=A(t);let h;if(a.isCompleteForChild(c)){d=e.serverCache.getNode();const m=Qn(n,t,a.getNode(),d);m!=null?h=a.getNode().getImmediateChild(c).updateChild(u,m):h=a.getNode().getImmediateChild(c)}else h=Zs(n,c,e.serverCache);h!=null?l=s.filter.updateChild(a.getNode(),c,h,u,r,o):l=a.getNode()}}return tt(e,l,a.isFullyInitialized()||C(t),s.filter.filtersNodes())}}function zt(s,e,t,n,r,o,a,l){const d=e.serverCache;let c;const u=a?s.filter:s.filter.getIndexedFilter();if(C(t))c=u.updateFullNode(d.getNode(),n,null);else if(u.filtersNodes()&&!d.isFiltered()){const p=d.getNode().updateChild(t,n);c=u.updateFullNode(d.getNode(),p,null)}else{const p=S(t);if(!d.isCompleteForPath(t)&&fe(t)>1)return e;const f=A(t),v=d.getNode().getImmediateChild(p).updateChild(f,n);p===".priority"?c=u.updatePriority(d.getNode(),v):c=u.updateChild(d.getNode(),p,v,f,hr,null)}const h=rr(e,c,d.isFullyInitialized()||C(t),u.filtersNodes()),m=new en(r,h,o);return ur(s,h,t,r,m,l)}function js(s,e,t,n,r,o,a){const l=e.eventCache;let d,c;const u=new en(r,e,o);if(C(t))c=s.filter.updateFullNode(e.eventCache.getNode(),n,a),d=tt(e,c,!0,s.filter.filtersNodes());else{const h=S(t);if(h===".priority")c=s.filter.updatePriority(e.eventCache.getNode(),n),d=tt(e,c,l.isFullyInitialized(),l.isFiltered());else{const m=A(t),p=l.getNode().getImmediateChild(h);let f;if(C(m))f=n;else{const _=u.getCompleteChild(h);_!=null?Vs(m)===".priority"&&_.getChild(Ki(m)).isEmpty()?f=_:f=_.updateChild(m,n):f=b.EMPTY_NODE}if(p.equals(f))d=e;else{const _=s.filter.updateChild(l.getNode(),h,f,m,u,a);d=tt(e,_,l.isFullyInitialized(),s.filter.filtersNodes())}}}return d}function Xn(s,e){return s.eventCache.isCompleteForChild(e)}function hc(s,e,t,n,r,o,a){let l=e;return n.foreach((d,c)=>{const u=D(t,d);Xn(e,S(u))&&(l=js(s,l,u,c,r,o,a))}),n.foreach((d,c)=>{const u=D(t,d);Xn(e,S(u))||(l=js(s,l,u,c,r,o,a))}),l}function Jn(s,e,t){return t.foreach((n,r)=>{e=e.updateChild(n,r)}),e}function Cs(s,e,t,n,r,o,a,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let d=e,c;C(t)?c=n:c=new R(null).setTree(t,n);const u=e.serverCache.getNode();return c.children.inorderTraversal((h,m)=>{if(u.hasChild(h)){const p=e.serverCache.getNode().getImmediateChild(h),f=Jn(s,p,m);d=zt(s,d,new T(h),f,r,o,a,l)}}),c.children.inorderTraversal((h,m)=>{const p=!e.serverCache.isCompleteForChild(h)&&m.value===null;if(!u.hasChild(h)&&!p){const f=e.serverCache.getNode().getImmediateChild(h),_=Jn(s,f,m);d=zt(s,d,new T(h),_,r,o,a,l)}}),d}function uc(s,e,t,n,r,o,a){if(Ut(r,t)!=null)return e;const l=e.serverCache.isFiltered(),d=e.serverCache;if(n.value!=null){if(C(t)&&d.isFullyInitialized()||d.isCompleteForPath(t))return zt(s,e,t,d.getNode().getChild(t),r,o,l,a);if(C(t)){let c=new R(null);return d.getNode().forEachChild(Re,(u,h)=>{c=c.set(new T(u),h)}),Cs(s,e,t,c,r,o,l,a)}else return e}else{let c=new R(null);return n.foreach((u,h)=>{const m=D(t,u);d.isCompleteForPath(m)&&(c=c.set(u,d.getNode().getChild(m)))}),Cs(s,e,t,c,r,o,l,a)}}function mc(s,e,t,n,r){const o=e.serverCache,a=rr(e,o.getNode(),o.isFullyInitialized()||C(t),o.isFiltered());return ur(s,a,t,n,hr,r)}function fc(s,e,t,n,r,o){let a;if(Ut(n,t)!=null)return e;{const l=new en(n,e,r),d=e.eventCache.getNode();let c;if(C(t)||S(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=qt(n,be(e));else{const h=e.serverCache.getNode();x(h instanceof b,"serverChildren would be complete if leaf node"),u=Js(n,h)}u=u,c=s.filter.updateFullNode(d,u,o)}else{const u=S(t);let h=Zs(n,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=d.getImmediateChild(u)),h!=null?c=s.filter.updateChild(d,u,h,A(t),l,o):e.eventCache.getNode().hasChild(u)?c=s.filter.updateChild(d,u,b.EMPTY_NODE,A(t),l,o):c=d,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(a=qt(n,be(e)),a.isLeafNode()&&(c=s.filter.updateFullNode(c,a,o)))}return a=e.serverCache.isFullyInitialized()||Ut(n,k())!=null,tt(e,c,a,s.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new Bs(n.getIndex()),o=Al(n);this.processor_=ac(o);const a=t.serverCache,l=t.eventCache,d=r.updateFullNode(b.EMPTY_NODE,a.getNode(),null),c=o.updateFullNode(b.EMPTY_NODE,l.getNode(),null),u=new pe(d,a.isFullyInitialized(),r.filtersNodes()),h=new pe(c,l.isFullyInitialized(),o.filtersNodes());this.viewCache_=Xt(h,u),this.eventGenerator_=new ql(this.query_)}get query(){return this.query_}}function gc(s){return s.viewCache_.serverCache.getNode()}function xc(s){return Wt(s.viewCache_)}function _c(s,e){const t=be(s.viewCache_);return t&&(s.query._queryParams.loadsAllData()||!C(e)&&!t.getImmediateChild(S(e)).isEmpty())?t.getChild(e):null}function Zn(s){return s.eventRegistrations_.length===0}function yc(s,e){s.eventRegistrations_.push(e)}function ei(s,e,t){const n=[];if(t){x(e==null,"A cancel should cancel all event registrations.");const r=s.query._path;s.eventRegistrations_.forEach(o=>{const a=o.createCancelEvent(t,r);a&&n.push(a)})}if(e){let r=[];for(let o=0;o<s.eventRegistrations_.length;++o){const a=s.eventRegistrations_[o];if(!a.matches(e))r.push(a);else if(e.hasAnyCallback()){r=r.concat(s.eventRegistrations_.slice(o+1));break}}s.eventRegistrations_=r}else s.eventRegistrations_=[];return n}function ti(s,e,t,n){e.type===ee.MERGE&&e.source.queryId!==null&&(x(be(s.viewCache_),"We should always have a full cache before handling merges"),x(Wt(s.viewCache_),"Missing event cache, even though we have a server cache"));const r=s.viewCache_,o=cc(s.processor_,r,e,t,n);return lc(s.processor_,o.viewCache),x(o.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),s.viewCache_=o.viewCache,mr(s,o.changes,o.viewCache.eventCache.getNode(),null)}function vc(s,e){const t=s.viewCache_.eventCache,n=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(M,(o,a)=>{n.push(Me(o,a))}),t.isFullyInitialized()&&n.push(nr(t.getNode())),mr(s,n,t.getNode(),e)}function mr(s,e,t,n){const r=n?[n]:s.eventRegistrations_;return Ul(s.eventGenerator_,e,t,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ht;class fr{constructor(){this.views=new Map}}function wc(s){x(!Ht,"__referenceConstructor has already been defined"),Ht=s}function bc(){return x(Ht,"Reference.ts has not been loaded"),Ht}function Nc(s){return s.views.size===0}function tn(s,e,t,n){const r=e.source.queryId;if(r!==null){const o=s.views.get(r);return x(o!=null,"SyncTree gave us an op for an invalid query."),ti(o,e,t,n)}else{let o=[];for(const a of s.views.values())o=o.concat(ti(a,e,t,n));return o}}function pr(s,e,t,n,r){const o=e._queryIdentifier,a=s.views.get(o);if(!a){let l=qt(t,r?n:null),d=!1;l?d=!0:n instanceof b?(l=Js(t,n),d=!1):(l=b.EMPTY_NODE,d=!1);const c=Xt(new pe(l,d,!1),new pe(n,r,!1));return new pc(e,c)}return a}function jc(s,e,t,n,r,o){const a=pr(s,e,n,r,o);return s.views.has(e._queryIdentifier)||s.views.set(e._queryIdentifier,a),yc(a,t),vc(a,t)}function Cc(s,e,t,n){const r=e._queryIdentifier,o=[];let a=[];const l=ge(s);if(r==="default")for(const[d,c]of s.views.entries())a=a.concat(ei(c,t,n)),Zn(c)&&(s.views.delete(d),c.query._queryParams.loadsAllData()||o.push(c.query));else{const d=s.views.get(r);d&&(a=a.concat(ei(d,t,n)),Zn(d)&&(s.views.delete(r),d.query._queryParams.loadsAllData()||o.push(d.query)))}return l&&!ge(s)&&o.push(new(bc())(e._repo,e._path)),{removed:o,events:a}}function gr(s){const e=[];for(const t of s.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function me(s,e){let t=null;for(const n of s.views.values())t=t||_c(n,e);return t}function xr(s,e){if(e._queryParams.loadsAllData())return Zt(s);{const n=e._queryIdentifier;return s.views.get(n)}}function _r(s,e){return xr(s,e)!=null}function ge(s){return Zt(s)!=null}function Zt(s){for(const e of s.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vt;function Sc(s){x(!Vt,"__referenceConstructor has already been defined"),Vt=s}function Ec(){return x(Vt,"Reference.ts has not been loaded"),Vt}let kc=1;class si{constructor(e){this.listenProvider_=e,this.syncPointTree_=new R(null),this.pendingWriteTree_=nc(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function yr(s,e,t,n,r){return Yl(s.pendingWriteTree_,e,t,n,r),r?He(s,new we(Ks(),e,t)):[]}function Ic(s,e,t,n){Gl(s.pendingWriteTree_,e,t,n);const r=R.fromObject(t);return He(s,new Le(Ks(),e,r))}function he(s,e,t=!1){const n=Bl(s.pendingWriteTree_,e);if($l(s.pendingWriteTree_,e)){let o=new R(null);return n.snap!=null?o=o.set(k(),!0):H(n.children,a=>{o=o.set(new T(a),!0)}),He(s,new Ot(n.path,o,t))}else return[]}function _t(s,e,t){return He(s,new we(Qs(),e,t))}function Pc(s,e,t){const n=R.fromObject(t);return He(s,new Le(Qs(),e,n))}function Tc(s,e){return He(s,new dt(Qs(),e))}function Rc(s,e,t){const n=nn(s,t);if(n){const r=rn(n),o=r.path,a=r.queryId,l=G(o,e),d=new dt(Xs(a),l);return on(s,o,d)}else return[]}function vr(s,e,t,n,r=!1){const o=e._path,a=s.syncPointTree_.get(o);let l=[];if(a&&(e._queryIdentifier==="default"||_r(a,e))){const d=Cc(a,e,t,n);Nc(a)&&(s.syncPointTree_=s.syncPointTree_.remove(o));const c=d.removed;if(l=d.events,!r){const u=c.findIndex(m=>m._queryParams.loadsAllData())!==-1,h=s.syncPointTree_.findOnPath(o,(m,p)=>ge(p));if(u&&!h){const m=s.syncPointTree_.subtree(o);if(!m.isEmpty()){const p=Lc(m);for(let f=0;f<p.length;++f){const _=p[f],v=_.query,N=jr(s,_);s.listenProvider_.startListening(nt(v),ht(s,v),N.hashFn,N.onComplete)}}}!h&&c.length>0&&!n&&(u?s.listenProvider_.stopListening(nt(e),null):c.forEach(m=>{const p=s.queryToTagMap.get(es(m));s.listenProvider_.stopListening(nt(m),p)}))}Fc(s,c)}return l}function wr(s,e,t,n){const r=nn(s,n);if(r!=null){const o=rn(r),a=o.path,l=o.queryId,d=G(a,e),c=new we(Xs(l),d,t);return on(s,a,c)}else return[]}function Ac(s,e,t,n){const r=nn(s,n);if(r){const o=rn(r),a=o.path,l=o.queryId,d=G(a,e),c=R.fromObject(t),u=new Le(Xs(l),d,c);return on(s,a,u)}else return[]}function Dc(s,e,t,n=!1){const r=e._path;let o=null,a=!1;s.syncPointTree_.foreachOnPath(r,(m,p)=>{const f=G(m,r);o=o||me(p,f),a=a||ge(p)});let l=s.syncPointTree_.get(r);l?(a=a||ge(l),o=o||me(l,k())):(l=new fr,s.syncPointTree_=s.syncPointTree_.set(r,l));let d;o!=null?d=!0:(d=!1,o=b.EMPTY_NODE,s.syncPointTree_.subtree(r).foreachChild((p,f)=>{const _=me(f,k());_&&(o=o.updateImmediateChild(p,_))}));const c=_r(l,e);if(!c&&!e._queryParams.loadsAllData()){const m=es(e);x(!s.queryToTagMap.has(m),"View does not exist, but we have a tag");const p=Oc();s.queryToTagMap.set(m,p),s.tagToQueryMap.set(p,m)}const u=Jt(s.pendingWriteTree_,r);let h=jc(l,e,t,u,o,d);if(!c&&!a&&!n){const m=xr(l,e);h=h.concat(Wc(s,e,m))}return h}function sn(s,e,t){const r=s.pendingWriteTree_,o=s.syncPointTree_.findOnPath(e,(a,l)=>{const d=G(a,e),c=me(l,d);if(c)return c});return lr(r,e,o,t,!0)}function Mc(s,e){const t=e._path;let n=null;s.syncPointTree_.foreachOnPath(t,(c,u)=>{const h=G(c,t);n=n||me(u,h)});let r=s.syncPointTree_.get(t);r?n=n||me(r,k()):(r=new fr,s.syncPointTree_=s.syncPointTree_.set(t,r));const o=n!=null,a=o?new pe(n,!0,!1):null,l=Jt(s.pendingWriteTree_,e._path),d=pr(r,e,l,o?a.getNode():b.EMPTY_NODE,o);return xc(d)}function He(s,e){return br(e,s.syncPointTree_,null,Jt(s.pendingWriteTree_,k()))}function br(s,e,t,n){if(C(s.path))return Nr(s,e,t,n);{const r=e.get(k());t==null&&r!=null&&(t=me(r,k()));let o=[];const a=S(s.path),l=s.operationForChild(a),d=e.children.get(a);if(d&&l){const c=t?t.getImmediateChild(a):null,u=cr(n,a);o=o.concat(br(l,d,c,u))}return r&&(o=o.concat(tn(r,s,n,t))),o}}function Nr(s,e,t,n){const r=e.get(k());t==null&&r!=null&&(t=me(r,k()));let o=[];return e.children.inorderTraversal((a,l)=>{const d=t?t.getImmediateChild(a):null,c=cr(n,a),u=s.operationForChild(a);u&&(o=o.concat(Nr(u,l,d,c)))}),r&&(o=o.concat(tn(r,s,n,t))),o}function jr(s,e){const t=e.query,n=ht(s,t);return{hashFn:()=>(gc(e)||b.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return n?Rc(s,t._path,n):Tc(s,t._path);{const o=Ta(r,t);return vr(s,t,null,o)}}}}function ht(s,e){const t=es(e);return s.queryToTagMap.get(t)}function es(s){return s._path.toString()+"$"+s._queryIdentifier}function nn(s,e){return s.tagToQueryMap.get(e)}function rn(s){const e=s.indexOf("$");return x(e!==-1&&e<s.length-1,"Bad queryKey."),{queryId:s.substr(e+1),path:new T(s.substr(0,e))}}function on(s,e,t){const n=s.syncPointTree_.get(e);x(n,"Missing sync point for query tag that we're tracking");const r=Jt(s.pendingWriteTree_,e);return tn(n,t,r,null)}function Lc(s){return s.fold((e,t,n)=>{if(t&&ge(t))return[Zt(t)];{let r=[];return t&&(r=gr(t)),H(n,(o,a)=>{r=r.concat(a)}),r}})}function nt(s){return s._queryParams.loadsAllData()&&!s._queryParams.isDefault()?new(Ec())(s._repo,s._path):s}function Fc(s,e){for(let t=0;t<e.length;++t){const n=e[t];if(!n._queryParams.loadsAllData()){const r=es(n),o=s.queryToTagMap.get(r);s.queryToTagMap.delete(r),s.tagToQueryMap.delete(o)}}}function Oc(){return kc++}function Wc(s,e,t){const n=e._path,r=ht(s,e),o=jr(s,t),a=s.listenProvider_.startListening(nt(e),r,o.hashFn,o.onComplete),l=s.syncPointTree_.subtree(n);if(r)x(!ge(l.value),"If we're adding a query, it shouldn't be shadowed");else{const d=l.fold((c,u,h)=>{if(!C(c)&&u&&ge(u))return[Zt(u).query];{let m=[];return u&&(m=m.concat(gr(u).map(p=>p.query))),H(h,(p,f)=>{m=m.concat(f)}),m}});for(let c=0;c<d.length;++c){const u=d[c];s.listenProvider_.stopListening(nt(u),ht(s,u))}}return a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new an(t)}node(){return this.node_}}class ln{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=D(this.path_,e);return new ln(this.syncTree_,t)}node(){return sn(this.syncTree_,this.path_)}}const qc=function(s){return s=s||{},s.timestamp=s.timestamp||new Date().getTime(),s},ni=function(s,e,t){if(!s||typeof s!="object")return s;if(x(".sv"in s,"Unexpected leaf node or priority contents"),typeof s[".sv"]=="string")return Uc(s[".sv"],e,t);if(typeof s[".sv"]=="object")return zc(s[".sv"],e);x(!1,"Unexpected server value: "+JSON.stringify(s,null,2))},Uc=function(s,e,t){switch(s){case"timestamp":return t.timestamp;default:x(!1,"Unexpected server value: "+s)}},zc=function(s,e,t){s.hasOwnProperty("increment")||x(!1,"Unexpected server value: "+JSON.stringify(s,null,2));const n=s.increment;typeof n!="number"&&x(!1,"Unexpected increment value: "+n);const r=e.node();if(x(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return n;const a=r.getValue();return typeof a!="number"?n:a+n},Cr=function(s,e,t,n){return cn(e,new ln(t,s),n)},Sr=function(s,e,t){return cn(s,new an(e),t)};function cn(s,e,t){const n=s.getPriority().val(),r=ni(n,e.getImmediateChild(".priority"),t);let o;if(s.isLeafNode()){const a=s,l=ni(a.getValue(),e,t);return l!==a.getValue()||r!==a.getPriority().val()?new W(l,F(r)):s}else{const a=s;return o=a,r!==a.getPriority().val()&&(o=o.updatePriority(new W(r))),a.forEachChild(M,(l,d)=>{const c=cn(d,e.getImmediateChild(l),t);c!==d&&(o=o.updateImmediateChild(l,c))}),o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function hn(s,e){let t=e instanceof T?e:new T(e),n=s,r=S(t);for(;r!==null;){const o=Ae(n.node.children,r)||{children:{},childCount:0};n=new dn(r,n,o),t=A(t),r=S(t)}return n}function Ve(s){return s.node.value}function Er(s,e){s.node.value=e,Ss(s)}function kr(s){return s.node.childCount>0}function Hc(s){return Ve(s)===void 0&&!kr(s)}function ts(s,e){H(s.node.children,(t,n)=>{e(new dn(t,s,n))})}function Ir(s,e,t,n){t&&!n&&e(s),ts(s,r=>{Ir(r,e,!0,n)}),t&&n&&e(s)}function Vc(s,e,t){let n=s.parent;for(;n!==null;){if(e(n))return!0;n=n.parent}return!1}function yt(s){return new T(s.parent===null?s.name:yt(s.parent)+"/"+s.name)}function Ss(s){s.parent!==null&&Yc(s.parent,s.name,s)}function Yc(s,e,t){const n=Hc(t),r=se(s.node.children,e);n&&r?(delete s.node.children[e],s.node.childCount--,Ss(s)):!n&&!r&&(s.node.children[e]=t.node,s.node.childCount++,Ss(s))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gc=/[\[\].#$\/\u0000-\u001F\u007F]/,Bc=/[\[\].#$\u0000-\u001F\u007F]/,ms=10*1024*1024,un=function(s){return typeof s=="string"&&s.length!==0&&!Gc.test(s)},Pr=function(s){return typeof s=="string"&&s.length!==0&&!Bc.test(s)},$c=function(s){return s&&(s=s.replace(/^\/*\.info(\/|$)/,"/")),Pr(s)},Kc=function(s){return s===null||typeof s=="string"||typeof s=="number"&&!Ws(s)||s&&typeof s=="object"&&se(s,".sv")},Qc=function(s,e,t,n){ss(Yt(s,"value"),e,t)},ss=function(s,e,t){const n=t instanceof T?new hl(t,s):t;if(e===void 0)throw new Error(s+"contains undefined "+xe(n));if(typeof e=="function")throw new Error(s+"contains a function "+xe(n)+" with contents = "+e.toString());if(Ws(e))throw new Error(s+"contains "+e.toString()+" "+xe(n));if(typeof e=="string"&&e.length>ms/3&&Bt(e)>ms)throw new Error(s+"contains a string greater than "+ms+" utf8 bytes "+xe(n)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,o=!1;if(H(e,(a,l)=>{if(a===".value")r=!0;else if(a!==".priority"&&a!==".sv"&&(o=!0,!un(a)))throw new Error(s+" contains an invalid key ("+a+") "+xe(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);ul(n,a),ss(s,l,n),ml(n)}),r&&o)throw new Error(s+' contains ".value" child '+xe(n)+" in addition to actual children.")}},Xc=function(s,e){let t,n;for(t=0;t<e.length;t++){n=e[t];const o=ot(n);for(let a=0;a<o.length;a++)if(!(o[a]===".priority"&&a===o.length-1)){if(!un(o[a]))throw new Error(s+"contains an invalid key ("+o[a]+") in path "+n.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(dl);let r=null;for(t=0;t<e.length;t++){if(n=e[t],r!==null&&X(r,n))throw new Error(s+"contains a path "+r.toString()+" that is ancestor of another path "+n.toString());r=n}},Jc=function(s,e,t,n){const r=Yt(s,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");const o=[];H(e,(a,l)=>{const d=new T(a);if(ss(r,l,D(t,d)),Vs(d)===".priority"&&!Kc(l))throw new Error(r+"contains an invalid value for '"+d.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(d)}),Xc(r,o)},Tr=function(s,e,t,n){if(!Pr(t))throw new Error(Yt(s,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Zc=function(s,e,t,n){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Tr(s,e,t)},ed=function(s,e){if(S(e)===".info")throw new Error(s+" failed = Can't modify data under /.info/")},td=function(s,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!un(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!$c(t))throw new Error(Yt(s,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sd{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function mn(s,e){let t=null;for(let n=0;n<e.length;n++){const r=e[n],o=r.getPath();t!==null&&!Qi(o,t.path)&&(s.eventLists_.push(t),t=null),t===null&&(t={events:[],path:o}),t.events.push(r)}t&&s.eventLists_.push(t)}function J(s,e,t){mn(s,t),nd(s,n=>X(n,e)||X(e,n))}function nd(s,e){s.recursionDepth_++;let t=!0;for(let n=0;n<s.eventLists_.length;n++){const r=s.eventLists_[n];if(r){const o=r.path;e(o)?(id(s.eventLists_[n]),s.eventLists_[n]=null):t=!1}}t&&(s.eventLists_=[]),s.recursionDepth_--}function id(s){for(let e=0;e<s.events.length;e++){const t=s.events[e];if(t!==null){s.events[e]=null;const n=t.getEventRunner();Ze&&z("event: "+t.toString()),ze(n)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rd="repo_interrupt",od=25;class ad{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new sd,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ft(),this.transactionQueueTree_=new dn,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function ld(s,e,t){if(s.stats_=zs(s.repoInfo_),s.forceRestClient_||Ma())s.server_=new Lt(s.repoInfo_,(n,r,o,a)=>{ii(s,n,r,o,a)},s.authTokenProvider_,s.appCheckProvider_),setTimeout(()=>ri(s,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{O(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}s.persistentConnection_=new re(s.repoInfo_,e,(n,r,o,a)=>{ii(s,n,r,o,a)},n=>{ri(s,n)},n=>{dd(s,n)},s.authTokenProvider_,s.appCheckProvider_,t),s.server_=s.persistentConnection_}s.authTokenProvider_.addTokenChangeListener(n=>{s.server_.refreshAuthToken(n)}),s.appCheckProvider_.addTokenChangeListener(n=>{s.server_.refreshAppCheckToken(n.token)}),s.statsReporter_=qa(s.repoInfo_,()=>new Wl(s.stats_,s.server_)),s.infoData_=new Dl,s.infoSyncTree_=new si({startListening:(n,r,o,a)=>{let l=[];const d=s.infoData_.getNode(n._path);return d.isEmpty()||(l=_t(s.infoSyncTree_,n._path,d),setTimeout(()=>{a("ok")},0)),l},stopListening:()=>{}}),fn(s,"connected",!1),s.serverSyncTree_=new si({startListening:(n,r,o,a)=>(s.server_.listen(n,o,r,(l,d)=>{const c=a(l,d);J(s.eventQueue_,n._path,c)}),[]),stopListening:(n,r)=>{s.server_.unlisten(n,r)}})}function cd(s){const t=s.infoData_.getNode(new T(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function ns(s){return qc({timestamp:cd(s)})}function ii(s,e,t,n,r){s.dataUpdateCount++;const o=new T(e);t=s.interceptServerDataCallback_?s.interceptServerDataCallback_(e,t):t;let a=[];if(r)if(n){const d=Pt(t,c=>F(c));a=Ac(s.serverSyncTree_,o,d,r)}else{const d=F(t);a=wr(s.serverSyncTree_,o,d,r)}else if(n){const d=Pt(t,c=>F(c));a=Pc(s.serverSyncTree_,o,d)}else{const d=F(t);a=_t(s.serverSyncTree_,o,d)}let l=o;a.length>0&&(l=Oe(s,o)),J(s.eventQueue_,l,a)}function ri(s,e){fn(s,"connected",e),e===!1&&fd(s)}function dd(s,e){H(e,(t,n)=>{fn(s,t,n)})}function fn(s,e,t){const n=new T("/.info/"+e),r=F(t);s.infoData_.updateSnapshot(n,r);const o=_t(s.infoSyncTree_,n,r);J(s.eventQueue_,n,o)}function pn(s){return s.nextWriteId_++}function hd(s,e,t){const n=Mc(s.serverSyncTree_,e);return n!=null?Promise.resolve(n):s.server_.get(e).then(r=>{const o=F(r).withIndex(e._queryParams.getIndex());Dc(s.serverSyncTree_,e,t,!0);let a;if(e._queryParams.loadsAllData())a=_t(s.serverSyncTree_,e._path,o);else{const l=ht(s.serverSyncTree_,e);a=wr(s.serverSyncTree_,e._path,o,l)}return J(s.eventQueue_,e._path,a),vr(s.serverSyncTree_,e,t,null,!0),o},r=>(vt(s,"get for query "+O(e)+" failed: "+r),Promise.reject(new Error(r))))}function ud(s,e,t,n,r){vt(s,"set",{path:e.toString(),value:t,priority:n});const o=ns(s),a=F(t,n),l=sn(s.serverSyncTree_,e),d=Sr(a,l,o),c=pn(s),u=yr(s.serverSyncTree_,e,d,c,!0);mn(s.eventQueue_,u),s.server_.put(e.toString(),a.val(!0),(m,p)=>{const f=m==="ok";f||$("set at "+e+" failed: "+m);const _=he(s.serverSyncTree_,c,!f);J(s.eventQueue_,e,_),Es(s,r,m,p)});const h=xn(s,e);Oe(s,h),J(s.eventQueue_,h,[])}function md(s,e,t,n){vt(s,"update",{path:e.toString(),value:t});let r=!0;const o=ns(s),a={};if(H(t,(l,d)=>{r=!1,a[l]=Cr(D(e,l),F(d),s.serverSyncTree_,o)}),r)z("update() called with empty data.  Don't do anything."),Es(s,n,"ok",void 0);else{const l=pn(s),d=Ic(s.serverSyncTree_,e,a,l);mn(s.eventQueue_,d),s.server_.merge(e.toString(),t,(c,u)=>{const h=c==="ok";h||$("update at "+e+" failed: "+c);const m=he(s.serverSyncTree_,l,!h),p=m.length>0?Oe(s,e):e;J(s.eventQueue_,p,m),Es(s,n,c,u)}),H(t,c=>{const u=xn(s,D(e,c));Oe(s,u)}),J(s.eventQueue_,e,[])}}function fd(s){vt(s,"onDisconnectEvents");const e=ns(s),t=Ft();vs(s.onDisconnect_,k(),(r,o)=>{const a=Cr(r,o,s.serverSyncTree_,e);ir(t,r,a)});let n=[];vs(t,k(),(r,o)=>{n=n.concat(_t(s.serverSyncTree_,r,o));const a=xn(s,r);Oe(s,a)}),s.onDisconnect_=Ft(),J(s.eventQueue_,k(),n)}function pd(s){s.persistentConnection_&&s.persistentConnection_.interrupt(rd)}function vt(s,...e){let t="";s.persistentConnection_&&(t=s.persistentConnection_.id+":"),z(t,...e)}function Es(s,e,t,n){e&&ze(()=>{if(t==="ok")e(null);else{const r=(t||"error").toUpperCase();let o=r;n&&(o+=": "+n);const a=new Error(o);a.code=r,e(a)}})}function Rr(s,e,t){return sn(s.serverSyncTree_,e,t)||b.EMPTY_NODE}function gn(s,e=s.transactionQueueTree_){if(e||is(s,e),Ve(e)){const t=Dr(s,e);x(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&gd(s,yt(e),t)}else kr(e)&&ts(e,t=>{gn(s,t)})}function gd(s,e,t){const n=t.map(c=>c.currentWriteId),r=Rr(s,e,n);let o=r;const a=r.hash();for(let c=0;c<t.length;c++){const u=t[c];x(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=G(e,u.path);o=o.updateChild(h,u.currentOutputSnapshotRaw)}const l=o.val(!0),d=e;s.server_.put(d.toString(),l,c=>{vt(s,"transaction put response",{path:d.toString(),status:c});let u=[];if(c==="ok"){const h=[];for(let m=0;m<t.length;m++)t[m].status=2,u=u.concat(he(s.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&h.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();is(s,hn(s.transactionQueueTree_,e)),gn(s,s.transactionQueueTree_),J(s.eventQueue_,e,u);for(let m=0;m<h.length;m++)ze(h[m])}else{if(c==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{$("transaction at "+d.toString()+" failed: "+c);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=c}Oe(s,e)}},a)}function Oe(s,e){const t=Ar(s,e),n=yt(t),r=Dr(s,t);return xd(s,r,n),n}function xd(s,e,t){if(e.length===0)return;const n=[];let r=[];const a=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const d=e[l],c=G(t,d.path);let u=!1,h;if(x(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),d.status===4)u=!0,h=d.abortReason,r=r.concat(he(s.serverSyncTree_,d.currentWriteId,!0));else if(d.status===0)if(d.retryCount>=od)u=!0,h="maxretry",r=r.concat(he(s.serverSyncTree_,d.currentWriteId,!0));else{const m=Rr(s,d.path,a);d.currentInputSnapshot=m;const p=e[l].update(m.val());if(p!==void 0){ss("transaction failed: Data returned ",p,d.path);let f=F(p);typeof p=="object"&&p!=null&&se(p,".priority")||(f=f.updatePriority(m.getPriority()));const v=d.currentWriteId,N=ns(s),y=Sr(f,m,N);d.currentOutputSnapshotRaw=f,d.currentOutputSnapshotResolved=y,d.currentWriteId=pn(s),a.splice(a.indexOf(v),1),r=r.concat(yr(s.serverSyncTree_,d.path,y,d.currentWriteId,d.applyLocally)),r=r.concat(he(s.serverSyncTree_,v,!0))}else u=!0,h="nodata",r=r.concat(he(s.serverSyncTree_,d.currentWriteId,!0))}J(s.eventQueue_,t,r),r=[],u&&(e[l].status=2,function(m){setTimeout(m,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(h==="nodata"?n.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):n.push(()=>e[l].onComplete(new Error(h),!1,null))))}is(s,s.transactionQueueTree_);for(let l=0;l<n.length;l++)ze(n[l]);gn(s,s.transactionQueueTree_)}function Ar(s,e){let t,n=s.transactionQueueTree_;for(t=S(e);t!==null&&Ve(n)===void 0;)n=hn(n,t),e=A(e),t=S(e);return n}function Dr(s,e){const t=[];return Mr(s,e,t),t.sort((n,r)=>n.order-r.order),t}function Mr(s,e,t){const n=Ve(e);if(n)for(let r=0;r<n.length;r++)t.push(n[r]);ts(e,r=>{Mr(s,r,t)})}function is(s,e){const t=Ve(e);if(t){let n=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[n]=t[r],n++);t.length=n,Er(e,t.length>0?t:void 0)}ts(e,n=>{is(s,n)})}function xn(s,e){const t=yt(Ar(s,e)),n=hn(s.transactionQueueTree_,e);return Vc(n,r=>{fs(s,r)}),fs(s,n),Ir(n,r=>{fs(s,r)}),t}function fs(s,e){const t=Ve(e);if(t){const n=[];let r=[],o=-1;for(let a=0;a<t.length;a++)t[a].status===3||(t[a].status===1?(x(o===a-1,"All SENT items should be at beginning of queue."),o=a,t[a].status=3,t[a].abortReason="set"):(x(t[a].status===0,"Unexpected transaction status in abort"),t[a].unwatcher(),r=r.concat(he(s.serverSyncTree_,t[a].currentWriteId,!0)),t[a].onComplete&&n.push(t[a].onComplete.bind(null,new Error("set"),!1,null))));o===-1?Er(e,void 0):t.length=o+1,J(s.eventQueue_,yt(e),r);for(let a=0;a<n.length;a++)ze(n[a])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _d(s){let e="";const t=s.split("/");for(let n=0;n<t.length;n++)if(t[n].length>0){let r=t[n];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function yd(s){const e={};s.charAt(0)==="?"&&(s=s.substring(1));for(const t of s.split("&")){if(t.length===0)continue;const n=t.split("=");n.length===2?e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):$(`Invalid query segment '${t}' in query '${s}'`)}return e}const oi=function(s,e){const t=vd(s),n=t.namespace;t.domain==="firebase.com"&&oe(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&t.domain!=="localhost"&&oe("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Sa();const r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new qi(t.host,t.secure,n,r,e,"",n!==t.subdomain),path:new T(t.pathString)}},vd=function(s){let e="",t="",n="",r="",o="",a=!0,l="https",d=443;if(typeof s=="string"){let c=s.indexOf("//");c>=0&&(l=s.substring(0,c-1),s=s.substring(c+2));let u=s.indexOf("/");u===-1&&(u=s.length);let h=s.indexOf("?");h===-1&&(h=s.length),e=s.substring(0,Math.min(u,h)),u<h&&(r=_d(s.substring(u,h)));const m=yd(s.substring(Math.min(s.length,h)));c=e.indexOf(":"),c>=0?(a=l==="https"||l==="wss",d=parseInt(e.substring(c+1),10)):c=e.length;const p=e.slice(0,c);if(p.toLowerCase()==="localhost")t="localhost";else if(p.split(".").length<=2)t=p;else{const f=e.indexOf(".");n=e.substring(0,f).toLowerCase(),t=e.substring(f+1),o=n}"ns"in m&&(o=m.ns)}return{host:e,port:d,domain:t,subdomain:n,secure:a,scheme:l,pathString:r,namespace:o}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wd{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+O(this.snapshot.exportVal())}}class bd{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nd{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return x(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _n{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return C(this._path)?null:Vs(this._path)}get ref(){return new ae(this._repo,this._path)}get _queryIdentifier(){const e=Gn(this._queryParams),t=qs(e);return t==="{}"?"default":t}get _queryObject(){return Gn(this._queryParams)}isEqual(e){if(e=We(e),!(e instanceof _n))return!1;const t=this._repo===e._repo,n=Qi(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+cl(this._path)}}class ae extends _n{constructor(e,t){super(e,t,new $s,!1)}get parent(){const e=Ki(this._path);return e===null?null:new ae(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class ut{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new T(e),n=ks(this.ref,e);return new ut(this._node.getChild(t),n,M)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,r)=>e(new ut(r,ks(this.ref,n),M)))}hasChild(e){const t=new T(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function yn(s,e){return s=We(s),s._checkNotDeleted("ref"),e!==void 0?ks(s._root,e):s._root}function ks(s,e){return s=We(s),S(s._path)===null?Zc("child","path",e):Tr("child","path",e),new ae(s._repo,D(s._path,e))}function Lr(s,e){s=We(s),ed("set",s._path),Qc("set",e,s._path);const t=new Gt;return ud(s._repo,s._path,e,null,t.wrapCallback(()=>{})),t.promise}function jd(s,e){Jc("update",e,s._path);const t=new Gt;return md(s._repo,s._path,e,t.wrapCallback(()=>{})),t.promise}function Cd(s){s=We(s);const e=new Nd(()=>{}),t=new vn(e);return hd(s._repo,s,t).then(n=>new ut(n,new ae(s._repo,s._path),s._queryParams.getIndex()))}class vn{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const n=t._queryParams.getIndex();return new wd("value",this,new ut(e.snapshotNode,new ae(t._repo,t._path),n))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new bd(this,e,t):null}matches(e){return e instanceof vn?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}wc(ae);Sc(ae);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sd="FIREBASE_DATABASE_EMULATOR_HOST",Is={};let Ed=!1;function kd(s,e,t,n){s.repoInfo_=new qi(`${e}:${t}`,!1,s.repoInfo_.namespace,s.repoInfo_.webSocketOnly,s.repoInfo_.nodeAdmin,s.repoInfo_.persistenceKey,s.repoInfo_.includeNamespaceInQueryParams,!0),n&&(s.authTokenProvider_=n)}function Id(s,e,t,n,r){let o=n||s.options.databaseURL;o===void 0&&(s.options.projectId||oe("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),z("Using default host for project ",s.options.projectId),o=`${s.options.projectId}-default-rtdb.firebaseio.com`);let a=oi(o,r),l=a.repoInfo,d;typeof process<"u"&&kn&&(d=kn[Sd]),d?(o=`http://${d}?ns=${l.namespace}`,a=oi(o,r),l=a.repoInfo):a.repoInfo.secure;const c=new Fa(s.name,s.options,e);td("Invalid Firebase Database URL",a),C(a.path)||oe("Database URL must point to the root of a Firebase Database (not including a child path).");const u=Td(l,s,c,new La(s.name,t));return new Rd(u,s)}function Pd(s,e){const t=Is[e];(!t||t[s.key]!==s)&&oe(`Database ${e}(${s.repoInfo_}) has already been deleted.`),pd(s),delete t[s.key]}function Td(s,e,t,n){let r=Is[e.name];r||(r={},Is[e.name]=r);let o=r[s.toURLString()];return o&&oe("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new ad(s,Ed,t,n),r[s.toURLString()]=o,o}class Rd{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(ld(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ae(this._repo,k())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Pd(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&oe("Cannot call "+e+" on a deleted database.")}}function Ad(s=io(),e){const t=so(s,"database").getImmediate({identifier:e});if(!t._instanceStarted){const n=no("database");n&&Dd(t,...n)}return t}function Dd(s,e,t,n={}){s=We(s),s._checkNotDeleted("useEmulator"),s._instanceStarted&&oe("Cannot call useEmulator() after instance has already been initialized.");const r=s._repoInternal;let o;if(r.repoInfo_.nodeAdmin)n.mockUserToken&&oe('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new It(It.OWNER);else if(n.mockUserToken){const a=typeof n.mockUserToken=="string"?n.mockUserToken:ro(n.mockUserToken,s.app.options.projectId);o=new It(a)}kd(r,e,t,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Md(s){va(_o),oo(new ao("database",(e,{instanceIdentifier:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return Id(n,r,o,t)},"PUBLIC").setMultipleInstances(!0)),Cn(In,Pn,s),Cn(In,Pn,"esm2017")}re.prototype.simpleListen=function(s,e){this.sendRequest("q",{p:s},e)};re.prototype.echo=function(s,e){this.sendRequest("echo",{d:s},e)};Md();const Ld={apiKey:"AIzaSyDHB4mG1o1oYJWwqM1EJt9YqhY3VF6XHXM",authDomain:"luxe-ecommerce-stackblitz.firebaseapp.com",databaseURL:"https://luxe-ecommerce-stackblitz.firebaseio.com",projectId:"luxe-ecommerce-stackblitz",storageBucket:"luxe-ecommerce-stackblitz.appspot.com",messagingSenderId:"123456789012",appId:"1:123456789012:web:abcdef1234567890abcdef",measurementId:"G-ABCDEF1234"};let Qe,ne,Ne,ai;try{Qe=vo(Ld),ne=wo(Qe),Ne=Ad(Qe),ai=bo(Qe)}catch(s){console.error("Firebase initialization error:",s),Qe=null,ne=null,Ne=null,ai=null}async function Xe(s){try{const e=yn(Ne,`users/${s}`),t=await Cd(e);if(!t.exists()){const n={email:"",phone:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await Lr(e,n),{id:s,...n}}return{id:s,...t.val()}}catch(e){return console.error("Error fetching user profile:",e),w.error("Unable to load profile"),null}}async function Fd(s,e){try{const t=yn(Ne,`users/${s}`),n={...e,updatedAt:new Date().toISOString()};await jd(t,n)}catch(t){throw console.error("Error updating user profile:",t),t}}async function li(s,e){try{const t=yn(Ne,`users/${s}`);await Lr(t,{...e,phone:e.phone||"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}catch(t){throw console.error("Error creating user profile:",t),t}}No(ne,jo).catch(s=>{console.error("Error enabling auth persistence:",s)});const Fr=g.createContext(void 0);function Od({children:s}){const[e,t]=g.useState(null),[n,r]=g.useState(null),[o,a]=g.useState(!0),[l,d]=g.useState(!navigator.onLine);g.useEffect(()=>{const N=()=>d(!1),y=()=>d(!0);return window.addEventListener("online",N),window.addEventListener("offline",y),()=>{window.removeEventListener("online",N),window.removeEventListener("offline",y)}},[]),g.useEffect(()=>Co(ne,async y=>{if(t(y),y)try{const E=await Xe(y.uid);E&&r(E)}catch(E){console.error("Error fetching user profile:",E),l||w.error("Unable to load profile")}else r(null);a(!1)}),[l]);const v={currentUser:e,userProfile:n,login:async(N,y)=>{try{const E=await So(ne,N,y),Y=await Xe(E.user.uid);Y&&r(Y),w.success("Successfully logged in!")}catch(E){throw console.error("Login error:",E),E.code==="auth/network-request-failed"?w.error("Network error. Please check your connection."):w.error("Failed to login"),E}},register:async(N,y,E)=>{try{const{user:Y}=await Eo(ne,N,y);await li(Y.uid,{name:E,email:N,phone:"",createdAt:new Date().toISOString()});const ce=await Xe(Y.uid);ce&&r(ce),w.success("Successfully registered!")}catch(Y){throw console.error("Registration error:",Y),w.error("Failed to register"),Y}},logout:async()=>{try{await ko(ne),r(null),w.success("Successfully logged out!")}catch(N){throw console.error("Logout error:",N),w.error("Failed to logout"),N}},googleSignIn:async()=>{try{const N=new Ro,{user:y}=await Ao(ne,N);await li(y.uid,{name:y.displayName||void 0,email:y.email,phone:"",photoURL:y.photoURL||void 0});const E=await Xe(y.uid);E&&r(E),w.success("Successfully signed in with Google!")}catch(N){throw console.error("Google sign-in error:",N),w.error("Failed to sign in with Google"),N}},resetPassword:async N=>{try{await Do(ne,N),w.success("Password reset email sent!")}catch(y){throw console.error("Password reset error:",y),w.error("Failed to send reset email"),y}},updateProfile:async N=>{if(!e)throw new Error("No user logged in");try{await Fd(e.uid,N);const y=await Xe(e.uid);y&&r(y),w.success("Profile updated successfully!")}catch(y){throw console.error("Profile update error:",y),l||w.error("Failed to update profile"),y}},updatePassword:async(N,y)=>{if(!e?.email)throw new Error("No user logged in");try{const E=Io.credential(e.email,N);await Po(e,E),await To(e,y),w.success("Password updated successfully")}catch(E){throw console.error("Password update error:",E),w.error("Failed to update password"),E}},loading:o,isOffline:l};return i.jsx(Fr.Provider,{value:v,children:!o&&s})}function le(){const s=g.useContext(Fr);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s}const wn=(s,e="INR")=>{const t=typeof s=="string"?parseFloat(s.replace(/[^0-9.-]+/g,"")):s;return Number.isFinite(t)?new Intl.NumberFormat("en-IN",{style:"currency",currency:e,minimumFractionDigits:2,maximumFractionDigits:2}).format(t):"₹0.00"},Wd=s=>{const e=s.replace(/\D/g,"");return/^(?:(?:\+|91)?[6-9]\d{9})$/.test(e)},qd=s=>{const e=s.replace(/\D/g,"");return e.length===10?`+91${e}`:e.length===12&&e.startsWith("91")?`+${e}`:s};function ci(){const{currentUser:s,userProfile:e,updateProfile:t}=le(),[n,r]=g.useState(!1),[o,a]=g.useState(!1),[l,d]=g.useState({name:e?.name||s?.displayName||"",phone:e?.phone||"",email:s?.email||""});g.useEffect(()=>{e&&d({name:e.name||s?.displayName||"",phone:e.phone||"",email:s?.email||""})},[e,s]);const c=m=>{let p=m.target.value;if(p=p.replace(/[^\d+]/g,""),!p.startsWith("+91")&&p.length>0&&(p="+91"+p),p.startsWith("+91")){const f=p.slice(3);f.length>10&&(p="+91"+f.slice(0,10))}d(f=>({...f,phone:p}))},u=async m=>{m.preventDefault(),a(!0);try{if(l.phone&&!Wd(l.phone)){w.error("Please enter a valid Indian mobile number");return}const p=l.phone?qd(l.phone):"";await t({name:l.name.trim(),phone:p,email:l.email.trim()}),r(!1),w.success("Profile updated successfully")}catch(p){console.error("Failed to update profile:",p),w.error("Failed to update profile")}finally{a(!1)}},h=()=>{d({name:e?.name||s?.displayName||"",phone:e?.phone||"",email:s?.email||""}),r(!1)};return i.jsxs("div",{className:"text-white",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Account Overview"}),i.jsxs("div",{className:"bg-white/10 rounded-xl p-6",children:[i.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[s?.photoURL?i.jsx("img",{src:s.photoURL,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):i.jsx("div",{className:"w-20 h-20 rounded-full bg-accent-600 flex items-center justify-center",children:i.jsx(ft,{className:"w-10 h-10 text-white"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-semibold",children:e?.name||s?.displayName||"User"}),i.jsx("p",{className:"text-white/70",children:s?.email})]})]}),n?i.jsxs("form",{onSubmit:u,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Full Name"}),i.jsx("input",{type:"text",value:l.name,onChange:m=>d({...l,name:m.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email"}),i.jsx("input",{type:"email",value:l.email,onChange:m=>d({...l,email:m.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Phone Number"}),i.jsx("input",{type:"tel",value:l.phone,onChange:c,className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white",placeholder:"+91"}),i.jsx("p",{className:"text-sm text-white/50 mt-1",children:"Format: +91 followed by 10 digits"})]}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("button",{type:"submit",disabled:o,className:"px-6 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 disabled:opacity-50",children:o?"Saving...":"Save Changes"}),i.jsx("button",{type:"button",onClick:h,disabled:o,className:"px-6 py-2 border border-white/20 rounded-lg hover:bg-white/10",children:"Cancel"})]})]}):i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-white/70",children:"Phone Number"}),i.jsx("p",{className:"font-medium",children:e?.phone||"Not set"})]}),i.jsx("button",{onClick:()=>r(!0),className:"px-6 py-2 border border-white/20 rounded-lg hover:bg-white/10",children:"Edit Profile"})]})]})]})}const Ud=async s=>{const e=Mo(Ne,"products",s),t=await Lo(e);return t.exists()?{id:t.id,...t.data()}:null},zd=async s=>{const e=Fo(Wo(Ne,"orders"),Oo("userId","==",s));return(await qo(e)).docs.map(n=>({id:n.id,...n.data()}))};function Hd(){const[s,e]=g.useState([]),[t,n]=g.useState(!0),{currentUser:r}=le();return g.useEffect(()=>{(async()=>{try{if(r){const a=await zd(r.uid);e(a)}}catch(a){console.error("Failed to fetch orders:",a)}finally{n(!1)}})()},[r]),t?i.jsx("div",{className:"flex justify-center items-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-white"})}):s.length===0?i.jsxs("div",{className:"text-center text-white py-12",children:[i.jsx(qe,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),i.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No Orders Yet"}),i.jsx("p",{className:"text-white/70",children:"Start shopping to see your orders here"})]}):i.jsxs("div",{className:"text-white",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Your Orders"}),i.jsx("div",{className:"space-y-4",children:s.map(o=>i.jsxs("div",{className:"bg-white/10 rounded-xl p-6",children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsxs("div",{children:[i.jsxs("p",{className:"text-sm text-white/70",children:["Order #",o.id]}),i.jsxs("p",{className:"text-sm text-white/70",children:["Placed on ",new Date(o.createdAt).toLocaleDateString()]})]}),i.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${o.status==="delivered"?"bg-green-500/20 text-green-300":o.status==="processing"?"bg-blue-500/20 text-blue-300":"bg-yellow-500/20 text-yellow-300"}`,children:o.status.charAt(0).toUpperCase()+o.status.slice(1)})]}),i.jsx("div",{className:"space-y-4",children:o.items.map(a=>i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsx("img",{src:a.image,alt:a.name,className:"w-16 h-16 object-cover rounded-lg"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"font-medium",children:a.name}),i.jsxs("p",{className:"text-sm text-white/70",children:["Quantity: ",a.quantity]})]}),i.jsxs("p",{className:"font-medium",children:["$",a.price.toFixed(2)]})]},a.id))}),i.jsxs("div",{className:"mt-6 flex justify-between items-center pt-4 border-t border-white/10",children:[i.jsx("div",{children:i.jsxs("p",{className:"font-medium",children:["Total: $",o.totalAmount.toFixed(2)]})}),i.jsxs("button",{className:"flex items-center space-x-2 text-accent-400 hover:text-accent-300",children:[i.jsx("span",{children:"View Details"}),i.jsx(ye,{className:"w-4 h-4"})]})]})]},o.id))})]})}function Vd(){const{currentUser:s,updateEmail:e,updatePassword:t}=le(),[n,r]=g.useState(!1),[o,a]=g.useState(!1),[l,d]=g.useState(!1),[c,u]=g.useState({currentPassword:"",newPassword:"",confirmPassword:"",newEmail:""}),h=async p=>{if(p.preventDefault(),c.newPassword!==c.confirmPassword){w.error("New passwords do not match");return}if(c.newPassword.length<6){w.error("Password must be at least 6 characters long");return}d(!0);try{await t(c.currentPassword,c.newPassword),r(!1),u({...c,currentPassword:"",newPassword:"",confirmPassword:""}),w.success("Password updated successfully")}catch(f){console.error("Failed to update password:",f),w.error("Failed to update password. Please check your current password.")}finally{d(!1)}},m=async p=>{p.preventDefault(),d(!0);try{await e(c.newEmail),a(!1),u({...c,newEmail:""}),w.success("Email updated successfully")}catch(f){console.error("Failed to update email:",f),w.error("Failed to update email. Please try again.")}finally{d(!1)}};return i.jsxs("div",{className:"text-white",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Login & Security"}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-white/10 rounded-xl p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(Ts,{className:"w-5 h-5 text-accent-400"}),i.jsx("h3",{className:"text-lg font-semibold",children:"Email Address"})]}),i.jsx("button",{onClick:()=>a(!o),className:"text-accent-400 hover:text-accent-300",children:"Change"})]}),o?i.jsxs("form",{onSubmit:m,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"New Email"}),i.jsx("input",{type:"email",value:c.newEmail,onChange:p=>u({...c,newEmail:p.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("button",{type:"submit",disabled:l,className:"px-6 py-2 bg-accent-600 rounded-lg hover:bg-accent-700 disabled:opacity-50",children:l?"Updating...":"Update Email"}),i.jsx("button",{type:"button",onClick:()=>a(!1),disabled:l,className:"px-6 py-2 border border-white/20 rounded-lg hover:bg-white/10",children:"Cancel"})]})]}):i.jsx("p",{className:"text-white/70",children:s?.email})]}),i.jsxs("div",{className:"bg-white/10 rounded-xl p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(Rs,{className:"w-5 h-5 text-accent-400"}),i.jsx("h3",{className:"text-lg font-semibold",children:"Password"})]}),i.jsx("button",{onClick:()=>r(!n),className:"text-accent-400 hover:text-accent-300",children:"Change"})]}),n&&i.jsxs("form",{onSubmit:h,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Current Password"}),i.jsx("input",{type:"password",value:c.currentPassword,onChange:p=>u({...c,currentPassword:p.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"New Password"}),i.jsx("input",{type:"password",value:c.newPassword,onChange:p=>u({...c,newPassword:p.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0,minLength:6})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Confirm New Password"}),i.jsx("input",{type:"password",value:c.confirmPassword,onChange:p=>u({...c,confirmPassword:p.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("button",{type:"submit",disabled:l,className:"px-6 py-2 bg-accent-600 rounded-lg hover:bg-accent-700 disabled:opacity-50",children:l?"Updating...":"Update Password"}),i.jsx("button",{type:"button",onClick:()=>{r(!1),u({...c,currentPassword:"",newPassword:"",confirmPassword:""})},disabled:l,className:"px-6 py-2 border border-white/20 rounded-lg hover:bg-white/10",children:"Cancel"})]})]})]}),i.jsx("div",{className:"bg-white/10 rounded-xl p-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(pi,{className:"w-5 h-5 text-accent-400"}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold",children:"Two-Factor Authentication"}),i.jsx("p",{className:"text-sm text-white/70",children:"Add an extra layer of security to your account"})]})]}),i.jsx("button",{className:"px-6 py-2 border border-white/20 rounded-lg hover:bg-white/10",children:"Set Up"})]})})]})]})}function Yd(){const[s,e]=g.useState([]),[t,n]=g.useState(!1),[r,o]=g.useState(null),[a,l]=g.useState({name:"",street:"",city:"",state:"",zipCode:"",country:"",isDefault:!1}),d=h=>{if(h.preventDefault(),r)e(s.map(m=>m.id===r.id?{...a,id:r.id}:m));else{const m={...a,id:Date.now().toString()};e([...s,m])}n(!1),o(null),l({name:"",street:"",city:"",state:"",zipCode:"",country:"",isDefault:!1})},c=h=>{o(h),l(h),n(!0)},u=h=>{e(s.filter(m=>m.id!==h))};return i.jsxs("div",{className:"text-white",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Your Addresses"}),i.jsxs("button",{onClick:()=>n(!0),className:"flex items-center space-x-2 px-4 py-2 bg-accent-600 rounded-lg hover:bg-accent-700",children:[i.jsx(As,{className:"w-4 h-4"}),i.jsx("span",{children:"Add Address"})]})]}),t&&i.jsxs("div",{className:"bg-white/10 rounded-xl p-6 mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4",children:r?"Edit Address":"Add New Address"}),i.jsxs("form",{onSubmit:d,className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Full Name"}),i.jsx("input",{type:"text",value:a.name,onChange:h=>l({...a,name:h.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Street Address"}),i.jsx("input",{type:"text",value:a.street,onChange:h=>l({...a,street:h.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"City"}),i.jsx("input",{type:"text",value:a.city,onChange:h=>l({...a,city:h.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"State"}),i.jsx("input",{type:"text",value:a.state,onChange:h=>l({...a,state:h.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"ZIP Code"}),i.jsx("input",{type:"text",value:a.zipCode,onChange:h=>l({...a,zipCode:h.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Country"}),i.jsx("input",{type:"text",value:a.country,onChange:h=>l({...a,country:h.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"checkbox",id:"isDefault",checked:a.isDefault,onChange:h=>l({...a,isDefault:h.target.checked}),className:"rounded border-white/20 bg-white/10 text-accent-600 focus:ring-accent-500"}),i.jsx("label",{htmlFor:"isDefault",className:"text-sm",children:"Set as default address"})]}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("button",{type:"submit",className:"px-6 py-2 bg-accent-600 rounded-lg hover:bg-accent-700",children:r?"Update Address":"Add Address"}),i.jsx("button",{type:"button",onClick:()=>{n(!1),o(null)},className:"px-6 py-2 border border-white/20 rounded-lg hover:bg-white/10",children:"Cancel"})]})]})]}),i.jsx("div",{className:"space-y-4",children:s.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(Ds,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),i.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No Addresses Yet"}),i.jsx("p",{className:"text-white/70",children:"Add your first address to get started"})]}):s.map(h=>i.jsx("div",{className:"bg-white/10 rounded-xl p-6",children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold",children:h.name}),i.jsx("p",{className:"text-white/70",children:h.street}),i.jsxs("p",{className:"text-white/70",children:[h.city,", ",h.state," ",h.zipCode]}),i.jsx("p",{className:"text-white/70",children:h.country}),h.isDefault&&i.jsx("span",{className:"inline-block mt-2 px-2 py-1 bg-accent-600/20 text-accent-400 text-sm rounded",children:"Default Address"})]}),i.jsxs("div",{className:"flex space-x-2",children:[i.jsx("button",{onClick:()=>c(h),className:"p-2 hover:bg-white/10 rounded-lg",children:i.jsx(Ms,{className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>u(h.id),className:"p-2 hover:bg-white/10 rounded-lg text-red-400",children:i.jsx(Ls,{className:"w-4 h-4"})})]})]})},h.id))})]})}function Gd(){const[s,e]=g.useState([]),[t,n]=g.useState(!1),[r,o]=g.useState({cardNumber:"",expiryDate:"",cardHolder:"",isDefault:!1}),a=c=>{c.preventDefault();const u={...r,id:Date.now().toString(),cardNumber:r.cardNumber.replace(/\s/g,"").slice(-4)};e([...s,u]),n(!1),o({cardNumber:"",expiryDate:"",cardHolder:"",isDefault:!1})},l=c=>{e(u=>u.filter(h=>h.id!==c))},d=c=>{const h=c.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,16}/g),m=h&&h[0]||"",p=[];for(let f=0,_=m.length;f<_;f+=4)p.push(m.substring(f,f+4));return p.length?p.join(" "):c};return i.jsxs("div",{className:"text-white",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Payment Methods"}),i.jsxs("button",{onClick:()=>n(!0),className:"flex items-center space-x-2 px-4 py-2 bg-accent-600 rounded-lg hover:bg-accent-700",children:[i.jsx(As,{className:"w-4 h-4"}),i.jsx("span",{children:"Add Payment Method"})]})]}),t&&i.jsxs("div",{className:"bg-white/10 rounded-xl p-6 mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add New Payment Method"}),i.jsxs("form",{onSubmit:a,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Card Number"}),i.jsx("input",{type:"text",value:r.cardNumber,onChange:c=>o({...r,cardNumber:d(c.target.value)}),maxLength:19,className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Expiry Date"}),i.jsx("input",{type:"text",value:r.expiryDate,onChange:c=>{const u=c.target.value.replace(/\D/g,"");if(u.length<=4){const h=u.slice(0,2),m=u.slice(2);o({...r,expiryDate:u.length>2?`${h}/${m}`:h})}},placeholder:"MM/YY",maxLength:5,className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Card Holder"}),i.jsx("input",{type:"text",value:r.cardHolder,onChange:c=>o({...r,cardHolder:c.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"checkbox",id:"isDefault",checked:r.isDefault,onChange:c=>o({...r,isDefault:c.target.checked}),className:"rounded border-white/20 bg-white/10 text-accent-600 focus:ring-accent-500"}),i.jsx("label",{htmlFor:"isDefault",className:"text-sm",children:"Set as default payment method"})]}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("button",{type:"submit",className:"px-6 py-2 bg-accent-600 rounded-lg hover:bg-accent-700",children:"Add Card"}),i.jsx("button",{type:"button",onClick:()=>n(!1),className:"px-6 py-2 border border-white/20 rounded-lg hover:bg-white/10",children:"Cancel"})]})]})]}),i.jsx("div",{className:"space-y-4",children:s.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(Tt,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),i.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No Payment Methods"}),i.jsx("p",{className:"text-white/70",children:"Add your first payment method to get started"})]}):s.map(c=>i.jsx("div",{className:"bg-white/10 rounded-xl p-6",children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(Tt,{className:"w-5 h-5"}),i.jsxs("h3",{className:"font-semibold",children:["•••• ",c.cardNumber]})]}),i.jsxs("p",{className:"text-white/70 mt-1",children:["Expires ",c.expiryDate]}),i.jsx("p",{className:"text-white/70",children:c.cardHolder}),c.isDefault&&i.jsx("span",{className:"inline-block mt-2 px-2 py-1 bg-accent-600/20 text-accent-400 text-sm rounded",children:"Default Payment Method"})]}),i.jsx("button",{onClick:()=>l(c.id),className:"p-2 hover:bg-white/10 rounded-lg text-red-400",children:i.jsx(Ls,{className:"w-4 h-4"})})]})},c.id))})]})}const Bd=[{id:"orders",title:"Order Updates",description:"Get notified about your order status and delivery updates",email:!0,sms:!0,push:!0},{id:"promotions",title:"Promotions & Deals",description:"Receive updates about sales, discounts, and special offers",email:!0,sms:!1,push:!0},{id:"security",title:"Security Alerts",description:"Important updates about your account security",email:!0,sms:!0,push:!0},{id:"newsletter",title:"Newsletter",description:"Weekly updates about new products and trends",email:!0,sms:!1,push:!1}];function $d(){const[s,e]=g.useState(Bd),t=(n,r)=>{e(o=>o.map(a=>a.id===n?{...a,[r]:!a[r]}:a))};return i.jsxs("div",{className:"text-white",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Notification Settings"}),i.jsxs("div",{className:"bg-white/10 rounded-xl p-6 mb-6",children:[i.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[i.jsx("div",{className:"w-12 h-12 bg-accent-600 rounded-full flex items-center justify-center",children:i.jsx(it,{className:"w-6 h-6"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-semibold",children:"Manage Notifications"}),i.jsx("p",{className:"text-white/70",children:"Choose how you want to be notified"})]})]}),i.jsx("div",{className:"space-y-6",children:s.map(n=>i.jsxs("div",{className:"pb-6 border-b border-white/10 last:border-0",children:[i.jsxs("div",{className:"mb-4",children:[i.jsx("h4",{className:"font-medium",children:n.title}),i.jsx("p",{className:"text-sm text-white/70",children:n.description})]}),i.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[i.jsx("div",{children:i.jsxs("label",{className:"flex items-center space-x-3",children:[i.jsx("input",{type:"checkbox",checked:n.email,onChange:()=>t(n.id,"email"),className:"rounded border-white/20 bg-white/10 text-accent-600 focus:ring-accent-500"}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(Ts,{className:"w-4 h-4"}),i.jsx("span",{className:"text-sm",children:"Email"})]})]})}),i.jsx("div",{children:i.jsxs("label",{className:"flex items-center space-x-3",children:[i.jsx("input",{type:"checkbox",checked:n.sms,onChange:()=>t(n.id,"sms"),className:"rounded border-white/20 bg-white/10 text-accent-600 focus:ring-accent-500"}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(pi,{className:"w-4 h-4"}),i.jsx("span",{className:"text-sm",children:"SMS"})]})]})}),i.jsx("div",{children:i.jsxs("label",{className:"flex items-center space-x-3",children:[i.jsx("input",{type:"checkbox",checked:n.push,onChange:()=>t(n.id,"push"),className:"rounded border-white/20 bg-white/10 text-accent-600 focus:ring-accent-500"}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(Uo,{className:"w-4 h-4"}),i.jsx("span",{className:"text-sm",children:"Push"})]})]})})]})]},n.id))})]}),i.jsxs("div",{className:"bg-white/10 rounded-xl p-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quiet Hours"}),i.jsx("p",{className:"text-white/70 mb-4",children:"During these hours, you won't receive any notifications except for critical security alerts"}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Start Time"}),i.jsx("input",{type:"time",defaultValue:"22:00",className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"End Time"}),i.jsx("input",{type:"time",defaultValue:"07:00",className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20"})]})]})]})]})}const Kd=[{id:"personalization",title:"Personalized Recommendations",description:"Allow us to use your browsing history to show relevant products",enabled:!0},{id:"analytics",title:"Analytics & Improvements",description:"Help us improve our services by sharing usage data",enabled:!0},{id:"marketing",title:"Marketing Communications",description:"Receive personalized marketing communications",enabled:!1},{id:"thirdParty",title:"Third-Party Sharing",description:"Share data with trusted partners for better services",enabled:!1}];function Qd(){const[s,e]=g.useState(Kd),t=n=>{e(r=>r.map(o=>o.id===n?{...o,enabled:!o.enabled}:o))};return i.jsxs("div",{className:"text-white",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Privacy Settings"}),i.jsxs("div",{className:"bg-white/10 rounded-xl p-6",children:[i.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[i.jsx("div",{className:"w-12 h-12 bg-accent-600 rounded-full flex items-center justify-center",children:i.jsx($t,{className:"w-6 h-6"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-semibold",children:"Data Privacy"}),i.jsx("p",{className:"text-white/70",children:"Manage how your data is used and shared"})]})]}),i.jsx("div",{className:"space-y-6",children:s.map(n=>i.jsxs("div",{className:"flex items-center justify-between pb-6 border-b border-white/10 last:border-0",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium",children:n.title}),i.jsx("p",{className:"text-sm text-white/70",children:n.description})]}),i.jsx("button",{onClick:()=>t(n.id),className:"text-accent-400",children:n.enabled?i.jsx(zo,{className:"w-10 h-10"}):i.jsx(Ho,{className:"w-10 h-10 text-white/50"})})]},n.id))})]})]})}const Xd=[{id:"overview",label:"Account Overview",icon:ft},{id:"orders",label:"Your Orders",icon:qe},{id:"security",label:"Login & Security",icon:Rs},{id:"addresses",label:"Your Addresses",icon:Ds},{id:"payments",label:"Payment Methods",icon:Tt},{id:"notifications",label:"Notifications",icon:it},{id:"privacy",label:"Privacy Settings",icon:$t}];function Jd({isOpen:s,onClose:e}){const[t,n]=g.useState("overview"),[r,o]=g.useState({x:0,y:0}),{currentUser:a,logout:l}=le();if(g.useEffect(()=>{const u=()=>{o({x:window.scrollX*.1,y:window.scrollY*.1})};return s&&(window.addEventListener("scroll",u),document.body.style.overflow="hidden"),()=>{window.removeEventListener("scroll",u),document.body.style.overflow=""}},[s]),!s||!a)return null;const d=async()=>{try{await l(),e()}catch(u){console.error("Logout failed:",u)}},c=()=>{switch(t){case"overview":return i.jsx(ci,{});case"orders":return i.jsx(Hd,{});case"security":return i.jsx(Vd,{});case"addresses":return i.jsx(Yd,{});case"payments":return i.jsx(Gd,{});case"notifications":return i.jsx($d,{});case"privacy":return i.jsx(Qd,{});default:return i.jsx(ci,{})}};return i.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:e}),i.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:'url("https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1974&q=80")',transform:`translate(${r.x}px, ${r.y}px)`,transition:"transform 0.1s ease-out"},children:i.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"})}),i.jsx("div",{className:"relative min-h-screen flex items-center justify-center p-4",children:i.jsx("div",{className:"bg-white/10 backdrop-blur-md w-full max-w-6xl rounded-2xl shadow-2xl overflow-hidden border border-white/20",children:i.jsxs("div",{className:"flex h-[80vh]",children:[i.jsxs("div",{className:"w-64 bg-black/20 p-6 space-y-6",children:[i.jsxs("div",{className:"flex items-center space-x-3 mb-8",children:[a.photoURL?i.jsx("img",{src:a.photoURL,alt:"Profile",className:"w-10 h-10 rounded-full"}):i.jsx("div",{className:"w-10 h-10 rounded-full bg-accent-600 flex items-center justify-center",children:i.jsx(ft,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{className:"text-white",children:[i.jsx("p",{className:"font-medium",children:a.displayName||"User"}),i.jsx("p",{className:"text-sm text-white/70",children:a.email})]})]}),i.jsx("nav",{className:"space-y-2",children:Xd.map(u=>i.jsxs("button",{onClick:()=>n(u.id),className:`w-full flex items-center space-x-3 px-4 py-2 rounded-lg transition-colors ${t===u.id?"bg-white/20 text-white":"text-white/70 hover:bg-white/10 hover:text-white"}`,children:[i.jsx(u.icon,{className:"w-5 h-5"}),i.jsx("span",{children:u.label})]},u.id))}),i.jsxs("button",{onClick:d,className:"w-full flex items-center space-x-3 px-4 py-2 rounded-lg text-white/70 hover:bg-white/10 hover:text-white transition-colors mt-auto",children:[i.jsx(gi,{className:"w-5 h-5"}),i.jsx("span",{children:"Log Out"})]})]}),i.jsxs("div",{className:"flex-1 p-8 overflow-y-auto",children:[i.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-white/70 hover:text-white",children:i.jsx(Ue,{className:"w-6 h-6"})}),i.jsx("div",{className:"max-w-3xl mx-auto",children:c()})]})]})})})]})}function Zd(){const[s,e]=g.useState(!1),[t,n]=g.useState(!1),{currentUser:r}=le(),o=je();return i.jsxs(i.Fragment,{children:[i.jsxs("nav",{className:"bg-white shadow-md fixed w-full z-50",children:[i.jsx("div",{className:"max-w-7xl mx-auto px-4",children:i.jsxs("div",{className:"flex justify-between items-center h-16",children:[i.jsx(L,{to:"/",className:"text-2xl font-bold text-accent-600 tracking-tight",children:"MSPL Store"}),i.jsxs("div",{className:"hidden md:flex space-x-8",children:[i.jsx(L,{to:"/electronics",className:"text-primary-700 hover:text-accent-600 transition-colors",children:"Electronics"}),i.jsx(L,{to:"/men",className:"text-primary-700 hover:text-accent-600 transition-colors",children:"Men"}),i.jsx(L,{to:"/women",className:"text-primary-700 hover:text-accent-600 transition-colors",children:"Women"}),i.jsx(L,{to:"/watches",className:"text-primary-700 hover:text-accent-600 transition-colors",children:"Watches"})]}),i.jsxs("div",{className:"flex items-center space-x-6",children:[i.jsx("button",{onClick:()=>r?n(!0):o("/login"),className:"text-primary-700 hover:text-accent-600 transition-colors",children:i.jsx(ft,{className:"h-6 w-6"})}),i.jsx(L,{to:"/cart",className:"text-primary-700 hover:text-accent-600 transition-colors",children:i.jsx(qe,{className:"h-6 w-6"})}),i.jsx("button",{onClick:()=>e(!s),className:"md:hidden text-primary-700",children:s?i.jsx(Ue,{className:"h-6 w-6"}):i.jsx(Vo,{className:"h-6 w-6"})})]})]})}),s&&i.jsx("div",{className:"md:hidden border-t border-gray-200 py-4",children:i.jsxs("div",{className:"flex flex-col space-y-4",children:[i.jsx(L,{to:"/electronics",className:"text-primary-700 hover:text-accent-600 px-4",onClick:()=>e(!1),children:"Electronics"}),i.jsx(L,{to:"/men",className:"text-primary-700 hover:text-accent-600 px-4",onClick:()=>e(!1),children:"Men"}),i.jsx(L,{to:"/women",className:"text-primary-700 hover:text-accent-600 px-4",onClick:()=>e(!1),children:"Women"}),i.jsx(L,{to:"/watches",className:"text-primary-700 hover:text-accent-600 px-4",onClick:()=>e(!1),children:"Watches"})]})})]}),i.jsx(Jd,{isOpen:t,onClose:()=>n(!1)})]})}function eh(){const[s,e]=g.useState(""),t=r=>{r.preventDefault(),e("")},n=()=>{window.scrollTo({top:0,behavior:"smooth"})};return i.jsxs("footer",{className:"relative bg-gradient-to-b from-gray-900 to-black text-white",children:[i.jsx("div",{className:"absolute inset-0 opacity-5",children:i.jsx("div",{className:"absolute inset-0",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`,backgroundSize:"30px 30px"}})}),i.jsxs("div",{className:"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-16 pb-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"text-2xl font-bold tracking-tight",children:"MSPL Store"}),i.jsx("p",{className:"text-gray-400 text-sm",children:"Your premium destination for fashion and lifestyle. Discover curated collections that define modern luxury."}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("a",{href:"#",className:"text-gray-400 hover:text-accent-500 transition-colors",children:i.jsx(xi,{className:"w-5 h-5"})}),i.jsx("a",{href:"#",className:"text-gray-400 hover:text-accent-500 transition-colors",children:i.jsx(_i,{className:"w-5 h-5"})}),i.jsx("a",{href:"#",className:"text-gray-400 hover:text-accent-500 transition-colors",children:i.jsx(Yo,{className:"w-5 h-5"})}),i.jsx("a",{href:"#",className:"text-gray-400 hover:text-accent-500 transition-colors",children:i.jsx(Go,{className:"w-5 h-5"})})]})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Quick Links"}),i.jsx("ul",{className:"space-y-2",children:["About Us","FAQs","Privacy Policy"].map(r=>i.jsx("li",{children:i.jsxs(L,{to:`/${r.toLowerCase().replace(/\s+/g,"-")}`,className:"text-gray-400 hover:text-white transition-colors inline-flex items-center group",children:[i.jsx(ye,{className:"w-4 h-4 mr-1 transform group-hover:translate-x-1 transition-transform"}),r]})},r))})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Contact Us"}),i.jsxs("ul",{className:"space-y-4",children:[i.jsxs("li",{className:"flex items-start space-x-3 text-gray-400",children:[i.jsx(Ds,{className:"w-5 h-5 mt-0.5 text-accent-500"}),i.jsx("span",{children:"123 Fashion Street, Style City, ST 12345"})]}),i.jsxs("li",{className:"flex items-center space-x-3 text-gray-400",children:[i.jsx(Bo,{className:"w-5 h-5 text-accent-500"}),i.jsx("span",{children:"+1 (555) 123-4567"})]}),i.jsxs("li",{className:"flex items-center space-x-3 text-gray-400",children:[i.jsx(Ts,{className:"w-5 h-5 text-accent-500"}),i.jsx("span",{children:"support@msplstore.com"})]})]})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Newsletter"}),i.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Subscribe to receive updates, access to exclusive deals, and more."}),i.jsx("form",{onSubmit:t,className:"space-y-2",children:i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"email",value:s,onChange:r=>e(r.target.value),placeholder:"Enter your email",className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:border-accent-500 text-white placeholder-gray-400",required:!0}),i.jsx("button",{type:"submit",className:"absolute right-2 top-1/2 -translate-y-1/2 text-accent-500 hover:text-accent-400",children:i.jsx(ye,{className:"w-5 h-5"})})]})})]})]}),i.jsxs("div",{className:"mt-12 pt-8 border-t border-white/10 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0",children:[i.jsxs("p",{className:"text-gray-400 text-sm",children:["© ",new Date().getFullYear()," MSPL Store. All rights reserved."]}),i.jsxs("div",{className:"flex space-x-6 text-sm text-gray-400",children:[i.jsx(L,{to:"/terms",className:"hover:text-white transition-colors",children:"Terms"}),i.jsx(L,{to:"/privacy",className:"hover:text-white transition-colors",children:"Privacy"}),i.jsx(L,{to:"/cookies",className:"hover:text-white transition-colors",children:"Cookies"})]})]})]}),i.jsx("button",{onClick:n,className:"fixed bottom-8 right-8 bg-accent-600 text-white p-3 rounded-full shadow-lg hover:bg-accent-700 transition-colors focus:outline-none focus:ring-2 focus:ring-accent-500 focus:ring-offset-2","aria-label":"Back to top",children:i.jsx($o,{className:"w-5 h-5"})})]})}function jt({children:s,requireAuth:e=!0}){const{currentUser:t,loading:n}=le(),r=Qr();return n?i.jsx("div",{className:"min-h-screen flex items-center justify-center",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent-600"})}):e&&!t?i.jsx(ps,{to:"/login",state:{from:r},replace:!0}):!e&&t?i.jsx(ps,{to:"/",replace:!0}):i.jsx(i.Fragment,{children:s})}function th(){const[s,e]=g.useState(""),[t,n]=g.useState(""),[r,o]=g.useState(!1),[a,l]=g.useState(!1),d=je(),{login:c}=le(),u=async h=>{h.preventDefault(),l(!0);try{await c(s,t),d("/")}catch(m){console.error("Login error:",m)}finally{l(!1)}};return i.jsxs("div",{className:"min-h-screen flex items-center justify-center relative",children:[i.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat",style:{backgroundImage:'url("https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1974&q=80")'},children:i.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm"})}),i.jsx("div",{className:"relative w-full max-w-md p-6",children:i.jsxs("div",{className:"bg-white/10 backdrop-blur-md p-8 rounded-2xl shadow-2xl border border-white/20",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Welcome Back"}),i.jsx("p",{className:"text-gray-200",children:"Please sign in to your account"})]}),i.jsxs("form",{onSubmit:u,className:"space-y-6",children:[i.jsx("div",{children:i.jsx("input",{type:"email",placeholder:"Email",value:s,onChange:h=>e(h.target.value),className:"w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:border-white/40 transition duration-200",required:!0})}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:r?"text":"password",placeholder:"Password",value:t,onChange:h=>n(h.target.value),className:"w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:border-white/40 transition duration-200",required:!0}),i.jsx("button",{type:"button",onClick:()=>o(!r),className:"absolute right-3 top-1/2 -translate-y-1/2 text-white/60 hover:text-white",children:r?i.jsx(Ko,{className:"w-5 h-5"}):i.jsx(Fs,{className:"w-5 h-5"})})]}),i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("label",{className:"flex items-center text-white",children:[i.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-white/20 bg-white/10 checked:bg-blue-500 checked:border-blue-500 focus:ring-0 focus:ring-offset-0"}),i.jsx("span",{className:"ml-2",children:"Remember me"})]}),i.jsx(L,{to:"/forgot-password",className:"text-white hover:text-blue-400",children:"Forgot Password?"})]}),i.jsx("button",{type:"submit",disabled:a,className:"w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200 disabled:opacity-50",children:a?"Signing in...":"Sign In"})]}),i.jsx("div",{className:"mt-8 text-center",children:i.jsxs("p",{className:"text-white",children:["Don't have an account?"," ",i.jsx(L,{to:"/register",className:"text-blue-400 hover:text-blue-300",children:"Sign up"})]})}),i.jsxs("div",{className:"mt-8",children:[i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-0 flex items-center",children:i.jsx("div",{className:"w-full border-t border-white/20"})}),i.jsx("div",{className:"relative flex justify-center text-sm",children:i.jsx("span",{className:"px-2 bg-transparent text-white",children:"Or continue with"})})]}),i.jsx("div",{className:"mt-6",children:i.jsxs("button",{type:"button",className:"w-full flex items-center justify-center gap-2 bg-white/10 hover:bg-white/20 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 border border-white/20",children:[i.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[i.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),i.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),i.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),i.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})})]})]})})]})}function sh(){const[s,e]=g.useState(""),[t,n]=g.useState(""),[r,o]=g.useState(""),[a,l]=g.useState(""),[d,c]=g.useState(!1),u=je(),{register:h}=le(),m=async p=>{if(p.preventDefault(),r!==a){toast.error("Passwords do not match");return}c(!0);try{await h(t,r,s),u("/")}catch{}finally{c(!1)}};return i.jsxs("div",{className:"max-w-md mx-auto mt-8 p-6 bg-white rounded-lg shadow-md",children:[i.jsx("h2",{className:"text-2xl font-bold text-center mb-6",children:"Register"}),i.jsxs("form",{onSubmit:m,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Full Name"}),i.jsx("input",{type:"text",id:"name",value:s,onChange:p=>e(p.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent-500 focus:ring-accent-500",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),i.jsx("input",{type:"email",id:"email",value:t,onChange:p=>n(p.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent-500 focus:ring-accent-500",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),i.jsx("input",{type:"password",id:"password",value:r,onChange:p=>o(p.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent-500 focus:ring-accent-500",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),i.jsx("input",{type:"password",id:"confirmPassword",value:a,onChange:p=>l(p.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent-500 focus:ring-accent-500",required:!0})]}),i.jsx("button",{type:"submit",disabled:d,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-accent-600 hover:bg-accent-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-500 disabled:opacity-50",children:d?"Creating account...":"Register"})]}),i.jsx("div",{className:"mt-4 text-center text-sm",children:i.jsxs("p",{className:"text-gray-600",children:["Already have an account?"," ",i.jsx(L,{to:"/login",className:"text-accent-600 hover:text-accent-700",children:"Login here"})]})})]})}function B({children:s,backgroundImage:e,speed:t=.5,blur:n=!1,className:r=""}){const o=g.useRef(null),a=g.useRef(null);return g.useEffect(()=>{const l=o.current,d=a.current;if(!l||!d)return;let c;const u=()=>{c=requestAnimationFrame(()=>{const h=l.getBoundingClientRect(),m=window.scrollY,p=h.top+m,f=(m-p)*t;h.top<=window.innerHeight&&h.bottom>=0&&(d.style.transform=`translate3d(0, ${f}px, 0)`)})};return window.addEventListener("scroll",u,{passive:!0}),u(),()=>{window.removeEventListener("scroll",u),cancelAnimationFrame(c)}},[t]),i.jsxs("div",{ref:o,className:`relative overflow-hidden ${r}`,children:[i.jsx("div",{ref:a,className:"absolute inset-0 bg-cover bg-center -z-10 will-change-transform",style:{backgroundImage:`url(${e})`,transform:"translate3d(0, 0, 0)"}}),n&&i.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-[1px] -z-10","aria-hidden":"true"}),s]})}const nh=[{id:1,title:"Luxury Electronics",description:"Premium Tech & Gadgets",image:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&q=80&w=3440",category:"electronics",path:"/electronics",accent:"from-blue-500/20 to-purple-500/20"},{id:2,title:"Men's Essentials",description:"Timeless Style for Modern Men",image:"https://images.unsplash.com/photo-1617127365659-c47fa864d8bc?auto=format&fit=crop&w=3440&q=80",category:"men",path:"/men",accent:"from-amber-500/20 to-red-500/20"},{id:3,title:"Women's Collection",description:"Elegance Redefined",image:"https://images.unsplash.com/photo-1490481651871-ab68de25d43d?auto=format&fit=crop&w=3440&q=80",category:"women",path:"/women",accent:"from-pink-500/20 to-rose-500/20"},{id:4,title:"Luxury Timepieces",description:"Where Time Meets Style",image:"https://images.unsplash.com/photo-1523170335258-f5ed11844a49?auto=format&fit=crop&w=3440&q=80",category:"watches",path:"/watches",accent:"from-emerald-500/20 to-teal-500/20"}];function ih(){return i.jsx("section",{className:"py-16",children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[i.jsx(yi,{className:"w-6 h-6 text-accent-600"}),i.jsx("h2",{className:"text-3xl font-bold text-white",children:"Featured Collections"})]}),i.jsx("p",{className:"text-white/70 max-w-2xl mx-auto",children:"Explore our curated selection of premium collections, each telling a unique story of style and sophistication"})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:nh.map((s,e)=>i.jsxs(L,{to:s.path,className:`group relative overflow-hidden rounded-2xl bg-gradient-to-br ${s.accent} backdrop-blur-sm border border-white/10 ${e===0?"md:col-span-2 aspect-[2.4/1]":"aspect-[1.5/1]"}`,children:[i.jsx("div",{className:"absolute inset-0 bg-cover bg-center transition-transform duration-700 group-hover:scale-110",style:{backgroundImage:`url(${s.image})`}}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black/60 via-black/40 to-transparent backdrop-blur-[1px] transition-opacity duration-300 group-hover:opacity-75"}),i.jsx("div",{className:"relative h-full flex flex-col justify-end p-8",children:i.jsxs("div",{className:"transform transition-transform duration-300 group-hover:translate-y-0 translate-y-8",children:[i.jsx("h3",{className:"text-3xl font-bold text-white mb-3",children:s.title}),i.jsx("p",{className:"text-white/80 mb-6 transform opacity-0 transition-all duration-300 group-hover:opacity-100",children:s.description}),i.jsxs("div",{className:"inline-flex items-center gap-2 text-white font-medium opacity-0 transform translate-y-4 transition-all duration-300 group-hover:opacity-100 group-hover:translate-y-0",children:[i.jsx("span",{children:"Explore Collection"}),i.jsx(vi,{className:"w-5 h-5 transition-transform duration-300 group-hover:translate-x-2"})]})]})}),i.jsx("div",{className:"absolute top-6 right-6",children:i.jsx("div",{className:"w-12 h-12 rounded-full border border-white/20 flex items-center justify-center",children:i.jsx("div",{className:"w-8 h-8 rounded-full bg-white/10 backdrop-blur-sm"})})}),i.jsx("div",{className:"absolute bottom-0 left-0 w-1/3 h-1/3 bg-gradient-to-tr from-white/5 to-transparent rounded-tr-full opacity-0 transition-opacity duration-300 group-hover:opacity-100"})]},s.id))}),i.jsx("div",{className:"absolute -top-24 -right-24 w-96 h-96 bg-accent-600/10 rounded-full blur-3xl"}),i.jsx("div",{className:"absolute -bottom-24 -left-24 w-96 h-96 bg-accent-600/10 rounded-full blur-3xl"})]})})}const rh=[{id:1,name:"Classic White Tee",price:29.99,image:"https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Essential cotton crew neck t-shirt in pristine white.",sizes:["S","M","L","XL"],inStock:!0},{id:2,name:"Vintage Denim Jacket",price:89.99,image:"https://images.unsplash.com/photo-1495105787522-5334e3ffa0ef?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Classic denim jacket with a lived-in wash and comfortable fit.",sizes:["S","M","L","XL"],inStock:!0},{id:3,name:"Premium Chinos",price:79.99,image:"https://images.unsplash.com/photo-1473966968600-fa801b869a1a?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Versatile chinos perfect for any occasion.",sizes:["30","32","34","36"],inStock:!0},{id:4,name:"Merino Wool Sweater",price:129.99,image:"https://images.unsplash.com/photo-1620799140408-edc6dcb6d633?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Luxurious merino wool sweater for ultimate comfort.",sizes:["S","M","L","XL"],inStock:!0},{id:5,name:"Leather Chelsea Boots",price:199.99,image:"https://images.unsplash.com/photo-1638247025967-b4e38f787b76?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Handcrafted leather Chelsea boots with premium finish.",sizes:["40","41","42","43","44"],inStock:!0},{id:6,name:"Tailored Blazer",price:249.99,image:"https://images.unsplash.com/photo-1507679799987-c73779587ccf?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Sophisticated blazer for a sharp, professional look.",sizes:["S","M","L","XL"],inStock:!0},{id:7,name:"Premium Leather Belt",price:59.99,image:"https://images.unsplash.com/photo-1624222247344-550fb60583dc?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Full-grain leather belt with classic buckle.",sizes:["32","34","36","38"],inStock:!0},{id:8,name:"Aviator Sunglasses",price:159.99,image:"https://images.unsplash.com/photo-1511499767150-a48a237f0083?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Classic aviator sunglasses with premium lenses.",sizes:["One Size"],inStock:!0}],oh=[{id:9,name:"Silk Blouse",price:149.99,image:"https://images.unsplash.com/photo-1485968579580-b6d095142e6e?auto=format&fit=crop&w=800&q=80",category:"Women",description:"Elegant silk blouse with refined details.",sizes:["XS","S","M","L"],inStock:!0},{id:10,name:"Designer Handbag",price:299.99,image:"https://images.unsplash.com/photo-1584917865442-de89df76afd3?auto=format&fit=crop&w=800&q=80",category:"Women",description:"Luxury designer handbag in genuine leather.",sizes:["One Size"],inStock:!0},{id:11,name:"High-Waisted Jeans",price:89.99,image:"https://images.unsplash.com/photo-1541099649105-f69ad21f3246?auto=format&fit=crop&w=800&q=80",category:"Women",description:"Perfect-fit high-waisted jeans with stretch.",sizes:["24","25","26","27","28","29","30"],inStock:!0},{id:12,name:"Evening Dress",price:279.99,image:"https://images.unsplash.com/photo-1572804013309-59a88b7e92f1?auto=format&fit=crop&w=800&q=80",category:"Women",description:"Stunning evening dress for special occasions.",sizes:["XS","S","M","L"],inStock:!0},{id:13,name:"Leather Ankle Boots",price:189.99,image:"https://images.unsplash.com/photo-1543163521-1bf539c55dd2?auto=format&fit=crop&q=80&w=800",category:"Women",description:"Stylish leather ankle boots with block heel.",sizes:["36","37","38","39","40"],inStock:!0},{id:14,name:"Cashmere Scarf",price:129.99,image:"https://images.unsplash.com/photo-1601924994987-69e26d50dc26?auto=format&fit=crop&q=80&w=800",category:"Women",description:"Luxuriously soft cashmere scarf.",sizes:["One Size"],inStock:!0},{id:15,name:"Statement Earrings",price:79.99,image:"https://images.unsplash.com/photo-1535632066927-ab7c9ab60908?auto=format&fit=crop&q=80&w=800",category:"Women",description:"Eye-catching statement earrings in gold finish.",sizes:["One Size"],inStock:!0},{id:16,name:"Midi Skirt",price:119.99,image:"https://images.unsplash.com/photo-1583496661160-fb5886a0aaaa?auto=format&fit=crop&q=80&w=800",category:"Women",description:"Elegant pleated midi skirt in seasonal colors.",sizes:["XS","S","M","L"],inStock:!0}],ah=[{id:17,name:"Colorful T-Shirt Set",price:39.99,image:"https://images.unsplash.com/photo-1519238263530-99bdd11df2ea?auto=format&fit=crop&w=800&q=80",category:"Kids",description:"Fun and comfortable t-shirt set for active kids.",sizes:["3-4Y","4-5Y","5-6Y","6-7Y","7-8Y"],inStock:!0},{id:18,name:"Kids Denim Collection",price:49.99,image:"https://images.unsplash.com/photo-1519238360324-0fc58c85f8de?auto=format&fit=crop&w=800&q=80",category:"Kids",description:"Durable denim pieces for everyday adventures.",sizes:["3-4Y","4-5Y","5-6Y","6-7Y","7-8Y"],inStock:!0},{id:19,name:"Party Dress",price:59.99,image:"https://images.unsplash.com/photo-1518831959646-742c3a14ebf7?auto=format&fit=crop&w=800&q=80",category:"Kids",description:"Elegant party dress for special occasions.",sizes:["3-4Y","4-5Y","5-6Y","6-7Y"],inStock:!0},{id:20,name:"Sports Set",price:45.99,image:"https://images.unsplash.com/photo-1519241047957-be31d7379a5d?auto=format&fit=crop&w=800&q=80",category:"Kids",description:"Comfortable sports set for active kids.",sizes:["4-5Y","5-6Y","6-7Y","7-8Y"],inStock:!0},{id:21,name:"Winter Jacket",price:79.99,image:"https://images.unsplash.com/photo-1545291730-faff8ca1d4b0?auto=format&fit=crop&q=80&w=800",category:"Kids",description:"Warm and cozy winter jacket with fun details.",sizes:["3-4Y","4-5Y","5-6Y","6-7Y","7-8Y"],inStock:!0},{id:22,name:"Cartoon Pajama Set",price:34.99,image:"https://images.unsplash.com/photo-1595034313282-a31ff30de d9?auto=format&fit=crop&q=80&w=800",category:"Kids",description:"Soft and cute pajama set with cartoon prints.",sizes:["3-4Y","4-5Y","5-6Y","6-7Y"],inStock:!0},{id:23,name:"School Backpack",price:39.99,image:"https://images.unsplash.com/photo-1546938576-6e6a64f317cc?auto=format&fit=crop&q=80&w=800",category:"Kids",description:"Durable and spacious backpack for school.",sizes:["One Size"],inStock:!0},{id:24,name:"Kids Sneakers",price:49.99,image:"https://images.unsplash.com/photo-1514989940723-e8e51635b782?auto=format&fit=crop&q=80&w=800",category:"Kids",description:"Comfortable and stylish sneakers for active kids.",sizes:["28","29","30","31","32","33","34"],inStock:!0}],lh=[{id:25,name:"Luxury Chronograph",price:599.99,image:"https://images.unsplash.com/photo-1524592094714-0f0654e20314?auto=format&fit=crop&w=800&q=80",category:"Watches",description:"Premium chronograph watch with Swiss movement.",sizes:["One Size"],inStock:!0},{id:26,name:"Smart Watch Pro",price:399.99,image:"https://images.unsplash.com/photo-1579586337278-3befd40fd17a?auto=format&fit=crop&w=800&q=80",category:"Watches",description:"Advanced smartwatch with health monitoring features.",sizes:["One Size"],inStock:!0},{id:27,name:"Classic Gold Watch",price:799.99,image:"https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?auto=format&fit=crop&w=800&q=80",category:"Watches",description:"Timeless gold-plated watch with leather strap.",sizes:["One Size"],inStock:!0},{id:28,name:"Minimalist Watch",price:299.99,image:"https://images.unsplash.com/photo-1508685096489-7aacd43bd3b1?auto=format&fit=crop&w=800&q=80",category:"Watches",description:"Clean, minimalist design with premium materials.",sizes:["One Size"],inStock:!0}],Ct=s=>s.map(e=>({...e,price:typeof e.price=="string"?parseFloat(e.price.replace(/[^0-9.-]+/g,""))*75:e.price*75})),di=[...Ct(rh),...Ct(oh),...Ct(ah),...Ct(lh)],Or=g.createContext(void 0);function ch({children:s}){const[e,t]=g.useState(()=>{const f=localStorage.getItem("products");return f?JSON.parse(f):di}),[n,r]=g.useState(!1),[o,a]=g.useState(null),l=f=>{localStorage.setItem("products",JSON.stringify(f))},d=g.useCallback(f=>{const _={...f,id:String(Date.now()),inStock:!0,sizes:f.sizes||["S","M","L","XL"]},v=[...e,_];t(v),l(v)},[e]),c=g.useCallback(f=>{const _=e.map(v=>v.id===f.id?f:v);t(_),l(_)},[e]),u=g.useCallback(f=>{const _=e.filter(v=>v.id!==f);t(_),l(_)},[e]),h=g.useCallback(f=>e.filter(_=>f==="All"?!0:_.category===f),[e]),m=g.useCallback(async()=>{try{r(!0),a(null);const f=localStorage.getItem("products");t(f?JSON.parse(f):di)}catch(f){a("Failed to refresh products"),console.error("Error refreshing products:",f)}finally{r(!1)}},[]),p={products:e,loading:n,error:o,addProduct:d,updateProduct:c,deleteProduct:u,getProductsByCategory:h,refreshProducts:m};return i.jsx(Or.Provider,{value:p,children:s})}function Ee(){const s=g.useContext(Or);if(s===void 0)throw new Error("useProducts must be used within a ProductProvider");return s}const bn=({product:s,isAdmin:e,onUpdate:t,onDelete:n,onQuickView:r})=>{const[o,a]=g.useState(!1),[l,d]=g.useState(s),[c,u]=g.useState(!1),h=s.media?.[0]?.url||s.image||"https://via.placeholder.com/400",m=async()=>{if(t)try{await t(l),a(!1),w.success("Product updated successfully")}catch{w.error("Failed to update product")}},p=async()=>{if(!(!n||!window.confirm("Are you sure you want to delete this product?")))try{await n(s.id),w.success("Product deleted successfully")}catch{w.error("Failed to delete product")}};return o?i.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[i.jsxs("div",{className:"flex justify-between mb-4",children:[i.jsx("h3",{className:"font-medium",children:"Edit Product"}),i.jsxs("div",{className:"flex space-x-2",children:[i.jsx("button",{onClick:m,className:"p-2 rounded-full bg-accent-600 text-white hover:bg-accent-700 transition-colors",title:"Save changes",children:i.jsx(wi,{className:"h-4 w-4"})}),i.jsx("button",{onClick:()=>{d(s),a(!1)},className:"p-2 rounded-full bg-gray-200 hover:bg-gray-300 transition-colors",title:"Cancel editing",children:i.jsx(Ue,{className:"h-4 w-4"})})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),i.jsx("input",{type:"text",value:l.name,onChange:f=>d({...l,name:f.target.value}),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-accent-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price (₹)"}),i.jsx("input",{type:"number",value:l.price,onChange:f=>d({...l,price:parseFloat(f.target.value)||0}),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-accent-500",step:"0.01",min:"0"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),i.jsx("textarea",{value:l.description,onChange:f=>d({...l,description:f.target.value}),rows:3,className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-accent-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),i.jsxs("select",{value:l.category,onChange:f=>d({...l,category:f.target.value}),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-accent-500",children:[i.jsx("option",{value:"Electronics",children:"Electronics"}),i.jsx("option",{value:"Men",children:"Men"}),i.jsx("option",{value:"Women",children:"Women"}),i.jsx("option",{value:"Watches",children:"Watches"}),i.jsx("option",{value:"Accessories",children:"Accessories"}),i.jsx("option",{value:"Footwear",children:"Footwear"})]})]})]})]}):i.jsxs("div",{className:"group relative bg-white rounded-xl overflow-hidden shadow-lg transition-all duration-300",onMouseEnter:()=>!e&&u(!0),onMouseLeave:()=>!e&&u(!1),children:[i.jsxs("div",{className:"relative overflow-hidden aspect-square",children:[i.jsx("img",{src:h,alt:s.name,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}),e&&i.jsxs("div",{className:"absolute top-4 right-4 z-20 flex space-x-2",children:[i.jsx("button",{onClick:()=>a(!0),className:"p-2 bg-accent-600 text-white rounded-full hover:bg-accent-700 transition-colors",children:i.jsx(Ms,{className:"h-4 w-4"})}),i.jsx("button",{onClick:p,className:"p-2 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors",children:i.jsx(Ls,{className:"h-4 w-4"})})]}),!e&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"absolute top-4 right-4 z-10",children:i.jsx("button",{className:`rounded-full p-2 transition-colors ${c?"bg-white text-accent-600":"bg-white/90 text-gray-600"}`,children:i.jsx(Os,{className:"h-4 w-4"})})}),i.jsx("div",{className:`absolute inset-0 bg-black/40 backdrop-blur-[1px] flex items-center justify-center transition-opacity duration-300 ${c?"opacity-100":"opacity-0"}`,children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("button",{onClick:()=>r?.(s),className:"flex items-center justify-center space-x-2 bg-white text-black px-6 py-2 rounded-full hover:bg-gray-100 transition-colors",children:[i.jsx(Fs,{className:"h-4 w-4"}),i.jsx("span",{children:"Quick View"})]}),i.jsxs("button",{className:"flex items-center justify-center space-x-2 bg-accent-600 text-white px-6 py-2 rounded-full hover:bg-accent-700 transition-colors w-full",children:[i.jsx(qe,{className:"h-4 w-4"}),i.jsx("span",{children:"Add to Cart"})]})]})})]})]}),i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start mb-2",children:[i.jsx("h3",{className:"font-semibold text-lg text-gray-900 group-hover:text-accent-600 transition-colors",children:s.name}),i.jsx("span",{className:"text-sm font-medium text-accent-600 bg-accent-50 px-2 py-1 rounded-full",children:s.category})]}),i.jsx("p",{className:"text-gray-600 text-sm mb-3",children:s.description}),i.jsx("p",{className:"text-xl font-bold text-gray-900",children:wn(s.price,"INR")})]})]})};function Nn({show:s,message:e,onClose:t}){return s?i.jsx("div",{className:"fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{children:e}),i.jsx("button",{onClick:t,className:"ml-4 text-white hover:text-gray-300",children:"×"})]})}):null}function dh({sizes:s,selectedSize:e,onSelect:t}){return i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Size"}),i.jsx("div",{className:"grid grid-cols-5 gap-2",children:s.map(n=>i.jsx("button",{onClick:()=>t(n),className:`py-2 text-sm font-medium rounded-md ${e===n?"bg-black text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"} transition-colors`,children:n},n))})]})}function Wr({product:s,onClose:e,onPrevious:t,onNext:n,showNavigation:r=!1,onAddToCart:o,onAddToWaitlist:a,isAdmin:l,onUpdate:d}){const[c,u]=g.useState(""),[h,m]=g.useState(""),[p,f]=g.useState(!1),[_,v]=g.useState(""),[N,y]=g.useState(!1),[E,Y]=g.useState(!1),[ce,jn]=g.useState(!1),[Q,ke]=g.useState(s),[Ye,wt]=g.useState(0);if(!s)return null;const de=s.media?.length?s.media.map(P=>P.url):s.image?[s.image]:["https://via.placeholder.com/400"],zr=P=>{P.target===P.currentTarget&&e()},Hr=()=>{if(!c){v("Please select a size"),f(!0);return}o(s,c),v("Added to cart successfully!"),f(!0)},Vr=P=>{if(P.preventDefault(),!c){v("Please select a size"),f(!0);return}if(!h){v("Please enter your email"),f(!0);return}a(s,h,c),v("Added to waitlist successfully!"),f(!0),y(!1),m("")},as=async P=>{const I=window.location.href,$r=`Check out ${s.name} - ${s.description}`;switch(P){case"facebook":window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(I)}`,"_blank");break;case"twitter":window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent($r)}&url=${encodeURIComponent(I)}`,"_blank");break;case"copy":try{await navigator.clipboard.writeText(I),v("Link copied to clipboard!"),f(!0)}catch{v("Failed to copy link"),f(!0)}break}Y(!1)},Yr=()=>{Q&&d&&(d(Q),v("Product updated successfully"),f(!0),jn(!1))},Gr=()=>{wt(P=>(P+1)%de.length)},Br=()=>{wt(P=>(P-1+de.length)%de.length)};return i.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-black/75 backdrop-blur-sm",onClick:zr,"aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:[i.jsx("div",{className:"flex min-h-screen items-center justify-center p-4",children:i.jsxs("div",{className:"relative w-full max-w-4xl rounded-2xl bg-white shadow-2xl",children:[i.jsxs("div",{className:"absolute right-4 top-4 z-10 flex space-x-2",children:[l&&!ce&&i.jsx("button",{onClick:()=>jn(!0),className:"rounded-full bg-black text-white p-2 hover:bg-gray-800 transition-colors",children:i.jsx(Ms,{className:"h-5 w-5"})}),l&&ce&&i.jsx("button",{onClick:Yr,className:"rounded-full bg-black text-white p-2 hover:bg-gray-800 transition-colors",children:i.jsx(wi,{className:"h-5 w-5"})}),i.jsxs("div",{className:"relative",children:[i.jsx("button",{onClick:()=>Y(!E),className:"rounded-full bg-white/90 p-2 hover:bg-white transition-colors","aria-label":"Share",children:i.jsx(Qo,{className:"h-5 w-5"})}),E&&i.jsx("div",{className:"absolute right-0 mt-2 w-48 rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5",children:i.jsxs("div",{className:"py-1",children:[i.jsxs("button",{onClick:()=>as("facebook"),className:"flex w-full items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[i.jsx(xi,{className:"mr-3 h-4 w-4"}),"Share on Facebook"]}),i.jsxs("button",{onClick:()=>as("twitter"),className:"flex w-full items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[i.jsx(_i,{className:"mr-3 h-4 w-4"}),"Share on Twitter"]}),i.jsxs("button",{onClick:()=>as("copy"),className:"flex w-full items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[i.jsx(Xo,{className:"mr-3 h-4 w-4"}),"Copy Link"]})]})})]}),i.jsx("button",{onClick:e,className:"rounded-full bg-white/90 p-2 hover:bg-white transition-colors",children:i.jsx(Ue,{className:"h-5 w-5"})})]}),r&&i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:t,className:"absolute left-4 top-1/2 -translate-y-1/2 rounded-full bg-white/90 p-3 hover:bg-white transition-colors shadow-lg",children:i.jsx(Rt,{className:"h-6 w-6"})}),i.jsx("button",{onClick:n,className:"absolute right-4 top-1/2 -translate-y-1/2 rounded-full bg-white/90 p-3 hover:bg-white transition-colors shadow-lg",children:i.jsx(ye,{className:"h-6 w-6"})})]}),i.jsxs("div",{className:"flex flex-col lg:flex-row",children:[i.jsxs("div",{className:"lg:w-1/2",children:[i.jsx("div",{className:"relative aspect-square",children:ce?i.jsxs("div",{className:"p-4",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Image URL"}),i.jsx("input",{type:"text",value:Q?.media?.[Ye]?.url||"",onChange:P=>{if(Q){const I=[...Q.media||[]];I[Ye]={url:P.target.value,type:"image"},ke({...Q,media:I})}},className:"w-full px-3 py-2 border rounded-md"})]}):i.jsxs("div",{className:"relative",children:[i.jsx("img",{src:de[Ye],alt:s.name,className:"h-full w-full object-cover rounded-t-2xl lg:rounded-l-2xl lg:rounded-tr-none"}),de.length>1&&i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:Br,className:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 p-2 rounded-full hover:bg-white transition-colors",children:i.jsx(Rt,{className:"h-5 w-5"})}),i.jsx("button",{onClick:Gr,className:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 p-2 rounded-full hover:bg-white transition-colors",children:i.jsx(ye,{className:"h-5 w-5"})}),i.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2",children:de.map((P,I)=>i.jsx("button",{onClick:()=>wt(I),className:`w-2 h-2 rounded-full transition-colors ${I===Ye?"bg-white":"bg-white/50"}`},I))})]})]})}),!ce&&de.length>1&&i.jsx("div",{className:"p-4 grid grid-cols-4 gap-2",children:de.map((P,I)=>i.jsx("button",{onClick:()=>wt(I),className:`aspect-square rounded-lg overflow-hidden border-2 transition-colors ${I===Ye?"border-accent-600":"border-transparent hover:border-accent-300"}`,children:i.jsx("img",{src:P,alt:`${s.name} view ${I+1}`,className:"w-full h-full object-cover"})},I))})]}),i.jsx("div",{className:"p-8 lg:w-1/2",children:ce?i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),i.jsx("input",{type:"text",value:Q?.name||"",onChange:P=>ke(I=>I?{...I,name:P.target.value}:null),className:"w-full px-3 py-2 border rounded-md"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price"}),i.jsx("input",{type:"number",value:typeof Q?.price=="string"?parseFloat(Q.price.replace(/[^0-9.-]+/g,""))||"":Q?.price||"",onChange:P=>ke(I=>I?{...I,price:parseFloat(P.target.value)||0}:null),className:"w-full px-3 py-2 border rounded-md",step:"0.01",min:"0"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),i.jsx("textarea",{value:Q?.description||"",onChange:P=>ke(I=>I?{...I,description:P.target.value}:null),rows:3,className:"w-full px-3 py-2 border rounded-md"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),i.jsxs("select",{value:Q?.category||"",onChange:P=>ke(I=>I?{...I,category:P.target.value}:null),className:"w-full px-3 py-2 border rounded-md",children:[i.jsx("option",{value:"Electronics",children:"Electronics"}),i.jsx("option",{value:"Men",children:"Men"}),i.jsx("option",{value:"Women",children:"Women"}),i.jsx("option",{value:"Watches",children:"Watches"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Stock Status"}),i.jsxs("select",{value:Q?.inStock?"true":"false",onChange:P=>ke(I=>I?{...I,inStock:P.target.value==="true"}:null),className:"w-full px-3 py-2 border rounded-md",children:[i.jsx("option",{value:"true",children:"In Stock"}),i.jsx("option",{value:"false",children:"Out of Stock"})]})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"mb-8",children:[i.jsx("p",{className:"text-sm text-gray-500 mb-2 uppercase tracking-wider",children:s.category}),i.jsxs("div",{className:"flex flex-col mb-4",children:[i.jsx("h2",{className:"text-2xl font-bold mb-2",children:s.name}),i.jsx("p",{className:"text-xl font-semibold text-gray-900",children:wn(s.price)})]}),i.jsx("p",{className:"text-gray-600 mb-4",children:s.description}),i.jsx("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:i.jsxs("p",{className:"text-sm text-gray-600",children:[i.jsx("span",{className:"font-medium",children:"Return Policy:"})," Only replacements are available for this item. No returns accepted."]})}),i.jsx(dh,{sizes:s.sizes||["XS","S","M","L","XL"],selectedSize:c,onSelect:u})]}),N?i.jsxs("form",{onSubmit:Vr,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),i.jsx("input",{type:"email",id:"email",required:!0,value:h,onChange:P=>m(P.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-black focus:border-transparent",placeholder:"Enter your email"})]}),i.jsx("button",{type:"submit",className:"w-full bg-black text-white px-6 py-3 rounded-full hover:bg-gray-800 transition-colors",children:"Join Waitlist"}),i.jsx("button",{type:"button",onClick:()=>y(!1),className:"w-full border border-gray-300 px-6 py-3 rounded-full hover:bg-gray-50 transition-colors",children:"Cancel"})]}):i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"grid grid-cols-2 gap-4",children:s.inStock!==!1?i.jsxs(i.Fragment,{children:[i.jsxs("button",{onClick:Hr,className:"flex items-center justify-center space-x-2 bg-black text-white px-6 py-3 rounded-full hover:bg-gray-800 transition-colors",children:[i.jsx(qe,{className:"h-5 w-5"}),i.jsx("span",{children:"Add to Cart"})]}),i.jsxs("button",{onClick:()=>y(!0),className:"flex items-center justify-center space-x-2 border border-black text-black px-6 py-3 rounded-full hover:bg-gray-100 transition-colors",children:[i.jsx(it,{className:"h-5 w-5"}),i.jsx("span",{children:"Notify Me"})]})]}):i.jsxs("button",{onClick:()=>y(!0),className:"col-span-2 flex items-center justify-center space-x-2 bg-gray-800 text-white px-6 py-3 rounded-full hover:bg-gray-700 transition-colors",children:[i.jsx(it,{className:"h-5 w-5"}),i.jsx("span",{children:"Join Waitlist"})]})}),i.jsxs("button",{className:"w-full flex items-center justify-center space-x-2 border border-gray-300 px-6 py-3 rounded-full hover:bg-gray-50 transition-colors",children:[i.jsx(Os,{className:"h-5 w-5"}),i.jsx("span",{children:"Add to Wishlist"})]})]})]})})]})]})}),i.jsx(Nn,{show:p,message:_,onClose:()=>f(!1)})]})}const hh=g.memo(function(){const{products:e,loading:t,error:n}=Ee(),[r,o]=g.useState(null),[a,l]=g.useState(0),d=[...e,{id:"new-watch-1",name:"Limited Edition Watch",price:899.99,image:"https://images.unsplash.com/photo-1524592094714-0f0654e20314?auto=format&fit=crop&w=800&q=80",category:"Watches",description:"Exclusive limited edition timepiece",inStock:!0},{id:"new-sunglasses-1",name:"Designer Sunglasses",price:299.99,image:"https://images.unsplash.com/photo-1511499767150-a48a237f0083?auto=format&fit=crop&w=800&q=80",category:"Accessories",description:"Premium designer sunglasses",inStock:!0},{id:"new-bag-1",name:"Leather Crossbody Bag",price:459.99,image:"https://images.unsplash.com/photo-1584917865442-de89df76afd3?auto=format&fit=crop&w=800&q=80",category:"Accessories",description:"Handcrafted leather crossbody bag",inStock:!0},{id:"new-sneakers-1",name:"Premium Sneakers",price:189.99,image:"https://images.unsplash.com/photo-1552346154-21d32810aba3?auto=format&fit=crop&w=800&q=80",category:"Footwear",description:"Premium comfort sneakers",inStock:!0}].slice(0,12);if(t)return i.jsx("div",{className:"flex justify-center items-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent-600"})});if(n)return i.jsx("div",{className:"text-center py-12 text-red-500",children:n});const c=(h,m)=>{o(h),l(m)},u=h=>typeof h=="string"&&h.startsWith("new-");return i.jsxs("section",{className:"py-16",children:[i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[i.jsx(yi,{className:"w-6 h-6 text-accent-600"}),i.jsx("h2",{className:"text-3xl font-bold",children:"Trending Products"})]}),i.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"Discover our most popular items, handpicked for their exceptional style and quality"})]}),i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8",children:d.map((h,m)=>i.jsxs("div",{className:"transform transition-all duration-300 hover:scale-105 relative",children:[i.jsx(bn,{product:h,onQuickView:()=>c(h,m)}),u(h.id)&&i.jsx("div",{className:"absolute top-4 left-4 bg-accent-600 text-white px-3 py-1 rounded-full text-sm font-semibold shadow-lg z-10",children:"New"})]},h.id))})]}),r&&i.jsx(Wr,{product:r,onClose:()=>o(null),onAddToCart:()=>{},onAddToWaitlist:()=>{}})]})}),uh=[{icon:$t,title:"Secure Payments",description:"Shop with confidence knowing that your transactions are safeguarded."},{icon:Jo,title:"Free Shipping",description:"Shopping with no extra charges – savor the liberty of complimentary shipping on every order."},{icon:Zo,title:"Easy Returns",description:"With our hassle-free Easy Returns, changing your mind has never been more convenient."},{icon:Je,title:"Order Tracking",description:"Stay in the loop with our Order Tracking feature – from checkout to your doorstep."}];function mh(){return i.jsx("section",{className:"py-16 bg-gray-50",children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:uh.map(s=>i.jsxs("div",{className:"flex flex-col items-center text-center p-6 bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow",children:[i.jsx("div",{className:"w-16 h-16 flex items-center justify-center bg-black text-white rounded-full mb-4",children:i.jsx(s.icon,{className:"h-8 w-8"})}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:s.title}),i.jsx("p",{className:"text-gray-600 text-sm",children:s.description})]},s.title))})})})}const St=[{id:1,title:"Men's Collection",subtitle:"Spring/Summer 2024",description:"Discover our latest collection of premium menswear",image:"https://images.unsplash.com/photo-1617127365659-c47fa864d8bc?auto=format&fit=crop&w=3440&q=80"},{id:2,title:"Women's Fashion",subtitle:"New Arrivals",description:"Elegant styles for the modern woman",image:"https://images.unsplash.com/photo-1490481651871-ab68de25d43d?auto=format&fit=crop&w=3440&q=80"},{id:3,title:"Luxury Watches",subtitle:"Timeless Elegance",description:"Premium timepieces for every occasion",image:"https://images.unsplash.com/photo-1523170335258-f5ed11844a49?auto=format&fit=crop&w=3440&q=80"}];function fh(){const[s,e]=g.useState(0),[t,n]=g.useState(!1);g.useEffect(()=>{const a=setInterval(()=>{r()},5e3);return()=>clearInterval(a)},[s]);const r=()=>{t||(n(!0),e(a=>(a+1)%St.length),setTimeout(()=>n(!1),500))},o=()=>{t||(n(!0),e(a=>a===0?St.length-1:a-1),setTimeout(()=>n(!1),500))};return i.jsxs("div",{className:"relative h-[800px] overflow-hidden",children:[St.map((a,l)=>i.jsxs("div",{className:`absolute inset-0 transition-opacity duration-1000 ${l===s?"opacity-100":"opacity-0"}`,children:[i.jsx("div",{className:"absolute inset-0 bg-cover bg-center transform scale-105 transition-transform duration-[2000ms]",style:{backgroundImage:`url(${a.image})`,transform:l===s?"scale(1)":"scale(1.05)"}}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/60 via-black/40 to-black/60",children:i.jsx("div",{className:"flex items-center justify-center h-full",children:i.jsxs("div",{className:"text-center text-white px-4 max-w-4xl mx-auto",children:[i.jsx("p",{className:"text-sm uppercase tracking-wider mb-2 opacity-0 animate-[slideDown_1s_ease-out_0.5s_forwards]",children:a.subtitle}),i.jsx("h2",{className:"text-6xl sm:text-7xl font-bold mb-4 opacity-0 animate-[slideDown_1s_ease-out_0.7s_forwards]",children:a.title}),i.jsx("p",{className:"text-xl mb-8 opacity-0 animate-[slideDown_1s_ease-out_0.9s_forwards]",children:a.description})]})})})]},a.id)),i.jsx("button",{onClick:o,className:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 p-2 rounded-full hover:bg-white transition-colors z-10",children:i.jsx(Rt,{className:"h-6 w-6"})}),i.jsx("button",{onClick:r,className:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 p-2 rounded-full hover:bg-white transition-colors z-10",children:i.jsx(ye,{className:"h-6 w-6"})}),i.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2 z-10",children:St.map((a,l)=>i.jsx("button",{onClick:()=>e(l),className:`w-2 h-2 rounded-full transition-colors ${l===s?"bg-white":"bg-white/50"}`},l))})]})}const Et=[{id:1,name:"Premium Wireless Headphones",price:"$299",image:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=3440&q=80",category:"Electronics",path:"/electronics"},{id:2,name:"Designer Summer Collection",price:"$129",image:"https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?auto=format&fit=crop&w=3440&q=80",category:"Women",path:"/women"},{id:3,name:"Smart Watch Collection",price:"$399",image:"https://images.unsplash.com/photo-1546868871-7041f2a55e12?auto=format&fit=crop&w=3440&q=80",category:"Watches",path:"/watches"},{id:4,name:"Kids Fashion Collection",price:"$79",image:"https://images.unsplash.com/photo-1514090458221-65bb69cf63e6?auto=format&fit=crop&w=3440&q=80",category:"Kids",path:"/kids"}];function ph(){const[s,e]=g.useState(0),[t,n]=g.useState(!1);g.useEffect(()=>{const a=setInterval(()=>{r()},5e3);return()=>clearInterval(a)},[s]);const r=()=>{t||(n(!0),e(a=>(a+1)%Et.length),setTimeout(()=>n(!1),500))},o=()=>{t||(n(!0),e(a=>a===0?Et.length-1:a-1),setTimeout(()=>n(!1),500))};return i.jsxs("section",{className:"py-24 bg-gradient-to-b from-gray-900 to-black relative overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 opacity-5",children:i.jsx("div",{className:"absolute inset-0",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`,backgroundSize:"30px 30px"}})}),i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"overflow-hidden",children:i.jsx("div",{className:"flex transition-transform duration-500 ease-out",style:{transform:`translateX(-${s*100}%)`},children:Et.map(a=>i.jsx("div",{className:"w-full flex-shrink-0 px-4",children:i.jsx(L,{to:a.path,className:"block relative group",children:i.jsxs("div",{className:"relative aspect-[21/9] overflow-hidden rounded-2xl",children:[i.jsx("img",{src:a.image,alt:a.name,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/40 to-transparent",children:i.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-8",children:i.jsxs("div",{className:"max-w-xl",children:[i.jsx("p",{className:"text-accent-400 text-sm font-medium mb-2",children:a.category}),i.jsx("h3",{className:"text-3xl font-bold text-white mb-4",children:a.name}),i.jsxs("p",{className:"text-xl text-white/80 mb-6",children:["Starting from ",a.price]}),i.jsxs("div",{className:"inline-flex items-center text-white font-medium group-hover:text-accent-400 transition-colors",children:[i.jsx("span",{children:"Explore Collection"}),i.jsx(vi,{className:"w-5 h-5 ml-2 transform group-hover:translate-x-2 transition-transform"})]})]})})})]})})},a.id))})}),i.jsx("button",{onClick:o,className:"absolute left-8 top-1/2 -translate-y-1/2 bg-white/10 backdrop-blur-sm text-white p-3 rounded-full hover:bg-white/20 transition-colors",children:i.jsx(Rt,{className:"w-6 h-6"})}),i.jsx("button",{onClick:r,className:"absolute right-8 top-1/2 -translate-y-1/2 bg-white/10 backdrop-blur-sm text-white p-3 rounded-full hover:bg-white/20 transition-colors",children:i.jsx(ye,{className:"w-6 h-6"})}),i.jsx("div",{className:"absolute -bottom-12 left-1/2 -translate-x-1/2 flex space-x-2",children:Et.map((a,l)=>i.jsx("button",{onClick:()=>e(l),className:`w-2 h-2 rounded-full transition-colors ${l===s?"bg-white":"bg-white/50"}`},l))})]})})]})}function gh(){return g.useEffect(()=>{["https://images.unsplash.com/photo-1445205170230-053b83016050","https://images.unsplash.com/photo-1581338834647-b0fb40704e21","https://images.unsplash.com/photo-1604014237800-1c9102c219da"].forEach(e=>{const t=new Image;t.src=`${e}?auto=format&fit=crop&q=80&w=3440`})},[]),i.jsxs("div",{className:"relative",children:[i.jsx(fh,{}),i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1445205170230-053b83016050?auto=format&fit=crop&q=80&w=3440",className:"py-16",speed:.3,blur:!0,children:i.jsx("div",{className:"relative",children:i.jsx(ih,{})})}),i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1581338834647-b0fb40704e21?auto=format&fit=crop&q=80&w=3440",className:"py-16",speed:.4,blur:!0,children:i.jsx("div",{className:"relative",children:i.jsx(hh,{})})}),i.jsx(ph,{}),i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1604014237800-1c9102c219da?auto=format&fit=crop&q=80&w=3440",className:"py-16",speed:.3,blur:!0,children:i.jsx("div",{className:"relative",children:i.jsx(mh,{})})})]})}function rs({title:s,description:e,products:t,isAdmin:n,onUpdateProduct:r,onDeleteProduct:o}){const[a,l]=g.useState(null),d=c=>{l(c)};return i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:s}),i.jsx("p",{className:"text-xl text-white/80",children:e})]}),i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8",children:t.map(c=>i.jsx(bn,{product:c,isAdmin:n,onUpdate:r,onDelete:o,onQuickView:d},c.id))}),t.length===0&&i.jsx("div",{className:"text-center py-12",children:i.jsx("p",{className:"text-white/70",children:"No products found in this category."})}),a&&i.jsx(Wr,{product:a,onClose:()=>l(null),onAddToCart:()=>{},onAddToWaitlist:()=>{}})]})}function xh(){const{products:s}=Ee(),e=s.filter(t=>t.category==="Electronics");return i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=3440&q=80",className:"min-h-screen pt-16",speed:.3,children:i.jsx(rs,{title:"Electronics",description:"Latest Tech & Gadgets",products:e})})}function _h(){const{products:s}=Ee(),e=s.filter(t=>t.category==="Men");return i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1617127365659-c47fa864d8bc?auto=format&fit=crop&w=3440&q=80",className:"min-h-screen pt-16",speed:.3,children:i.jsx(rs,{title:"Men's Collection",description:"Premium Fashion for Men",products:e})})}function yh(){const{products:s}=Ee(),e=s.filter(t=>t.category==="Women");return i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1490481651871-ab68de25d43d?auto=format&fit=crop&w=3440&q=80",className:"min-h-screen pt-16",speed:.3,children:i.jsx(rs,{title:"Women's Collection",description:"Elegant Styles for Women",products:e})})}function vh(){const{products:s}=Ee(),e=s.filter(t=>t.category==="Watches");return i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1523170335258-f5ed11844a49?auto=format&fit=crop&w=3440&q=80",className:"min-h-screen pt-16",speed:.3,children:i.jsx(rs,{title:"Luxury Timepieces",description:"Discover Our Collection of Premium Watches",products:e})})}const qr=g.createContext(void 0);function wh({children:s}){const[e,t]=g.useState(()=>{const d=localStorage.getItem("cart");return d?JSON.parse(d):[]});g.useEffect(()=>{localStorage.setItem("cart",JSON.stringify(e))},[e]);const n=(d,c=1)=>{t(u=>u.find(m=>m.id===d.id)?u.map(m=>m.id===d.id?{...m,quantity:m.quantity+c}:m):[...u,{...d,quantity:c}])},r=d=>{t(c=>c.filter(u=>u.id!==d))},o=(d,c)=>{t(u=>u.map(h=>h.id===d?{...h,quantity:c}:h))},a=()=>{t([])},l=e.reduce((d,c)=>d+c.price*c.quantity,0);return i.jsx(qr.Provider,{value:{items:e,addItem:n,removeItem:r,updateQuantity:o,clearCart:a,total:l},children:s})}function bh(){const s=g.useContext(qr);if(s===void 0)throw new Error("useCart must be used within a CartProvider");return s}function Nh(){const{id:s}=Xr(),[e,t]=g.useState(null),[n,r]=g.useState(!0),[o,a]=g.useState(null),{addItem:l}=bh();g.useEffect(()=>{(async()=>{try{if(!s)throw new Error("Product ID is required");const u=await Ud(s);t(u)}catch(u){a("Failed to load product"),console.error(u)}finally{r(!1)}})()},[s]);const d=()=>{e&&(l(e),w.success("Added to cart!"))};return n?i.jsx("div",{className:"flex justify-center pt-20",children:"Loading..."}):o?i.jsx("div",{className:"text-red-500 pt-20",children:o}):e?i.jsx("div",{className:"pt-20",children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:i.jsxs("div",{className:"grid md:grid-cols-2 gap-12",children:[i.jsx("div",{className:"aspect-square overflow-hidden rounded-lg bg-gray-100",children:i.jsx("img",{src:e.image,alt:e.name,className:"w-full h-full object-contain p-8"})}),i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold mb-4",children:e.name}),i.jsx("p",{className:"text-2xl font-semibold",children:wn(e.price)})]}),i.jsx("div",{className:"prose max-w-none",children:i.jsx("p",{className:"text-gray-600",children:e.description})}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("button",{onClick:d,className:"w-full flex items-center justify-center space-x-2 bg-accent-600 text-white px-8 py-4 rounded-full hover:bg-accent-700 transition-colors",children:[i.jsx(qe,{className:"h-5 w-5"}),i.jsx("span",{children:"Add to Cart"})]}),i.jsxs("button",{className:"w-full flex items-center justify-center space-x-2 border border-accent-600 text-accent-600 px-8 py-4 rounded-full hover:bg-accent-50 transition-colors",children:[i.jsx(Os,{className:"h-5 w-5"}),i.jsx("span",{children:"Add to Wishlist"})]})]})]})]})})}):i.jsx("div",{className:"pt-20",children:"Product not found"})}function jh(){const[s,e]=g.useState([]),t=(o,a)=>{e(l=>l.map(d=>d.id===o?{...d,quantity:Math.max(0,a)}:d))},n=o=>{e(a=>a.filter(l=>l.id!==o))},r=s.reduce((o,a)=>o+a.price*a.quantity,0);return s.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Your Cart is Empty"}),i.jsx("p",{className:"text-gray-600",children:"Add some products to your cart to see them here."})]}):i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Shopping Cart"}),i.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[i.jsx("div",{className:"p-6 space-y-4",children:s.map(o=>i.jsxs("div",{className:"flex items-center border-b pb-4",children:[i.jsx("img",{src:o.image,alt:o.name,className:"w-24 h-24 object-cover rounded"}),i.jsxs("div",{className:"ml-4 flex-grow",children:[i.jsx("h3",{className:"text-lg font-semibold",children:o.name}),i.jsxs("p",{className:"text-gray-600",children:["$",o.price]}),i.jsxs("div",{className:"flex items-center mt-2",children:[i.jsx("button",{onClick:()=>t(o.id,o.quantity-1),className:"px-2 py-1 border rounded",children:"-"}),i.jsx("span",{className:"mx-4",children:o.quantity}),i.jsx("button",{onClick:()=>t(o.id,o.quantity+1),className:"px-2 py-1 border rounded",children:"+"})]})]}),i.jsx("button",{onClick:()=>n(o.id),className:"text-red-500 hover:text-red-700",children:"Remove"})]},o.id))}),i.jsxs("div",{className:"bg-gray-50 p-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("span",{className:"text-lg font-semibold",children:"Total:"}),i.jsxs("span",{className:"text-2xl font-bold",children:["$",r.toFixed(2)]})]}),i.jsx("button",{className:"w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700",children:"Proceed to Checkout"})]})]})]})}function Ch(){const{currentUser:s,userProfile:e,logout:t}=le(),[n,r]=g.useState(!1),o=je(),a=async()=>{r(!0);try{await t(),o("/login")}catch(l){console.error("Failed to log out:",l)}finally{r(!1)}};return s?i.jsx("div",{className:"min-h-screen bg-gray-50 pt-16",children:i.jsx("div",{className:"max-w-2xl mx-auto p-6",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8",children:[i.jsx("div",{className:"flex items-center justify-center mb-8",children:s.photoURL?i.jsx("img",{src:s.photoURL,alt:"Profile",className:"w-24 h-24 rounded-full"}):i.jsx("div",{className:"w-24 h-24 rounded-full bg-accent-100 flex items-center justify-center",children:i.jsx(ft,{className:"w-12 h-12 text-accent-600"})})}),i.jsxs("div",{className:"space-y-6",children:[e?.name&&i.jsxs("div",{children:[i.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Full Name"}),i.jsx("p",{className:"mt-1 text-lg font-medium text-gray-900",children:e.name})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Email Address"}),i.jsx("p",{className:"mt-1 text-lg font-medium text-gray-900",children:s.email})]}),e?.createdAt&&i.jsxs("div",{children:[i.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Member Since"}),i.jsx("p",{className:"mt-1 text-lg font-medium text-gray-900",children:new Date(e.createdAt).toLocaleDateString()})]}),i.jsx("div",{className:"pt-6",children:i.jsx("button",{onClick:a,disabled:n,className:"w-full bg-accent-600 text-white py-3 px-4 rounded-lg hover:bg-accent-700 transition-colors disabled:opacity-50",children:n?"Logging out...":"Log Out"})})]})]})})}):null}const Sh={email:"admin@luxe.com",password:"admin123"},Ur=g.createContext(void 0);function Eh({children:s}){const[e,t]=g.useState(!1),[n,r]=g.useState(Sh);g.useEffect(()=>{localStorage.getItem("adminToken")&&t(!0)},[]);const o=async(d,c)=>{try{return d===n.email&&c===n.password?(t(!0),localStorage.setItem("adminToken",btoa(`${d}:${Date.now()}`)),w.success("Successfully logged in as admin"),!0):(w.error("Invalid credentials"),!1)}catch(u){return console.error("Login failed:",u),w.error("Login failed"),!1}},a=()=>{t(!1),localStorage.removeItem("adminToken"),w.success("Logged out successfully")},l=async(d,c,u)=>{try{return c!==n.password?(w.error("Current password is incorrect"),!1):(r({email:d||n.email,password:u||n.password}),w.success("Admin credentials updated successfully"),!0)}catch(h){return console.error("Failed to update admin credentials:",h),w.error("Failed to update credentials"),!1}};return i.jsx(Ur.Provider,{value:{isAdmin:e,login:o,logout:a,updateAdminCredentials:l},children:s})}function os(){const s=g.useContext(Ur);if(s===void 0)throw new Error("useAdmin must be used within an AdminProvider");return s}function kh({currentMedia:s=[],onMediaChange:e,maxFiles:t=5}){const[n,r]=g.useState([]),[o,a]=g.useState(!1),l=g.useRef(null),d=async m=>{const p=Array.from(m.target.files||[]);if(p.length){if(n.length+p.length>t){w.error(`You can only upload up to ${t} files`);return}a(!0);try{const f=await Promise.all(p.map(async v=>{if(!v.type.startsWith("image/")&&!v.type.startsWith("video/"))throw new Error("Invalid file type. Please upload images or videos only.");const N=await c(v);return{id:crypto.randomUUID(),type:v.type.startsWith("image/")?"image":"video",file:v,preview:N}}));r(v=>[...v,...f]);const _=f.map(v=>v.preview);e([...s,..._])}catch(f){console.error("Upload error:",f),w.error(f instanceof Error?f.message:"Failed to process files")}finally{a(!1),l.current&&(l.current.value="")}}},c=m=>new Promise((p,f)=>{const _=new FileReader;_.onload=()=>{p(_.result)},_.onerror=()=>{f(new Error("Failed to read file"))},_.readAsDataURL(m)}),u=m=>{r(f=>f.filter(_=>_.id!==m));const p=n.filter(f=>f.id!==m).map(f=>f.preview);e(p)},h=(m,p)=>{const f=[...n],[_]=f.splice(m,1);f.splice(p,0,_),r(f),e(f.map(v=>v.preview))};return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"relative",children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Product Media (",n.length,"/",t,")"]}),n.length>0&&i.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 mb-4",children:n.map((m,p)=>i.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-gray-200 group",draggable:!0,onDragStart:f=>f.dataTransfer.setData("text/plain",p.toString()),onDragOver:f=>f.preventDefault(),onDrop:f=>{f.preventDefault();const _=parseInt(f.dataTransfer.getData("text/plain"));h(_,p)},children:[m.type==="image"?i.jsx("img",{src:m.preview,alt:"Preview",className:"w-full h-full object-cover"}):i.jsx("video",{src:m.preview,className:"w-full h-full object-cover",controls:!0}),i.jsxs("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity",children:[i.jsx("button",{onClick:()=>u(m.id),className:"absolute top-2 right-2 p-1 bg-white rounded-full hover:bg-gray-100",children:i.jsx(Ue,{className:"w-4 h-4"})}),p===0&&i.jsx("span",{className:"absolute bottom-2 left-2 text-xs text-white bg-black/50 px-2 py-1 rounded",children:"Main Image"})]})]},m.id))}),n.length<t&&i.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6",children:[i.jsx("input",{type:"file",ref:l,onChange:d,accept:"image/*,video/*",className:"hidden",id:"media-upload",multiple:!0}),i.jsxs("label",{htmlFor:"media-upload",className:"cursor-pointer flex flex-col items-center space-y-2",children:[i.jsxs("div",{className:"flex space-x-2",children:[i.jsx(ea,{className:"w-8 h-8 text-gray-400"}),i.jsx(ta,{className:"w-8 h-8 text-gray-400"})]}),i.jsx("span",{className:"text-sm text-gray-600",children:o?"Processing...":"Click to upload or drag and drop"}),i.jsx("span",{className:"text-xs text-gray-500",children:"Images (PNG, JPG, GIF) or Videos (MP4, WebM)"})]})]})]}),o&&i.jsx("div",{className:"relative pt-1",children:i.jsx("div",{className:"overflow-hidden h-2 text-xs flex rounded bg-gray-200",children:i.jsx("div",{className:"animate-pulse w-full bg-accent-600"})})})]})}let kt;const Ih=new Uint8Array(16);function Ph(){if(!kt&&(kt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!kt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return kt(Ih)}const U=[];for(let s=0;s<256;++s)U.push((s+256).toString(16).slice(1));function Th(s,e=0){return U[s[e+0]]+U[s[e+1]]+U[s[e+2]]+U[s[e+3]]+"-"+U[s[e+4]]+U[s[e+5]]+"-"+U[s[e+6]]+U[s[e+7]]+"-"+U[s[e+8]]+U[s[e+9]]+"-"+U[s[e+10]]+U[s[e+11]]+U[s[e+12]]+U[s[e+13]]+U[s[e+14]]+U[s[e+15]]}const Rh=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),hi={randomUUID:Rh};function Ah(s,e,t){if(hi.randomUUID&&!e&&!s)return hi.randomUUID();s=s||{};const n=s.random||(s.rng||Ph)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Th(n)}function Dh({product:s,onClose:e,onSave:t}){const{addProduct:n,updateProduct:r}=Ee(),[o,a]=g.useState(!1),[l,d]=g.useState(s||{id:Ah(),name:"",price:0,description:"",category:"",media:[],inStock:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),c=h=>{d(m=>({...m,media:h.map(p=>({url:p,type:p.startsWith("data:video")?"video":"image"}))}))},u=async h=>{if(h.preventDefault(),!o){if(!l.name?.trim()){w.error("Product name is required");return}if(!l.price||l.price<=0){w.error("Please enter a valid price");return}if(!l.description?.trim()){w.error("Product description is required");return}if(!l.category){w.error("Please select a category");return}if(!l.media||l.media.length===0){w.error("Please add at least one product image");return}try{a(!0);const m={...l,price:typeof l.price=="string"?parseFloat(l.price):l.price,updatedAt:new Date().toISOString()};s?(await r(m),w.success("Product updated successfully")):(n(m),w.success("Product added successfully")),t(),e()}catch(m){console.error("Product operation failed:",m),w.error(`Failed to ${s?"update":"add"} product`)}finally{a(!1)}}};return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:i.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsx("h2",{className:"text-2xl font-bold",children:s?"Edit Product":"Add New Product"}),i.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",type:"button",children:i.jsx(Ue,{className:"h-6 w-6"})})]}),i.jsxs("form",{onSubmit:u,className:"space-y-6",children:[i.jsx(kh,{currentMedia:l.media?.map(h=>h.url),onMediaChange:c,maxFiles:5}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Name"}),i.jsx("input",{type:"text",value:l.name||"",onChange:h=>d({...l,name:h.target.value}),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-accent-500",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price"}),i.jsxs("div",{className:"relative",children:[i.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),i.jsx("input",{type:"number",value:l.price||"",onChange:h=>d({...l,price:parseFloat(h.target.value)||0}),className:"w-full pl-8 pr-4 py-2 border rounded-md focus:ring-2 focus:ring-accent-500",step:"0.01",min:"0",required:!0})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),i.jsx("textarea",{value:l.description||"",onChange:h=>d({...l,description:h.target.value}),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-accent-500",rows:4,required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),i.jsxs("select",{value:l.category||"",onChange:h=>d({...l,category:h.target.value}),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-accent-500",required:!0,children:[i.jsx("option",{value:"",children:"Select a category"}),i.jsx("option",{value:"Electronics",children:"Electronics"}),i.jsx("option",{value:"Men",children:"Men"}),i.jsx("option",{value:"Women",children:"Women"}),i.jsx("option",{value:"Watches",children:"Watches"}),i.jsx("option",{value:"Accessories",children:"Accessories"}),i.jsx("option",{value:"Footwear",children:"Footwear"})]})]}),i.jsxs("div",{className:"flex items-center space-x-2 mt-4",children:[i.jsx("input",{type:"checkbox",id:"inStock",checked:l.inStock,onChange:h=>d({...l,inStock:h.target.checked}),className:"rounded border-gray-300 text-accent-600 focus:ring-accent-500"}),i.jsx("label",{htmlFor:"inStock",className:"text-sm text-gray-700",children:"In Stock"})]}),i.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[i.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 border rounded-md hover:bg-gray-50",disabled:o,children:"Cancel"}),i.jsx("button",{type:"submit",className:"px-4 py-2 bg-accent-600 text-white rounded-md hover:bg-accent-700 disabled:opacity-50",disabled:o,children:o?"Processing...":s?"Update Product":"Add Product"})]})]})]})})})}function Mh(){const{products:s,deleteProduct:e,updateProduct:t,refreshProducts:n,loading:r}=Ee(),{logout:o}=os(),a=je(),[l,d]=g.useState(""),[c,u]=g.useState("All"),[h,m]=g.useState(!1);g.useEffect(()=>{n();const y=setInterval(n,3e4);return()=>clearInterval(y)},[n]);const p=["All","Electronics","Men","Women","Watches"],f=s.filter(y=>{const E=y.name.toLowerCase().includes(l.toLowerCase())||y.description.toLowerCase().includes(l.toLowerCase()),Y=c==="All"||y.category===c;return E&&Y}),_=g.useCallback(async y=>{try{await t(y),w.success("Product updated successfully")}catch(E){throw w.error("Failed to update product"),E}},[t]),v=g.useCallback(async y=>{try{await e(y),w.success("Product deleted successfully")}catch(E){throw w.error("Failed to delete product"),E}},[e]),N=async()=>{try{await o(),a("/admin/login")}catch{w.error("Failed to logout")}};return i.jsxs("div",{className:"min-h-screen bg-gray-50",children:[i.jsx("nav",{className:"bg-white shadow-sm",children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:i.jsxs("div",{className:"flex justify-between h-16",children:[i.jsx("div",{className:"flex items-center",children:i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Dashboard"})}),i.jsx("div",{className:"flex items-center space-x-4",children:i.jsxs("button",{onClick:N,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-accent-600 hover:bg-accent-700",children:[i.jsx(gi,{className:"h-4 w-4 mr-2"}),"Logout"]})})]})})}),i.jsxs("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 mb-6",children:[i.jsxs("div",{className:"relative flex-1",children:[i.jsx(sa,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),i.jsx("input",{type:"text",placeholder:"Search products...",value:l,onChange:y=>d(y.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-md focus:ring-2 focus:ring-accent-500 focus:border-transparent"})]}),i.jsx("select",{value:c,onChange:y=>u(y.target.value),className:"px-4 py-2 border rounded-md focus:ring-2 focus:ring-accent-500 focus:border-transparent",children:p.map(y=>i.jsx("option",{value:y,children:y},y))}),i.jsxs("button",{onClick:()=>m(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-accent-600 hover:bg-accent-700",children:[i.jsx(As,{className:"h-4 w-4 mr-2"}),"Add Product"]})]}),r?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-600 mx-auto"}),i.jsx("p",{className:"mt-4 text-gray-600",children:"Loading products..."})]}):i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:f.map(y=>i.jsx(bn,{product:y,isAdmin:!0,onUpdate:_,onDelete:v},y.id))}),!r&&f.length===0&&i.jsx("div",{className:"text-center py-12",children:i.jsx("p",{className:"text-gray-500",children:"No products found matching your criteria."})}),h&&i.jsx(Dh,{onClose:()=>m(!1),onSave:n})]})]})}function Lh(){const[s,e]=g.useState(""),[t,n]=g.useState(""),[r,o]=g.useState(""),[a,l]=g.useState(!1),{login:d}=os(),c=je(),u=async h=>{h.preventDefault(),o("");try{await d(s,t)?(l(!0),setTimeout(()=>{c("/admin/dashboard")},1500)):o("Invalid credentials")}catch{o("An error occurred during login")}};return i.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:[i.jsxs("div",{className:"max-w-md w-full space-y-8",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Admin Login"}),i.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Access the admin dashboard"})]}),i.jsxs("form",{className:"mt-8 space-y-6",onSubmit:u,children:[r&&i.jsx("div",{className:"text-red-600 text-center text-sm bg-red-50 p-2 rounded",children:r}),i.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"email-address",className:"sr-only",children:"Email address"}),i.jsx("input",{id:"email-address",name:"email",type:"email",autoComplete:"email",required:!0,value:s,onChange:h=>e(h.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-black focus:border-black focus:z-10 sm:text-sm",placeholder:"Email address"})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),i.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:t,onChange:h=>n(h.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-black focus:border-black focus:z-10 sm:text-sm",placeholder:"Password"})]})]}),i.jsx("div",{children:i.jsx("button",{type:"submit",className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black",children:"Sign in"})})]})]}),i.jsx(Nn,{show:a,message:"Login successful! Redirecting...",onClose:()=>l(!1)})]})}function Fh(){const{updateAdminCredentials:s,logout:e}=os(),t=je(),[n,r]=g.useState(""),[o,a]=g.useState(""),[l,d]=g.useState(""),[c,u]=g.useState(""),[h,m]=g.useState(!1),[p,f]=g.useState(""),_=async v=>{if(v.preventDefault(),u(""),!o){u("Current password is required");return}try{await s(n||"",o,l||"")?(f("Credentials updated successfully. Please login again."),m(!0),r(""),a(""),d(""),setTimeout(()=>{e(),t("/admin/login")},2e3)):u("Current password is incorrect")}catch{u("An error occurred while updating credentials")}};return i.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:i.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow p-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Update Admin Credentials"}),i.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Change your login details"})]}),c&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-600 rounded-md text-sm",children:c}),i.jsxs("form",{onSubmit:_,className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"New Email (optional)"}),i.jsx("input",{type:"email",id:"email",value:n,onChange:v=>r(v.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm",placeholder:"Leave blank to keep current email"})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700",children:"Current Password"}),i.jsx("input",{type:"password",id:"currentPassword",value:o,onChange:v=>a(v.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm"})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700",children:"New Password (optional)"}),i.jsx("input",{type:"password",id:"newPassword",value:l,onChange:v=>d(v.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm",placeholder:"Leave blank to keep current password"})]}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("button",{type:"submit",className:"flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black",children:"Update Credentials"}),i.jsx("button",{type:"button",onClick:()=>t("/admin/dashboard"),className:"flex-1 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black",children:"Back to Dashboard"})]})]}),i.jsx(Nn,{show:h,message:p,onClose:()=>m(!1),duration:2e3})]})})}function ui({children:s}){const{isAdmin:e}=os();return e?i.jsx(i.Fragment,{children:s}):i.jsx(ps,{to:"/admin/login"})}function Oh(){g.useEffect(()=>{const e=new IntersectionObserver(t=>{t.forEach(n=>{n.isIntersecting&&n.target.classList.add("animate-fade-in")})},{threshold:.1});return document.querySelectorAll(".animate-on-scroll").forEach(t=>{e.observe(t)}),()=>e.disconnect()},[]);const s=[{icon:ra,title:"Quality Assurance",description:"Every product meets our rigorous standards for excellence."},{icon:oa,title:"Premium Selection",description:"Curated collections featuring the finest materials and craftsmanship."},{icon:aa,title:"Customer First",description:"Dedicated to providing exceptional service and experience."},{icon:la,title:"Timeless Style",description:"Creating enduring fashion that transcends trends."}];return i.jsxs("div",{className:"min-h-screen",children:[i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1560448204-603b3fc33ddc?auto=format&fit=crop&q=80&w=3440",className:"h-[70vh] flex items-center",speed:.5,children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-white",children:[i.jsx("h1",{className:"text-5xl md:text-7xl font-bold mb-6 animate-fade-in",children:"Our Story"}),i.jsx("p",{className:"text-xl md:text-2xl text-white/80 max-w-3xl mx-auto animate-fade-in delay-300",children:"Crafting luxury experiences since 1970"})]})}),i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&q=80&w=3440",className:"py-24",speed:.3,children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:i.jsx("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-12 text-white",children:i.jsxs("div",{className:"max-w-3xl mx-auto text-center animate-on-scroll opacity-0",children:[i.jsx(na,{className:"w-12 h-12 mx-auto mb-6 text-accent-500"}),i.jsx("h2",{className:"text-4xl font-bold mb-6",children:"Our Mission"}),i.jsx("p",{className:"text-lg text-white/80 leading-relaxed",children:"At LUXE, we're dedicated to redefining luxury fashion through innovation and sustainability. Our mission is to provide discerning customers with exceptional quality products while maintaining our commitment to ethical practices and environmental responsibility."})]})})})}),i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1537832816519-689ad163238b?auto=format&fit=crop&q=80&w=3440",className:"py-24",speed:.4,children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[i.jsxs("div",{className:"text-center mb-16 animate-on-scroll opacity-0",children:[i.jsx(ia,{className:"w-12 h-12 mx-auto mb-6 text-accent-500"}),i.jsx("h2",{className:"text-4xl font-bold text-white mb-6",children:"Our Values"}),i.jsx("p",{className:"text-lg text-white/80 max-w-2xl mx-auto",children:"Built on a foundation of excellence, our values guide every decision we make"})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:s.map((e,t)=>i.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-xl p-8 text-white animate-on-scroll opacity-0",style:{animationDelay:`${t*200}ms`},children:[i.jsx(e.icon,{className:"w-10 h-10 mb-4 text-accent-500"}),i.jsx("h3",{className:"text-xl font-semibold mb-4",children:e.title}),i.jsx("p",{className:"text-white/80",children:e.description})]},e.title))})]})}),i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1441984904996-e0b6ba687e04?auto=format&fit=crop&q=80&w=3440",className:"py-24",speed:.2,children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:i.jsx("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-12",children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 text-white",children:[i.jsxs("div",{className:"text-center animate-on-scroll opacity-0",children:[i.jsx("div",{className:"text-5xl font-bold mb-2",children:"50+"}),i.jsx("div",{className:"text-white/80",children:"Global Locations"})]}),i.jsxs("div",{className:"text-center animate-on-scroll opacity-0",style:{animationDelay:"200ms"},children:[i.jsx("div",{className:"text-5xl font-bold mb-2",children:"1M+"}),i.jsx("div",{className:"text-white/80",children:"Happy Customers"})]}),i.jsxs("div",{className:"text-center animate-on-scroll opacity-0",style:{animationDelay:"400ms"},children:[i.jsx("div",{className:"text-5xl font-bold mb-2",children:"100K+"}),i.jsx("div",{className:"text-white/80",children:"Products Sold"})]})]})})})})]})}const Wh=[{id:"returns",question:"What is your return policy?",answer:"We do not accept returns for any products. However, exchanges are available for items that are defective or incorrect. Please contact our customer service team for assistance with exchanges.",icon:Je},{id:"tracking",question:"How can I track my order?",answer:"Once your order has shipped, you will receive a tracking number via email, which you can use to track the delivery status.",icon:Je},{id:"contact",question:"How can I contact customer service?",answer:"You can reach our customer service team at support@yourstore.com or through the contact form on our website. We aim to respond within 24-48 hours.",icon:bi},{id:"payment",question:"What payment methods do you accept?",answer:"We accept payments through various methods including Visa, MasterCard, American Express, PayPal, and Apple Pay.",icon:Tt},{id:"shipping",question:"Do you ship internationally?",answer:"Yes, we offer international shipping to select countries. Rates and delivery times vary by destination.",icon:Ni},{id:"modification",question:"Can I modify or cancel my order after placing it?",answer:"Orders are processed quickly. Please contact us immediately if you need to make changes or cancel your order, and we will try to accommodate your request before shipping.",icon:Je},{id:"giftcards",question:"Do you offer gift cards?",answer:"Yes, we offer digital gift cards that can be used for purchases on our site.",icon:da},{id:"damaged",question:"What should I do if I received a damaged or incorrect item?",answer:"If you receive a damaged or incorrect item, please contact our customer service team right away at support@yourstore.com. We will assist you with exchanging the product.",icon:Je},{id:"account",question:"How do I create an account?",answer:'Click on the "Sign Up" button on our website, fill in your details, and you will be able to track your orders, save favorite items, and more.',icon:ha}];function qh(){const[s,e]=g.useState(null),t=n=>{e(s===n?null:n)};return i.jsxs("div",{className:"min-h-screen",children:[i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1604014237800-1c9102c219da?auto=format&fit=crop&q=80&w=3440",className:"h-[40vh] flex items-center",speed:.5,children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-white",children:[i.jsx("h1",{className:"text-5xl md:text-6xl font-bold mb-6",children:"Frequently Asked Questions"}),i.jsx("p",{className:"text-xl text-white/80 max-w-2xl mx-auto",children:"Find answers to common questions about our services and policies"})]})}),i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&q=80&w=3440",className:"py-24",speed:.3,children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[i.jsx("div",{className:"space-y-6",children:Wh.map(n=>i.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-xl overflow-hidden transition-all duration-300",children:[i.jsxs("button",{onClick:()=>t(n.id),className:"w-full px-6 py-4 flex items-center justify-between text-white hover:bg-white/5 transition-colors",children:[i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsx(n.icon,{className:"w-5 h-5 text-accent-500"}),i.jsx("span",{className:"text-lg font-medium text-left",children:n.question})]}),i.jsx(ca,{className:`w-5 h-5 transition-transform duration-300 ${s===n.id?"rotate-180":""}`})]}),i.jsx("div",{className:`px-6 overflow-hidden transition-all duration-300 ${s===n.id?"max-h-48 py-4":"max-h-0"}`,children:i.jsx("p",{className:"text-white/80",children:n.answer})})]},n.id))}),i.jsxs("div",{className:"mt-16 text-center text-white",children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Still have questions?"}),i.jsx("p",{className:"text-white/80 mb-8",children:"Our customer service team is here to help you with any other questions you may have."}),i.jsxs("a",{href:"mailto:support@yourstore.com",className:"inline-flex items-center space-x-2 bg-accent-600 text-white px-6 py-3 rounded-full hover:bg-accent-700 transition-colors",children:[i.jsx(bi,{className:"w-5 h-5"}),i.jsx("span",{children:"Contact Support"})]})]})]})})]})}function Uh(){g.useEffect(()=>{const e=new IntersectionObserver(t=>{t.forEach(n=>{n.isIntersecting&&n.target.classList.add("animate-fade-in")})},{threshold:.1});return document.querySelectorAll(".animate-on-scroll").forEach(t=>{e.observe(t)}),()=>e.disconnect()},[]);const s=[{id:"data-collection",icon:Fs,title:"Data Collection",content:`We collect various types of information to provide and improve our services:

• Personal Information: Name, email address, phone number, billing and shipping addresses
• Payment Information: Credit card details (processed securely through our payment providers)
• Technical Data: IP address, browser type, device information
• Usage Data: Browsing patterns, product preferences, purchase history
• Cookies: We use cookies and similar tracking technologies to enhance your experience`},{id:"data-usage",icon:ua,title:"Data Usage",content:`Your data helps us provide a better shopping experience:

• Processing and fulfilling your orders
• Personalizing your shopping experience
• Communicating about orders, products, and promotions
• Improving our website and services
• Preventing fraud and maintaining security

We may share data with trusted third parties who assist us in operating our website, conducting business, or servicing you.`},{id:"data-protection",icon:Rs,title:"Data Protection",content:`We implement robust security measures to protect your data:

• SSL/TLS encryption for all data transmission
• Secure storage on protected servers
• Regular security assessments and updates
• Strict access controls and authentication
• Compliance with industry security standards`},{id:"user-rights",icon:$t,title:"Your Rights",content:`You have the right to:

• Access your personal data
• Correct inaccurate data
• Request deletion of your data
• Withdraw consent for data processing
• Object to data processing
• Request data portability
• Lodge a complaint with supervisory authorities`},{id:"international",icon:Ni,title:"International Transfers",content:`For international customers:

• Data may be transferred to servers in different countries
• We ensure appropriate safeguards are in place
• Transfers comply with applicable data protection laws
• Standard contractual clauses are implemented where required
• Privacy Shield principles are followed for US transfers`},{id:"updates",icon:it,title:"Policy Updates",content:`We may update this Privacy Policy periodically:

• Changes will be posted on this page
• Material changes will be notified via email
• Continued use of our services after changes constitutes acceptance
• Last updated: ${new Date().toLocaleDateString()}`}];return i.jsxs("div",{className:"min-h-screen",children:[i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1557597774-9d273605dfa9?auto=format&fit=crop&q=80&w=3440",className:"h-[40vh] flex items-center",speed:.5,children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-white",children:[i.jsx("h1",{className:"text-5xl md:text-6xl font-bold mb-6",children:"Privacy Policy"}),i.jsx("p",{className:"text-xl text-white/80 max-w-2xl mx-auto",children:"Your privacy is important to us. Learn how we protect and manage your personal information."})]})}),i.jsx(B,{backgroundImage:"https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&q=80&w=3440",className:"py-24",speed:.3,children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[i.jsx("div",{className:"bg-white/10 backdrop-blur-md rounded-xl p-8 mb-8 text-white animate-on-scroll opacity-0",children:i.jsx("p",{className:"text-lg leading-relaxed",children:"This Privacy Policy applies to all services provided by LUXE and explains how we collect, use, disclose, and safeguard your personal information. By using our services, you agree to the collection and use of information in accordance with this policy."})}),i.jsx("div",{className:"space-y-8",children:s.map((e,t)=>i.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-xl p-8 text-white animate-on-scroll opacity-0",style:{animationDelay:`${t*200}ms`},children:[i.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[i.jsx(e.icon,{className:"w-8 h-8 text-accent-500"}),i.jsx("h2",{className:"text-2xl font-bold",children:e.title})]}),i.jsx("div",{className:"prose prose-lg prose-invert max-w-none opacity-80",children:i.jsx("pre",{className:"whitespace-pre-wrap font-sans",children:e.content})})]},e.id))}),i.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-xl p-8 mt-8 text-white text-center animate-on-scroll opacity-0",children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Contact Us"}),i.jsx("p",{className:"text-white/80 mb-4",children:"If you have any questions about this Privacy Policy, please contact us at:"}),i.jsx("a",{href:"mailto:privacy@luxe.com",className:"text-accent-400 hover:text-accent-300 transition-colors",children:"privacy@luxe.com"})]})]})})]})}function zh(){return i.jsxs(Jr,{children:[i.jsx(V,{path:"/",element:i.jsx(gh,{})}),i.jsx(V,{path:"/electronics",element:i.jsx(xh,{})}),i.jsx(V,{path:"/men",element:i.jsx(_h,{})}),i.jsx(V,{path:"/women",element:i.jsx(yh,{})}),i.jsx(V,{path:"/watches",element:i.jsx(vh,{})}),i.jsx(V,{path:"/products/:id",element:i.jsx(Nh,{})}),i.jsx(V,{path:"/about-us",element:i.jsx(Oh,{})}),i.jsx(V,{path:"/faqs",element:i.jsx(qh,{})}),i.jsx(V,{path:"/privacy-policy",element:i.jsx(Uh,{})}),i.jsx(V,{path:"/cart",element:i.jsx(jt,{children:i.jsx(jh,{})})}),i.jsx(V,{path:"/profile",element:i.jsx(jt,{children:i.jsx(Ch,{})})}),i.jsx(V,{path:"/login",element:i.jsx(jt,{requireAuth:!1,children:i.jsx(th,{})})}),i.jsx(V,{path:"/register",element:i.jsx(jt,{requireAuth:!1,children:i.jsx(sh,{})})}),i.jsx(V,{path:"/admin/login",element:i.jsx(Lh,{})}),i.jsx(V,{path:"/admin/dashboard",element:i.jsx(ui,{children:i.jsx(Mh,{})})}),i.jsx(V,{path:"/admin/credentials",element:i.jsx(ui,{children:i.jsx(Fh,{})})})]})}function Hh(){return i.jsx(Zr,{children:i.jsxs("div",{className:"min-h-screen flex flex-col",children:[i.jsx(Zd,{}),i.jsx("main",{className:"flex-grow pt-16",children:i.jsx(zh,{})}),i.jsx(eh,{})]})})}const Vh=g.createContext(void 0),Yh=50*1024*1024;function Gh({children:s}){const[e,t]=g.useState(()=>{const u=localStorage.getItem("parallax_images");return u?JSON.parse(u):[]}),[n,r]=g.useState(!1);g.useEffect(()=>{localStorage.setItem("parallax_images",JSON.stringify(e))},[e]);const o=async(u,h)=>{r(!0);try{const m=await Promise.all(u.map(async p=>{if(p.size>Yh)throw new Error(`File ${p.name} exceeds 50MB limit`);if(!p.type.startsWith("image/"))throw new Error(`File ${p.name} is not an image`);const f=await new Promise((_,v)=>{const N=new FileReader;N.onload=()=>_(N.result),N.onerror=v,N.readAsDataURL(p)});return{id:crypto.randomUUID(),url:f,name:p.name,pageId:h,active:!0,order:e.filter(_=>_.pageId===h).length,createdAt:new Date().toISOString()}}));t(p=>[...p,...m]),w.success("Images uploaded successfully")}catch(m){throw w.error(m instanceof Error?m.message:"Failed to upload images"),m}finally{r(!1)}},a=u=>{t(h=>h.filter(m=>m.id!==u)),w.success("Image removed")},l=u=>{t(h=>h.map(m=>m.id===u?{...m,active:!m.active}:m)),w.success("Image status updated")},d=(u,h,m)=>{t(p=>{const f=p.filter(y=>y.pageId===u),_=p.filter(y=>y.pageId!==u),[v]=f.splice(h,1);f.splice(m,0,v);const N=f.map((y,E)=>({...y,order:E}));return[..._,...N]})},c=u=>e.filter(h=>h.pageId===u&&h.active).sort((h,m)=>h.order-m.order);return i.jsx(Vh.Provider,{value:{images:e,addImages:o,removeImage:a,toggleImageActive:l,reorderImages:d,getActiveImagesForPage:c,loading:n},children:s})}gs.createRoot(document.getElementById("root")).render(i.jsx(eo.StrictMode,{children:i.jsx(Od,{children:i.jsx(Eh,{children:i.jsx(wh,{children:i.jsx(ch,{children:i.jsxs(Gh,{children:[i.jsx(Hh,{}),i.jsx(ma,{position:"bottom-right",toastOptions:{duration:3e3,style:{background:"#333",color:"#fff"}}})]})})})})})}));
